```python
import os
from zhipuai import ZhipuAI
from IPython.display import display, Code, Markdown

api_key = os.getenv("ZHIPU_API_KEY")
```

â€ƒâ€ƒåœ¨ä¸Šä¸€å°èŠ‚ä¸­ï¼Œæˆ‘ä»¬å·²ç»é¡ºåˆ©å®Œæˆæ™ºè°±AIè´¦å·æ³¨å†Œï¼Œå¹¶è·å–GLMæ¨¡å‹API-KEYï¼ŒåŒæ—¶å®Œæˆäº†æœ¬åœ°è°ƒç”¨æµ‹è¯•ã€‚æœ¬èŠ‚æˆ‘ä»¬å°†å¼€å§‹ç€æ‰‹ä½¿ç”¨GLM-4æ¨¡å‹ï¼Œå¹¶è¯¦ç»†ä»‹ç»GLM-4è°ƒç”¨å‡½æ•°å‚æ•°åŠæ¨¡å‹çš„å¤šè§’è‰²å¯¹è¯ç³»ç»Ÿã€‚

```python
client = ZhipuAI(api_key=api_key) 
response = client.chat.completions.create(
    model="glm-4",  # å¡«å†™éœ€è¦è°ƒç”¨çš„æ¨¡å‹åç§°
    messages=[
        {"role": "user", "content": "ä½ å¥½"}
    ],
)
print(response.choices[0].message)
```

```plaintext
content='ä½ å¥½ğŸ‘‹ï¼æˆ‘æ˜¯äººå·¥æ™ºèƒ½åŠ©æ‰‹æ™ºè°±æ¸…è¨€ï¼Œå¯ä»¥å«æˆ‘å°æ™ºğŸ¤–ï¼Œå¾ˆé«˜å…´è§åˆ°ä½ ï¼Œæ¬¢è¿é—®æˆ‘ä»»ä½•é—®é¢˜ã€‚' role='assistant' tool_calls=None
```

### ä¸€ã€GLM-4è°ƒç”¨æ–¹æ³•

#### 1.SDKè°ƒç”¨ä¸HTTPè°ƒç”¨

â€ƒâ€ƒå’Œå¤§å¤šæ•°å…¶ä»–åœ¨çº¿å¤§æ¨¡å‹å‚å•†ä¸€æ ·ï¼Œæ™ºè°±AIä¸ºGLMæ¨¡å‹åŒæ—¶æä¾›äº†SDKè°ƒç”¨å’ŒHTTPè°ƒç”¨ä¸¤ç§æ–¹æ³•ã€‚æ‰€è°“SDKè°ƒç”¨ï¼ŒæŒ‡çš„æ˜¯åŸºäºSDKï¼ˆè½¯ä»¶å¼€å‘å·¥å…·åŒ…ï¼‰çš„APIè°ƒç”¨æ˜¯æŒ‡ä½¿ç”¨ç”±APIæä¾›è€…æä¾›çš„ä¸“é—¨è½¯ä»¶åº“ï¼ˆå³SDKï¼‰æ¥è¿›è¡ŒAPIè°ƒç”¨çš„è¿‡ç¨‹ã€‚SDKæ˜¯ä¸€ç»„å·¥å…·ã€åº“ã€æ–‡æ¡£å’Œä»£ç ç¤ºä¾‹ï¼Œæ—¨åœ¨å¸®åŠ©å¼€å‘è€…æ›´å®¹æ˜“ã€æ›´é«˜æ•ˆåœ°ä½¿ç”¨ç‰¹å®šçš„APIã€‚åœ¨åŸºäºSDKçš„APIè°ƒç”¨ä¸­ï¼Œå¼€å‘è€…ä¸éœ€è¦ä»å¤´å¼€å§‹ç¼–å†™ç”¨äºä¸APIé€šä¿¡çš„ä»£ç ï¼Œè€Œæ˜¯å¯ä»¥åˆ©ç”¨SDKä¸­çš„é¢„å†™å‡½æ•°å’Œæ–¹æ³•ã€‚

â€ƒâ€ƒè€ŒHTTPè°ƒç”¨åˆ™æ˜¯æŒ‡é€šè¿‡HTTPï¼ˆè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼‰åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å‘é€è¯·æ±‚å’Œæ¥æ”¶å“åº”çš„è¿‡ç¨‹ã€‚è¿™æ˜¯Webä¸Šäº¤æ¢æ•°æ®å’Œä¿¡æ¯çš„åŸºç¡€æœºåˆ¶ã€‚åœ¨HTTPè°ƒç”¨ä¸­ï¼Œå®¢æˆ·ç«¯ï¼ˆé€šå¸¸æ˜¯æµè§ˆå™¨æˆ–åº”ç”¨ç¨‹åºï¼‰å‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªHTTPè¯·æ±‚ï¼Œè¿™ä¸ªè¯·æ±‚å¯ä»¥æ˜¯è·å–æ•°æ®ï¼ˆGETè¯·æ±‚ï¼‰ã€æäº¤æ•°æ®ï¼ˆPOSTè¯·æ±‚ï¼‰ã€æ›´æ–°æ•°æ®ï¼ˆPUTæˆ–PATCHè¯·æ±‚ï¼‰æˆ–åˆ é™¤æ•°æ®ï¼ˆDELETEè¯·æ±‚ï¼‰ã€‚æœåŠ¡å™¨æ¥æ”¶åˆ°è¿™ä¸ªè¯·æ±‚åï¼Œå¤„ç†è¯·æ±‚å¹¶è¿”å›ä¸€ä¸ªHTTPå“åº”ï¼Œå…¶ä¸­åŒ…å«çŠ¶æ€ä»£ç ï¼ˆå¦‚200è¡¨ç¤ºæˆåŠŸï¼Œ404è¡¨ç¤ºæœªæ‰¾åˆ°ç­‰ï¼‰å’Œè¯·æ±‚çš„æ•°æ®æˆ–ç»“æœã€‚

â€ƒâ€ƒä¾‹å¦‚æ­¤å‰æˆ‘ä»¬é€šè¿‡å®‰è£…zhipuåº“æ¥å®Œæˆæ¨¡å‹è°ƒç”¨ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯SDKè°ƒç”¨æ¨¡å‹ï¼Œè¿™ä¹Ÿå°†æ˜¯è¯¾ç¨‹é‡Œé¢ä¸»è¦ä½¿ç”¨çš„è°ƒç”¨æ–¹æ³•ã€‚

![](images/edf4a881-d9a9-427f-b956-2d5932d8b646.png)

#### 2.åŒæ­¥è°ƒç”¨ã€å¼‚æ­¥è°ƒç”¨ä¸SSEè°ƒç”¨

â€ƒâ€ƒè€Œåœ¨SDKè°ƒç”¨è¿‡ç¨‹ä¸­ï¼Œåˆå¯ä»¥ç»†åˆ†ä¸ºåŒæ­¥è°ƒç”¨ã€å¼‚æ­¥è°ƒç”¨ä¸SSEè°ƒç”¨ä¸‰ç§ä¸åŒçš„è°ƒç”¨æ–¹æ³•ã€‚æ‰€è°“çš„åŒæ­¥è°ƒç”¨ï¼ŒæŒ‡çš„æ˜¯æˆ‘ä»¬å‘èµ·è¯·æ±‚ï¼Œç­‰å¾…æœåŠ¡å™¨å“åº”åæ–¹å¯è¿›è¡Œä¸‹ä¸€æ­¥åŠ¨ä½œï¼Œå¹¶ä¸”æœåŠ¡å™¨å“åº”ä¹Ÿæ˜¯ä¸€æ¬¡æ€§è·å¾—å…¨éƒ¨ç»“æœã€‚æˆ‘ä»¬æ­¤å‰è¿›è¡Œçš„æ¨¡å‹è°ƒç”¨å°è¯•ï¼Œå°±æ˜¯åŒæ­¥è°ƒç”¨è¿‡ç¨‹ï¼›è€Œæ‰€è°“å¼‚æ­¥è°ƒç”¨ï¼Œåˆ™æŒ‡çš„æ˜¯å½“å‘èµ·è¯·æ±‚åï¼ŒæœåŠ¡å™¨ä¼šå…ˆç›´æ¥å“åº”å½“å‰ä»»åŠ¡IDï¼Œæ­¤æ—¶æ— è®ºä»»åŠ¡æ˜¯å¦å·²ç»å®Œæˆï¼Œç”¨æˆ·éƒ½å¯ä»¥ç›´æ¥è¿›è¡Œæ¥ä¸‹æ¥çš„åŠ¨ä½œï¼Œè€Œå½“æœåŠ¡å™¨å®Œæˆä»»åŠ¡æ—¶ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡ä»»åŠ¡IDæŸ¥çœ‹åˆ°æœåŠ¡å™¨å“åº”ç»“æœï¼›è€Œæ‰€è°“çš„SSEè°ƒç”¨ï¼Œåˆ™æ˜¯æŒ‡æµå¼ä¼ è¾“ï¼Œæ­¤æ—¶æœåŠ¡å™¨ä¸å†æ˜¯ä¸€æ¬¡æ€§è¿”å›å…¨éƒ¨å†…å®¹ï¼Œè€Œæ˜¯é€ä¸ªå­—ç¬¦ï¼ˆæˆ–è€…è¯è¯­ï¼‰è¿›è¡Œè¿”å›ã€‚è¿™ä¸‰ç§è°ƒç”¨æ–¹æ³•å®ç°è¿‡ç¨‹å¦‚ä¸‹ï¼š

* åŒæ­¥è°ƒç”¨è¿‡ç¨‹

â€ƒâ€ƒæˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨client.chat.completions.createå‡½æ•°æ¥å®ç°åŒæ­¥è°ƒç”¨ï¼Œæ­¤æ—¶ç”¨æˆ·å‘èµ·è¯·æ±‚åï¼Œéœ€è¦ç­‰å¾…æœåŠ¡å™¨ä¸€æ¬¡æ€§å…¨éƒ¨å“åº”ä¹‹åå†è¿›è¡Œä¹‹åçš„æ“ä½œï¼š

```python
client = ZhipuAI(api_key=api_key) 
response = client.chat.completions.create(
    model="glm-4",  # å¡«å†™éœ€è¦è°ƒç”¨çš„æ¨¡å‹åç§°
    messages=[
        {"role": "user", "content": "ä½ å¥½"}
    ],
)
print(response.choices[0].message)
```

```plaintext
content='ä½ å¥½ğŸ‘‹ï¼æˆ‘æ˜¯äººå·¥æ™ºèƒ½åŠ©æ‰‹æ™ºè°±æ¸…è¨€ï¼Œå¯ä»¥å«æˆ‘å°æ™ºğŸ¤–ï¼Œå¾ˆé«˜å…´è§åˆ°ä½ ï¼Œæ¬¢è¿é—®æˆ‘ä»»ä½•é—®é¢˜ã€‚' role='assistant' tool_calls=None
```

* å¼‚æ­¥è°ƒç”¨

â€ƒâ€ƒè°ƒç”¨åä¼šç«‹å³è¿”å›ä¸€ä¸ªä»»åŠ¡ ID ï¼Œç„¶åç”¨ä»»åŠ¡IDæŸ¥è¯¢è°ƒç”¨ç»“æœï¼ˆæ ¹æ®æ¨¡å‹å’Œå‚æ•°çš„ä¸åŒï¼Œé€šå¸¸éœ€è¦ç­‰å¾…10-30ç§’æ‰èƒ½å¾—åˆ°æœ€ç»ˆç»“æœï¼‰ã€‚éœ€è¦æ³¨æ„çš„æ˜¯å¼‚æ­¥è°ƒç”¨æ‰€ä½¿ç”¨çš„å‡½æ•°å¹¶ä¸æ˜¯client.chat.completions.createï¼Œè€Œæ˜¯client.chat.asyncCompletions.createï¼š

```python
client = ZhipuAI(api_key=api_key) 
response_async = client.chat.asyncCompletions.create(
    model="glm-4",  
    messages=[
        {"role": "user", "content": "ä½ å¥½"}
    ],
)
print(response_async)
```

```plaintext
id='754217054184439348311645931336567876' request_id='8311645931336567875' model='glm-4' task_status='PROCESSING'
```

```python
response_async
```

```plaintext
AsyncTaskStatus(id='754217054184439348311645931336567876', request_id='8311645931336567875', model='glm-4', task_status='PROCESSING')
```

* SSEè°ƒç”¨è¿‡ç¨‹

â€ƒâ€ƒè€ŒSSEè°ƒç”¨çš„æµå¼ä¼ è¾“åˆ™è¾ƒå¥½ç†è§£ï¼Œå½“æœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚ä¹‹åï¼Œä¼šå®æ—¶å‘é€æ¨¡å‹é¢„æµ‹ç»“æœã€‚SSEè°ƒç”¨å’ŒåŒæ­¥è°ƒç”¨æ‰€ä½¿ç”¨çš„å‡½æ•°ç›¸åŒï¼Œéƒ½æ˜¯client.chat.completions.createï¼Œå”¯ä¸€ä¸åŒä¹‹å¤„åœ¨äºSSEè°ƒç”¨éœ€è¦æœ‰é¢å¤–å‚æ•°streamï¼Œå¹¶éœ€è¦å°†å…¶è®¾ç½®ä¸ºTrueï¼š

```python
client = ZhipuAI(api_key=api_key) 
response_stream = client.chat.completions.create(
    model="glm-4",  
    messages=[
        {"role": "user", "content": "ä½ å¥½"}
    ],
    stream=True,
)
```

```python
for chunk in response_stream:
    print(chunk.choices[0].delta)
```

```plaintext
content='ä½ å¥½' role='assistant' tool_calls=None
content='ğŸ‘‹ï¼' role='assistant' tool_calls=None
content='æˆ‘æ˜¯' role='assistant' tool_calls=None
content='äººå·¥æ™ºèƒ½' role='assistant' tool_calls=None
content='åŠ©æ‰‹' role='assistant' tool_calls=None
content='æ™º' role='assistant' tool_calls=None
content='è°±' role='assistant' tool_calls=None
content='æ¸…' role='assistant' tool_calls=None
content='è¨€' role='assistant' tool_calls=None
content='ï¼Œ' role='assistant' tool_calls=None
content='å¯ä»¥' role='assistant' tool_calls=None
content='å«æˆ‘' role='assistant' tool_calls=None
content='å°' role='assistant' tool_calls=None
content='æ™º' role='assistant' tool_calls=None
content='ğŸ¤–ï¼Œ' role='assistant' tool_calls=None
content='å¾ˆé«˜å…´' role='assistant' tool_calls=None
content='è§åˆ°' role='assistant' tool_calls=None
content='ä½ ' role='assistant' tool_calls=None
content='ï¼Œ' role='assistant' tool_calls=None
content='æ¬¢è¿' role='assistant' tool_calls=None
content='é—®æˆ‘' role='assistant' tool_calls=None
content='ä»»ä½•' role='assistant' tool_calls=None
content='é—®é¢˜' role='assistant' tool_calls=None
content='ã€‚' role='assistant' tool_calls=None
content='' role='assistant' tool_calls=None
```

è¯¾ç¨‹å‰æœŸå°†ä¸»è¦ä»¥åŒæ­¥è°ƒç”¨è¿‡ç¨‹ä¸ºä¸»ï¼Œåœ¨æŸäº›åœºæ™¯ä¸‹å°†ç”¨åˆ°SSEè°ƒç”¨ã€‚

### äºŒã€chat.completions.createå‡½æ•°å‚æ•°è¯¦è§£

#### 1.chat.completions.createå‡½æ•°å‚æ•°è§£é‡Š

â€ƒâ€ƒåœ¨é€šè¿‡SDKè°ƒç”¨æ¨¡å‹çš„æ—¶å€™ï¼Œchat.completions.createå‡½æ•°ä¸­çš„å‚æ•°è®¾ç½®ä¼šç›´æ¥å†³å®šæœ€ç»ˆæ¨¡å‹è¿è¡Œæ¨¡å¼ã€ä»¥åŠæ¨¡å‹è¿è¡Œç»“æœã€‚å› æ­¤åœ¨åŸºç¡€æ¨¡å‹å­¦ä¹ é˜¶æ®µï¼Œæˆ‘ä»¬éœ€è¦å›´ç»•chat.completions.createå‡½æ•°è¿›è¡Œå®Œæ•´çš„å‚æ•°è§£é‡Šã€‚

* chat.completions.createå‡½æ•°å¿…é€‰å‚æ•°

â€ƒâ€ƒæ•´ä½“æ¥çœ‹ï¼ŒGLMæ¨¡å‹å‚æ•°å’ŒGPTæ¨¡å‹å‚æ•°é«˜åº¦ç±»ä¼¼ï¼Œå¹¶ä¸”é€šè¿‡è§‚å¯Ÿä¸éš¾å‘ç°ï¼Œchat.completions.createå‡½æ•°æœ‰ä¸¤ä¸ªå¿…é€‰å‚æ•°ï¼Œå…¶ä¸€æ˜¯modelï¼Œä»£è¡¨çš„å«ä¹‰æ˜¯å½“å‰è°ƒç”¨çš„æ¨¡å‹ã€‚æ ¹æ®ä¸Šä¸€å°èŠ‚çš„ä»‹ç»ï¼Œç›®å‰å¯é€‰çš„æ¨¡å‹æœ‰ä¸¤ä¸ªï¼Œå…¶ä¸€æ˜¯GLM-3-Turboã€å…¶äºŒåˆ™æ˜¯GLM-4ï¼›ç¬¬äºŒä¸ªå‚æ•°åˆ™æ˜¯messagesï¼Œä»£è¡¨ä¼ è¾“åˆ°æ¨¡å‹å†…éƒ¨çš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚messageså‚æ•°æ˜¯ä¸€ä¸ªåŸºæœ¬æ„æˆå…ƒç´ ä¸ºå­—å…¸çš„åˆ—è¡¨ï¼Œå…¶å†…æ¯ä¸ªå­—å…¸éƒ½ä»£è¡¨ä¸€æ¡ç‹¬ç«‹çš„æ¶ˆæ¯ï¼Œæ¯ä¸ªå­—å…¸éƒ½åŒ…å«ä¸¤ä¸ªé”®å€¼ï¼ˆKey-valueï¼‰å¯¹ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªKeyéƒ½æ˜¯å­—ç¬¦ä¸²roleï¼ˆè§’è‰²ï¼‰è¡¨ç¤ºæŸæ¡æ¶ˆæ¯çš„ä½œè€…ï¼Œç¬¬äºŒä¸ªkeyä¸ºcontentï¼ˆå†…å®¹ï¼‰è¡¨ç¤ºæ¶ˆæ¯å…·ä½“å†…å®¹ã€‚æ›´å¤šå…³äºmessageçš„å‚æ•°è®¾ç½®æ–¹æ³•ç¨åä»‹ç»ï¼Œæ€»çš„æ¥çœ‹ï¼Œè¿™é‡Œçš„messageså°±å¯ä»¥ç®€å•ç†è§£ä¸ºè¾“å…¥ç»™æ¨¡å‹çš„ä¿¡æ¯é˜Ÿåˆ—ï¼Œè€Œæ¨¡å‹æ¥æ”¶åˆ°messageä¹‹åä¹Ÿä¼šè¾“å‡ºå¯¹åº”çš„å›ç­”ä¿¡æ¯ï¼Œå½“ç„¶ä¹Ÿæ˜¯ä»¥messageå½¢å¼å‘ˆç°ï¼š

```python
response.choices[0].message
```

```plaintext
CompletionMessage(content='ä½ å¥½ğŸ‘‹ï¼æˆ‘æ˜¯äººå·¥æ™ºèƒ½åŠ©æ‰‹æ™ºè°±æ¸…è¨€ï¼Œå¯ä»¥å«æˆ‘å°æ™ºğŸ¤–ï¼Œå¾ˆé«˜å…´è§åˆ°ä½ ï¼Œæ¬¢è¿é—®æˆ‘ä»»ä½•é—®é¢˜ã€‚', role='assistant', tool_calls=None)
```

* chat.completions.createå‡½æ•°å…¨å‚æ•°è§£é‡Š

â€ƒâ€ƒæ¥ä¸‹æ¥å›´ç»•chat.completions.createå‡½æ•°çš„å…¨éƒ¨å‚æ•°è¿›è¡Œè§£é‡Šï¼š

| å‚æ•°åç§°     | ç±»å‹     | æ˜¯å¦å¿…å¡« | å‚æ•°è§£é‡Š      |
| -------- | ------ | ---- | --------- |
| model    | String | æ˜¯    | æ‰€è¦è°ƒç”¨çš„æ¨¡å‹ç¼–ç  |
| messages | List   |      |           |



ğŸ“**æ›´å¤šå¤§æ¨¡å‹æŠ€æœ¯å†…å®¹å­¦ä¹ **

**æ‰«ç æ·»åŠ åŠ©ç†è‹±è‹±ï¼Œå›å¤â€œå¤§æ¨¡å‹â€ï¼Œäº†è§£æ›´å¤šå¤§æ¨¡å‹æŠ€æœ¯è¯¦æƒ…å“¦ğŸ‘‡**

![](images/f339b04b7b20233dd1509c7fb36d5c0.png)

æ­¤å¤–ï¼Œ**æ‰«ç å›å¤â€œå…¥ç¾¤â€**ï¼Œå³å¯åŠ å…¥**å¤§æ¨¡å‹æŠ€æœ¯ç¤¾ç¾¤ï¼šæµ·é‡ç¡¬æ ¸ç‹¬å®¶æŠ€æœ¯`å¹²è´§å†…å®¹`+æ— é—¨æ§›`æŠ€æœ¯äº¤æµ`ï¼**
