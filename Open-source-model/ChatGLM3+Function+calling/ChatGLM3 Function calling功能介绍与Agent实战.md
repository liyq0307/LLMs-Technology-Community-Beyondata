â€ƒâ€ƒåœ¨æœ¬æ¬¡ChatGLM3æ›´æ–°ä¸­ï¼Œé‡ç£…æ›´æ–°äº†Function callingåŠŸèƒ½ï¼Œè¯¥åŠŸèƒ½çš„åŠ å…¥ä¹Ÿä½¿å¾—ChatGLM3æ¨¡å‹æ­£å¼æ¥è½¨AI Agentå¼€å‘ã€‚ç›¸å…³åŸºç¡€æ¦‚å¿µä»‹ç»è¯¦è§å…¬å¼€è¯¾ï¼š[ChatGLM3å…¨æ–°Function callingåŠŸèƒ½è¯¦è§£ï¼å¼€å¯AI Agentä¹‹è·¯çš„æœ€æ ¸å¿ƒåŠŸèƒ½ï¼](https://www.bilibili.com/video/BV1K94y157gd/)

![](images/38985956-02eb-4b10-bd17-91ab1ef2b5da.png)

* Function callingåŠŸèƒ½ç®€ä»‹

â€ƒâ€ƒOpenAIåœ¨0613çš„æ›´æ–°ä¸­é¦–æ¬¡ä¸ºç›®å‰æœ€å…ˆè¿›çš„Chatç±»æ¨¡å‹å¢åŠ äº†Function callingåŠŸèƒ½ï¼Œè¯¥åŠŸèƒ½çš„æœ¬è´¨æ˜¯è®©å¤§è¯­è¨€æ¨¡å‹è°ƒç”¨å¤–éƒ¨å‡½æ•°çš„èƒ½åŠ›ï¼Œå³Chatæ¨¡å‹å¯ä»¥ä¸å†ä»…ä»…æ ¹æ®è‡ªèº«çš„æ•°æ®åº“çŸ¥è¯†è¿›è¡Œå›ç­”ï¼Œè€Œæ˜¯å¯ä»¥é¢å¤–æŒ‚è½½ä¸€ä¸ªå‡½æ•°åº“ï¼Œç„¶åæ ¹æ®ç”¨æˆ·æé—®è¿›è¡Œå‡½æ•°åº“æ£€ç´¢ï¼Œæ ¹æ®å®é™…éœ€æ±‚è°ƒç”¨å¤–éƒ¨å‡½æ•°å¹¶è·å–å‡½æ•°è¿è¡Œç»“æœï¼Œå†åŸºäºå‡½æ•°è¿è¡Œç»“æœè¿›è¡Œå›ç­”ã€‚å…¶åŸºæœ¬è¿‡ç¨‹å¦‚ä¸‹ï¼š

![](images/7f6f3061-a4bf-42db-a496-8bcd929456f4.png)

è€Œè¿™ä¸ªå¤–éƒ¨æŒ‚è½½çš„å‡½æ•°åº“ï¼Œå¯ä»¥æ˜¯ç®€å•çš„è‡ªå®šä¹‰å‡½æ•°ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå°è£…äº†å¤–éƒ¨å·¥å…·APIçš„åŠŸèƒ½å‹å‡½æ•°ï¼ˆä¾‹å¦‚ä¸€ä¸ªå¯ä»¥è°ƒç”¨è°·æ­Œæœç´¢çš„å‡½æ•°ã€æˆ–è€…ä¸€ä¸ªå¯ä»¥è·å–å¤©æ°”ä¿¡æ¯çš„å‡½æ•°ï¼‰ã€‚è€Œåœ¨OpenAIçš„ç²¾å¦™è®¾è®¡ä¸‹ï¼ŒFunction callingåŠŸèƒ½çš„å®ç°è¿‡ç¨‹ä¹Ÿå¹¶ä¸å¤æ‚ï¼Œåœ¨ç¼–å†™é—®ç­”å‡½æ•°æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨ChatCompletions.createå‡½æ•°ä¸­è¿›è¡Œå‚æ•°è®¾ç½®ã€å¹¶æå‰å®šä¹‰å¥½å¤–éƒ¨å‡½æ•°åº“å³å¯ï¼Œè€Œåœ¨Chatæ¨¡å‹æ‰§è¡ŒFunction callingæ—¶ï¼Œæ¨¡å‹ä¼šæ ¹æ®ç”¨æˆ·æé—®çš„è¯­ä¹‰è‡ªåŠ¨æ£€ç´¢å¹¶æŒ‘é€‰åˆé€‚çš„å‡½æ•°è¿›è¡Œä½¿ç”¨ï¼Œæ•´ä¸ªè¿‡ç¨‹å¹¶ä¸éœ€è¦äººå·¥æ‰‹åŠ¨å¹²é¢„æŒ‡å®šä½¿ç”¨æŸä¸ªå‡½æ•°ï¼Œå¤§é¢„è¨€æ¨¡å‹èƒ½å¤Ÿå……åˆ†å‘æŒ¥è‡ªèº«çš„è¯­ä¹‰ç†è§£ä¼˜åŠ¿ï¼Œåœ¨å‡½æ•°åº“ä¸­è‡ªåŠ¨æŒ‘é€‰åˆé€‚å‡½æ•°è¿›è¡Œè¿è¡Œï¼Œå¹¶ç»™å‡ºé—®é¢˜çš„ç­”æ¡ˆã€‚

â€ƒâ€ƒæ¯«æ— ç–‘é—®ï¼Œæœ‰äº†å¤–éƒ¨å‡½æ•°åº“çš„åŠŸèƒ½åŠ æŒï¼ŒChatæ¨¡å‹çš„å¤„ç†å’Œè§£å†³é—®é¢˜çš„èƒ½åŠ›ä¹Ÿå¿…å°†å†ä¸Šä¸€ä¸ªå°é˜¶ã€‚åŒæ—¶ï¼Œç›¸æ¯”äºæ­¤å‰å¿…é¡»å€ŸåŠ©LangChainçš„agentæ¨¡å—æ‰èƒ½å®ç°LLMå’Œå¤–éƒ¨å·¥å…·APIçš„ååŒè°ƒç”¨ï¼Œç°åœ¨Chatæ¨¡å‹å†…éƒ¨é›†æˆçš„Function callingåŠŸèƒ½å®ç°è¿‡ç¨‹æ›´ç®€å•ã€å¼€å‘é—¨æµç¨‹æ›´åŠ æ¸…æ™°ã€å¼€å‘æ§›æ›´ä½ï¼Œè€Œå¦‚æ­¤ç§ç§ï¼Œä¹Ÿå¿…å°†ä¿ƒè¿›æ–°ä¸€è½®çš„ä»¥å¤§è¯­è¨€æ¨¡å‹ä¸ºæ ¸å¿ƒçš„AIåº”ç”¨çš„çˆ†å‘ã€‚

![](images/fd237f9a-e994-45a3-81fb-01ede92d5a44.png)

* æç®€AIåº”ç”¨å¼€å‘ç¤ºä¾‹

![](images/e9231439-c345-4a18-8a8b-cd18876d0713.png)

â€ƒâ€ƒå½“ç„¶ï¼Œä¸€ä¸ªå¼€æ”¾çš„å¤©æ°”æŸ¥è¯¢APIï¼Œä¹Ÿæ„å‘³ç€æˆ‘ä»¬å¯ä»¥å°†å…¶å°è£…ä¸ºä¸€ä¸ªæœ¬åœ°çš„å‡½æ•°ï¼Œå³é€šè¿‡è°ƒç”¨OpenWeather APIæ¥è·å–å®æ—¶å¤©æ°”ä¿¡æ¯ï¼Œç„¶åå†ç”¨Function callingåŠŸèƒ½è°ƒç”¨è¯¥å‡½æ•°ï¼Œå¦‚æ­¤ä¸€æ¥ï¼Œå°±ç›¸å½“äºç»™Chatæ¨¡å‹å¢åŠ äº†å®æ—¶è·å–å¤©æ°”ä¿¡æ¯çš„èƒ½åŠ›ï¼Œè€Œåæˆ‘ä»¬å³å¯é€šè¿‡Chatæ¨¡å‹å®æ—¶æŸ¥è¯¢å¤©æ°”æˆ–æ ¹æ®å¤©æ°”æƒ…å†µè¯¢é—®ç©¿è¡£å»ºè®®ç­‰ï¼Œä»åŠŸèƒ½ä¸Šæ¥è¯´ï¼Œæ¥å…¥å®æ—¶å¤©æ°”ä¿¡æ¯çš„Chatæ¨¡å‹å…¶å®ä¹Ÿå°±æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„å¤©æ°”æŸ¥è¯¢AIåŠ©æ‰‹ã€‚è¿™æ˜¯ä¸€ä¸ªç›¸å¯¹ç®€å•çš„å°†å…¶ä»–å·¥å…·APIæ¥å…¥Chatæ¨¡å‹çš„ç¤ºä¾‹ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä»‹ç»å…·ä½“å®ç°æ–¹æ³•ã€‚

### Stage 1ã€è·å–APIï¼šOpenWeatheræ³¨å†ŒåŠAPI keyè·å–æ–¹æ³•

#### 1.APIè·å–æµç¨‹

â€ƒâ€ƒä¸ºäº†èƒ½å¤Ÿè°ƒç”¨OpenWeatheræœåŠ¡ï¼Œå’ŒOpenAIçš„APIä½¿ç”¨è¿‡ç¨‹ç±»ä¼¼ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦å…ˆæ³¨å†ŒOpenWeatherè´¦å·ï¼Œå¹¶è·å–OpenWeather API Keyã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹äºå¤§å¤šæ•°åœ¨çº¿æœåŠ¡çš„APIæ¥è¯´ï¼Œéƒ½éœ€è¦é€šè¿‡API keyæ¥è¿›è¡Œèº«ä»½éªŒè¯ï¼Œå°½ç®¡OpenWeatherç›¸å¯¹æ›´åŠ Openï¼Œæœ‰éå¸¸å¤šçš„å…è´¹ä½¿ç”¨çš„æ¬¡æ•°ï¼Œä½†èº«ä»½éªŒè¯ä»ç„¶æ˜¯å¿…è¦çš„é˜²æ­¢APIè¢«æ»¥ç”¨çš„æœ‰æ•ˆæ‰‹æ®µã€‚OpenWeather API keyè·å–æµç¨‹å¦‚ä¸‹ï¼š

* Step 1.ç™»å½•OpenWeatherå®˜ç½‘å¹¶ç‚¹å‡»Signâ€”>create accountå®Œæˆæ³¨å†Œã€‚è¯¥ç½‘ç«™æ— éœ€é­”æ³•å³å¯ç›´æ¥ç™»å½•ï¼Œå¯ä»¥ä½¿ç”¨å›½å†…é‚®ç®±æˆ–è€…QQé‚®ç®±å‡å¯è¿›è¡Œæ³¨å†Œï¼Œå®˜ç½‘åœ°å€ä¸ºï¼šhttps://openweathermap.org/

![](images/c07a0327-f8e7-4b6f-b270-6c7b564fd264.png)

&#x20;

![](images/8e630886-6139-44c7-90c6-2945f3fce4c6.png)

* Step 2.è·å–API-keyï¼šæ³¨å†Œå®Œæˆåï¼Œå³å¯åœ¨API keysé¡µé¢æŸ¥çœ‹å½“å‰è´¦æˆ·çš„API keyï¼š

![](images/abbffa40-e351-4967-9fcb-9460c6534cb2.png)

&#x20;

![](images/bd67ed72-9ea1-4ac4-a97f-f486d18bec8b.png)

ä¸€èˆ¬æ¥è¯´å®Œæˆæ³¨å†Œåï¼Œå°±ä¼šæœ‰ä¸€ä¸ªå·²ç»æ¿€æ´»çš„API-keyã€‚å’ŒOpenAIä¸€æ ·ï¼ŒOpenWeatherçš„API keyä¹Ÿåˆ›å»ºå¤šä¸ªã€‚

* Step 3.å°†å…¶è®¾ç½®ä¸ºç¯å¢ƒå˜é‡ï¼šå’ŒOpenAI API keyç±»ä¼¼ï¼Œä¸ºäº†æ–¹ä¾¿åç»­è°ƒç”¨ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥å°†OpenWeather API keyè®¾ç½®ä¸ºç¯å¢ƒå˜é‡ï¼Œå˜é‡åä¸ºOPENWEATHER\_API\_KEYã€‚å…·ä½“è®¾ç½®ç¯å¢ƒå˜é‡çš„æ–¹æ³•å‚è€ƒCh.1ä¸­OpenAI APkeyè®¾ç½®ç¯å¢ƒå˜é‡æµç¨‹ï¼Œæ­¤å¤„ä¸å†èµ˜è¿°ã€‚

![](images/9306bdfc-0e3d-4249-b8a2-d15b1f03afc3.png)

è®¾ç½®å®Œäº†ç¯å¢ƒå˜é‡ä¹‹åï¼Œæ¥ä¸‹æ¥å³å¯æŒ‰ç…§å¦‚ä¸‹æ–¹å¼åˆ›å»ºOpenWeather API keyå˜é‡ï¼š

```python
open_weather_key = os.getenv("OPENWEATHER_API_KEY")
```

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸€èˆ¬æ¥è¯´é¦–æ¬¡æ³¨å†Œç”¨æˆ·ï¼Œé¦–ä¸ªAPI keyéœ€è¦ç­‰å¾…2-5å°æ—¶æ‰ä¼šè¢«æ¿€æ´»ï¼Œåœ¨æ­¤æœŸé—´ä½¿ç”¨è¯¥API keyä¼šè¿”å›401é”™è¯¯ã€‚

#### 1.2 APIä½¿ç”¨æµç¨‹ï¼šåˆ©ç”¨OpenWeather APIè·å–å®æ—¶å¤©æ°”ä¿¡æ¯

â€ƒâ€ƒæ¥ä¸‹æ¥æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œæ¥ä»‹ç»å¦‚ä½•é€šè¿‡OpenWeather APIè·å–å®æ—¶å¤©æ°”ä¿¡æ¯ï¼š

```python
import requests

# Step 1.æ„å»ºè¯·æ±‚
url = "https://api.openweathermap.org/data/2.5/weather"

# Step 2.è®¾ç½®æŸ¥è¯¢å‚æ•°
params = {
    "q": "Beijing",               # æŸ¥è¯¢åŒ—äº¬å®æ—¶å¤©æ°”
    "appid": open_weather_key,    # è¾“å…¥API key
    "units": "metric",            # ä½¿ç”¨æ‘„æ°åº¦è€Œä¸æ˜¯åæ°åº¦
    "lang":"zh_cn"                # è¾“å‡ºè¯­è¨€ä¸ºç®€ä½“ä¸­æ–‡
}

# Step 3.å‘é€GETè¯·æ±‚
response = requests.get(url, params=params)

# Step 4.è§£æå“åº”
data = response.json()
```

è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒåŸå¸‚åå¿…é¡»è¾“å…¥è‹±æ–‡åï¼Œå¦åˆ™æ— æ³•æ­£ç¡®è¯†åˆ«ã€‚æ¥ä¸‹æ¥æŸ¥çœ‹è¿”å›ç»“æœã€‚é¦–å…ˆæˆ‘ä»¬å…ˆæŸ¥çœ‹responseç»“æœï¼š

```python
response
```

```plaintext
<Response [200]>
```

```python
type(response)
```

```plaintext
requests.models.Response
```

åœ¨æœªè§£æä¹‹å‰ï¼Œæˆ‘ä»¬åªèƒ½æŸ¥çœ‹åˆ°åŸºæœ¬è¯·æ±‚ç»“æœçŠ¶æ€ï¼Œè¿™é‡Œçš„200ä»£è¡¨æˆåŠŸç›¸åº”ï¼Œå³æœ¬æ¬¡å‘é€è¯·æ±‚è·å¾—äº†å¯¹åº”çš„å“åº”ï¼Œä¸”å“åº”å†…å®¹åŒ…å«åœ¨responseä¸­ã€‚è€ƒè™‘åˆ°é»˜è®¤æƒ…å†µä¸‹è¿”å›ç»“æœæ˜¯JSONæ ¼å¼ï¼Œå› æ­¤åç»­ä»£ç ä½¿ç”¨äº†response.json()å¯¹å…¶è¿›è¡Œè§£æã€‚è§£æå†…å®¹å¦‚ä¸‹ï¼š

```python
data
```

```plaintext
{'coord': {'lon': 116.3972, 'lat': 39.9075},
 'weather': [{'id': 800, 'main': 'Clear', 'description': 'æ™´', 'icon': '01n'}],
 'base': 'stations',
 'main': {'temp': 16.94,
  'feels_like': 15.58,
  'temp_min': 16.94,
  'temp_max': 16.94,
  'pressure': 1011,
  'humidity': 34,
  'sea_level': 1011,
  'grnd_level': 1005},
 'visibility': 10000,
 'wind': {'speed': 1.89, 'deg': 163, 'gust': 2.63},
 'clouds': {'all': 1},
 'dt': 1698833916,
 'sys': {'type': 1,
  'id': 9609,
  'country': 'CN',
  'sunrise': 1698792140,
  'sunset': 1698830013},
 'timezone': 28800,
 'id': 1816670,
 'name': 'Beijing',
 'cod': 200}
```

èƒ½å¤Ÿçœ‹å‡ºï¼Œè¿”å›ç»“æœéå¸¸ä¸°å¯Œï¼ŒåŒ…å«äº†å¤©æ°”æ¡ä»¶ã€æ¸©åº¦ã€æ¹¿åº¦ã€é£é€Ÿã€å¤©æ°”æè¿°ç­‰ä¿¡æ¯ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥ç®€å•æŸ¥çœ‹å½“å‰å¤©æ°”ä¸­çš„å³æ—¶æ¸©åº¦å’Œå¤©æ°”çŠ¶å†µï¼š

```python
# å³æ—¶æ¸©åº¦æœ€é«˜ã€æœ€ä½æ°”æ¸©
data['main']['temp_min'], data['main']['temp_max']
```

```plaintext
(16.94, 16.94)
```

```python
# å¤©æ°”çŠ¶å†µ
data['weather'][0]['description']
```

```plaintext
'æ™´'
```

å¯¹æ¯”æ‰‹æœºæŸ¥çœ‹çš„å¤©æ°”ä¿¡æ¯ä¸éš¾å‘ç°ï¼ŒOpenWeatheræä¾›çš„å¤©æ°”ä¿¡æ¯éå¸¸å‡†ç¡®ã€‚

### Stage 2ã€ç¼–å†™å¤–éƒ¨å‡½æ•°

* å®æ—¶å¤©æ°”ä¿¡æ¯è·å–å‡½æ•°ç¼–å†™

â€ƒâ€ƒæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°è¯•ç¼–å†™ä¸€ä¸ªé€šè¿‡OpenWeather APIå®æ—¶è·å–å¤©æ°”ä¿¡æ¯çš„APIï¼Œå¹¶ä½œä¸ºChatå¯è°ƒç”¨çš„å¤–éƒ¨å‡½æ•°ä¹‹ä¸€ã€‚å¾ˆæ˜æ˜¾ï¼Œä¸ºäº†ç¡®ä¿å’Œå¤§è¯­è¨€æ¨¡å‹ä¹‹é—´çš„é¡ºç•…é€šä¿¡ï¼Œæ­¤æ—¶è¦æ±‚å‡½æ•°çš„è¾“å…¥å’Œè¾“å‡ºéƒ½æ˜¯å­—ç¬¦ä¸²æ ¼å¼ã€‚å…·ä½“å‡½æ•°ç¼–å†™å¦‚ä¸‹ï¼š

```python
def get_weather(loc):
    """
    æŸ¥è¯¢å³æ—¶å¤©æ°”å‡½æ•°
    :param loc: å¿…è¦å‚æ•°ï¼Œå­—ç¬¦ä¸²ç±»å‹ï¼Œç”¨äºè¡¨ç¤ºæŸ¥è¯¢å¤©æ°”çš„å…·ä½“åŸå¸‚åç§°ï¼Œ\
    æ³¨æ„ï¼Œä¸­å›½çš„åŸå¸‚éœ€è¦ç”¨å¯¹åº”åŸå¸‚çš„è‹±æ–‡åç§°ä»£æ›¿ï¼Œä¾‹å¦‚å¦‚æœéœ€è¦æŸ¥è¯¢åŒ—äº¬å¸‚å¤©æ°”ï¼Œåˆ™locå‚æ•°éœ€è¦è¾“å…¥'Beijing'ï¼›
    :returnï¼šOpenWeather APIæŸ¥è¯¢å³æ—¶å¤©æ°”çš„ç»“æœï¼Œå…·ä½“URLè¯·æ±‚åœ°å€ä¸ºï¼šhttps://api.openweathermap.org/data/2.5/weather\
    è¿”å›ç»“æœå¯¹è±¡ç±»å‹ä¸ºè§£æä¹‹åçš„JSONæ ¼å¼å¯¹è±¡ï¼Œå¹¶ç”¨å­—ç¬¦ä¸²å½¢å¼è¿›è¡Œè¡¨ç¤ºï¼Œå…¶ä¸­åŒ…å«äº†å…¨éƒ¨é‡è¦çš„å¤©æ°”ä¿¡æ¯
    """
    # Step 1.æ„å»ºè¯·æ±‚
    url = "https://api.openweathermap.org/data/2.5/weather"

    # Step 2.è®¾ç½®æŸ¥è¯¢å‚æ•°
    params = {
        "q": loc,               
        "appid": open_weather_key,    # è¾“å…¥API key
        "units": "metric",            # ä½¿ç”¨æ‘„æ°åº¦è€Œä¸æ˜¯åæ°åº¦
        "lang":"zh_cn"                # è¾“å‡ºè¯­è¨€ä¸ºç®€ä½“ä¸­æ–‡
    }

    # Step 3.å‘é€GETè¯·æ±‚
    response = requests.get(url, params=params)
    
    # Step 4.è§£æå“åº”
    data = response.json()
    return json.dumps(data)
```

ç®€å•æµ‹è¯•å‡½æ•°èƒ½å¦æ­£å¸¸è¿è¡Œï¼š

```python
get_weather('Hangzhou')
```

```plaintext
'{"coord": {"lon": 120.1614, "lat": 30.2937}, "weather": [{"id": 501, "main": "Rain", "description": "\\u4e2d\\u96e8", "icon": "10d"}], "base": "stations", "main": {"temp": 30.27, "feels_like": 37.27, "temp_min": 25.95, "temp_max": 31.62, "pressure": 992, "humidity": 80}, "visibility": 9927, "wind": {"speed": 2.88, "deg": 30, "gust": 5.2}, "rain": {"1h": 2.73}, "clouds": {"all": 89}, "dt": 1689499325, "sys": {"type": 2, "id": 2033711, "country": "CN", "sunrise": 1689455265, "sunset": 1689505351}, "timezone": 28800, "id": 1808926, "name": "Hangzhou", "cod": 200}'
```

èƒ½å¤Ÿå‘ç°å‡½æ•°èƒ½å¤Ÿæ­£å¸¸è¿è¡Œã€‚æ­¤å¤–ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸ºäº†ç¡®ä¿å‡½æ•°èƒ½å¤Ÿé¡ºåˆ©å’Œå¤§æ„¿ä¸ä½ æ¨¡å‹é€šä¿¡ï¼Œæˆ‘ä»¬è¿˜å¿…é¡»ç¡®ä¿æ¨¡å‹èƒ½å¤Ÿé¡ºåˆ©è§£è¯»OpenWeatherå¤©æ°”ä¿¡æ¯ï¼Œå…·ä½“éªŒè¯è¿‡ç¨‹åˆ†ä»¥ä¸‹ä¸‰æ­¥ï¼Œå…¶ä¸€æ˜¯éœ€è¦éªŒè¯Chatæ¨¡å‹æœ¬èº«æ˜¯å¦çŸ¥é“OpenWeatherï¼š

```python
response = openai.ChatCompletion.create(
    model="chatglm3-6b",
    messages=[
        {"role": "user", "content": "è¯·é—®ä½ çŸ¥é“OpenWeatherä¹ˆï¼Ÿ"}, 
    ]
)
```

```python
response['choices'][0]['message']["content"]
```

```plaintext
'\n OpenWeatheræ˜¯ä¸€ä¸ªæ°”è±¡æ•°æ®æä¾›å•†,æä¾›å…¨çƒå¤©æ°”é¢„æŠ¥å’Œå†å²æ•°æ®ã€‚å®ƒçš„æ•°æ®è¦†ç›–äº†è¶…è¿‡190å›½å®¶å’Œåœ°åŒº,å¹¶ä¸”å¯ä»¥ä»¥å¤šç§æ ¼å¼(å¦‚JSONã€XMLå’ŒHTML)ä¾›å¼€å‘è€…ä½¿ç”¨ã€‚é€šè¿‡OpenWeather,äººä»¬å¯ä»¥è½»æ¾åœ°ä»è‡ªå·±çš„åº”ç”¨ç¨‹åºæˆ–ç½‘ç«™ä¸­è·å–æœ€æ–°çš„å¤©æ°”ä¿¡æ¯ã€‚'
```

å…¶äºŒæ˜¯éœ€è¦è¿›ä¸€æ­¥éªŒè¯Chatæ¨¡å‹èƒ½å¦é’ˆå¯¹å‡½æ•°ç»“æœè¿›è¡Œè§£è¯»ï¼Œå³èƒ½å¦åœ¨åŸºäºdataä¿¡æ¯ç†è§£åŸºç¡€ä¸Šï¼Œç»™å‡ºä¸€äº›å¤©æ°”æŸ¥è¯¢é—®é¢˜å‡†ç¡®çš„å›ç­”ï¼š

```python
response = openai.ChatCompletion.create(
  model="chatglm3-6b",
  messages=[
    {"role": "system", "content": "å¤©æ°”ä¿¡æ¯æ¥æºäºOpenWeather APIï¼šhttps://api.openweathermap.org/data/2.5/weather"},
    {"role": "system", "content": "è¿™æ˜¯ä»Šæ—¥æ­å·å¸‚çš„å¤©æ°”ï¼š%s" % data},
    {"role": "user", "content": "è¯·é—®ä»Šæ—¥æ­å·å¤©æ°”å¦‚ä½•ï¼Ÿè¯·ç”¨ç®€ä½“ä¸­æ–‡å›ç­”"}
  ]
)
response.choices[0].message['content']
```

```plaintext
'\n ä»Šå¤©æ˜¯2023å¹´6æœˆ1æ—¥ï¼Œæ­å·å¸‚çš„å¤©æ°”æƒ…å†µå¦‚ä¸‹ï¼š\n\n1. å¤©æ°”ï¼šæ™´ï¼Œæ°”æ¸©çº¦ä¸º23.95æ‘„æ°åº¦ï¼›\n2. ç›¸å¯¹æ¹¿åº¦ï¼š47%ï¼Œä½“æ„Ÿæ¸©åº¦ä¸º23.63æ‘„æ°åº¦ï¼›\n3. æ°”å‹ï¼š1018ç™¾å¸•æ–¯å¡ï¼›\n4. é£é€Ÿï¼š2.72ç±³/ç§’ï¼Œé£å‘ä¸ºåŒ—åè¥¿æ–¹å‘ã€‚\n\nè¯·æ³¨æ„é€‚å½“å¢å‡è¡£ç‰©ï¼Œç¥æ‚¨æœ‰ä¸ªæ„‰å¿«çš„ä¸€å¤©ï¼'
```

èƒ½å¤Ÿå‘ç°æ¨¡å‹èƒ½å¤Ÿç†è§£OpenWeatherè¿”å›ç»“æœï¼Œå¹¶æ ¹æ®æé—®å¯¹dataè¿›è¡Œæ€»ç»“å¹¶è¿›è¡Œå›ç­”ã€‚

ç¬¬ä¸‰æ­¥ï¼Œä¹Ÿæ˜¯éå¸¸å…³é”®çš„ä¸€æ­¥ï¼Œå°±æ˜¯æˆ‘ä»¬åœ¨è¿›è¡Œæé—®æ—¶é—®é¢˜é‡Œé¢çš„åŸå¸‚åç§°è‚¯å®šæ˜¯ä¸­æ–‡ï¼Œä½†OpenAIWeather APIè¦æ±‚è¾“å…¥è‹±æ–‡åç§°ï¼Œå°½ç®¡æˆ‘ä»¬åœ¨å‡½æ•°å‚æ•°è¯´æ˜ä¸­æ³¨æ˜äº†locå‡½æ•°éœ€è¦è½¬åŒ–æˆè‹±æ–‡ï¼Œä½†å¯¹äºå¤–éƒ¨å‡½æ•°çš„å‚æ•°æ•´ç†æ˜¯Chatæ¨¡å‹è‡ªå‘è¿›è¡Œçš„æ•´ç†ï¼Œå¤–éƒ¨æ— æ³•å¹²é¢„ï¼Œæ¨¡å‹èƒ½å¦æŒ‰ç…§è¦æ±‚ã€åœ¨å¯¹è¯è¿‡ç¨‹ä¸­æå–å‚æ•°å¹¶å°†å…¶æ•´ç†ä¸ºæŒ‡å®šæ ¼å¼ï¼Œå®Œå…¨ä¾èµ–æ¨¡å‹è‡ªèº«çš„æ¨ç†èƒ½åŠ›ï¼Œå› æ­¤è¿™é‡Œæˆ‘ä»¬éœ€è¦æ£€æŸ¥æ¨¡å‹æœ¬èº«æ˜¯å¦çŸ¥é“ä¸­æ–‡è¾“å…¥çš„è¿™äº›åŸå¸‚åç§°å¯¹åº”çš„è‹±æ–‡åç§°ï¼ŒéªŒè¯è¿‡ç¨‹å¦‚ä¸‹ï¼š

```python
response = openai.ChatCompletion.create(
  model="chatglm3-6b",
  messages=[
    {"role": "user", "content": "è¯·é—®ï¼Œæ­å·å¸‚çš„è‹±æ–‡åç§°æ˜¯ï¼Ÿ"}
  ]
)
response.choices[0].message['content']
```

```plaintext
'\n æ­å·å¸‚çš„è‹±æ–‡åç§°æ˜¯ Hangzhouã€‚'
```

å‘ç°æ¨¡å‹èƒ½å¤Ÿé¡ºåˆ©å®ŒæˆåŸå¸‚åç§°çš„ä¸­è‹±æ–‡ç¿»è¯‘ã€‚

æœ€åéœ€è¦åˆ›å»ºget\_weatherå‡½æ•°çš„functionså‚æ•°ï¼š

```python
weather_api_spec = [
    {
        'name': 'get_weather',
        'description': 'æŸ¥è¯¢å³æ—¶å¤©æ°”å‡½æ•°ï¼Œæ ¹æ®è¾“å…¥çš„åŸå¸‚åç§°ï¼ŒæŸ¥è¯¢å¯¹åº”åŸå¸‚çš„å®æ—¶å¤©æ°”',
        'parameters': {
            'type': 'object',
            'properties': {
                'loc': {
                    'description': "åŸå¸‚åç§°ï¼Œæ³¨æ„ï¼Œä¸­å›½çš„åŸå¸‚éœ€è¦ç”¨å¯¹åº”åŸå¸‚çš„è‹±æ–‡åç§°ä»£æ›¿ï¼Œä¾‹å¦‚å¦‚æœéœ€è¦æŸ¥è¯¢åŒ—äº¬å¸‚å¤©æ°”ï¼Œåˆ™locå‚æ•°éœ€è¦è¾“å…¥'Beijing'",
                    'type': 'string',
                    'required': True
                }
            }
        }
    }
]
```

### Stage 3ã€å®æ—¶å¤©æ°”æŸ¥è¯¢åŠŸèƒ½çš„Function callingå®ç°

â€ƒâ€ƒåœ¨ä¸€ç³»åˆ—éªŒè¯å·¥ä½œç»“æŸåï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ç›´æ¥å°†è¿™ä¸ªå‡½æ•°æ”¾å…¥å‡½æ•°åº“ï¼ˆå†™å…¥functions\_listå‡½æ•°åˆ—è¡¨ï¼‰ï¼Œç„¶åç›´æ¥å¯åŠ¨å¤–é“¾å‡½æ•°åº“ä¹‹åçš„å¤šè½®å¯¹è¯æœºå™¨äººchat\_with\_modelï¼ŒæŸ¥çœ‹å¯¹è¯æ•ˆæœã€‚

```python
system_info = {
    "role": "system",
    "content": "Answer the following questions as best as you can. You have access to the following tools:",
    "tools": weather_api_spec,
}
```

```python
system_info
```

```plaintext
{'role': 'system',
 'content': 'Answer the following questions as best as you can. You have access to the following tools:',
 'tools': [{'name': 'get_weather',
   'description': 'æŸ¥è¯¢å³æ—¶å¤©æ°”å‡½æ•°ï¼Œæ ¹æ®è¾“å…¥çš„åŸå¸‚åç§°ï¼ŒæŸ¥è¯¢å¯¹åº”åŸå¸‚çš„å®æ—¶å¤©æ°”',
   'parameters': {'type': 'object',
    'properties': {'loc': {'description': "åŸå¸‚åç§°ï¼Œæ³¨æ„ï¼Œä¸­å›½çš„åŸå¸‚éœ€è¦ç”¨å¯¹åº”åŸå¸‚çš„è‹±æ–‡åç§°ä»£æ›¿ï¼Œä¾‹å¦‚å¦‚æœéœ€è¦æŸ¥è¯¢åŒ—äº¬å¸‚å¤©æ°”ï¼Œåˆ™locå‚æ•°éœ€è¦è¾“å…¥'Beijing'",
      'type': 'string',
      'required': True}}}}]}
```

```python
messages = [
        system_info,
        {
            "role": "user",
            "content": "è¯·é—®ä»Šå¤©åŒ—äº¬å¤©æ°”å¦‚ä½•ï¼Ÿ",
        }
    ]
```

```python
# first response
response = openai.ChatCompletion.create(
                model="chatglm3-6b",
                messages=messages,
                return_function_call=True)
```

```python
response_message = response["choices"][0]["message"]
```

```python
response_message
```

```plaintext
<OpenAIObject at 0x7fd3d4a58360> JSON: {
  "role": "assistant",
  "content": "{\"name\": \"get_weather\", \"parameters\": {\"loc\": \"Beijing\"}}",
  "metadata": null,
  "tools": null
}
```

```python
function_call = json.loads(response.choices[0].message.content)
```

```python
function_call
```

```plaintext
{'name': 'get_weather', 'parameters': {'loc': 'Beijing'}}
```

```python
# éœ€è¦è°ƒç”¨å¤–éƒ¨å‡½æ•°
# è·å–å‡½æ•°å
function_name = function_call["name"]
function_name
```

```plaintext
'get_weather'
```

```python
functions_list = [get_weather]
available_functions = {func.__name__: func for func in functions_list}
```

```python
available_functions
```

```plaintext
{'get_weather': <function __main__.get_weather(loc)>}
```

```python
# è·å–å‡½æ•°å¯¹è±¡
fuction_to_call = available_functions[function_name]
fuction_to_call
```

```plaintext
<function __main__.get_weather(loc)>
```

```python
# è·å–å‡½æ•°å‚æ•°
function_args = function_call['parameters']
function_args
```

```plaintext
{'loc': 'Beijing'}
```

```python
function_response = fuction_to_call(**function_args)
```

```python
# è·å¾—å¤–éƒ¨å‡½æ•°è¿è¡Œç»“æœ
function_response
```

```plaintext
'{"coord": {"lon": 116.3972, "lat": 39.9075}, "weather": [{"id": 800, "main": "Clear", "description": "\\u6674", "icon": "01n"}], "base": "stations", "main": {"temp": 15.94, "feels_like": 14.58, "temp_min": 15.94, "temp_max": 15.94, "pressure": 1012, "humidity": 38, "sea_level": 1012, "grnd_level": 1006}, "visibility": 10000, "wind": {"speed": 2.44, "deg": 148, "gust": 5.48}, "clouds": {"all": 1}, "dt": 1698835768, "sys": {"type": 1, "id": 9609, "country": "CN", "sunrise": 1698792140, "sunset": 1698830013}, "timezone": 28800, "id": 1816670, "name": "Beijing", "cod": 200}'
```

```python
# messagesä¸­æ‹¼æ¥first responseæ¶ˆæ¯
messages.append(response_message)  
# messagesä¸­æ‹¼æ¥å‡½æ•°è¾“å‡ºç»“æœ
messages.append(
    {
        "role": "observation",
        "name": function_name,
        "content": function_response,
    }
)  
```

```python
messages
```

```plaintext
[{'role': 'system',
  'content': 'Answer the following questions as best as you can. You have access to the following tools:',
  'tools': [{'name': 'get_weather',
    'description': 'æŸ¥è¯¢å³æ—¶å¤©æ°”å‡½æ•°ï¼Œæ ¹æ®è¾“å…¥çš„åŸå¸‚åç§°ï¼ŒæŸ¥è¯¢å¯¹åº”åŸå¸‚çš„å®æ—¶å¤©æ°”',
    'parameters': {'type': 'object',
     'properties': {'loc': {'description': "åŸå¸‚åç§°ï¼Œæ³¨æ„ï¼Œä¸­å›½çš„åŸå¸‚éœ€è¦ç”¨å¯¹åº”åŸå¸‚çš„è‹±æ–‡åç§°ä»£æ›¿ï¼Œä¾‹å¦‚å¦‚æœéœ€è¦æŸ¥è¯¢åŒ—äº¬å¸‚å¤©æ°”ï¼Œåˆ™locå‚æ•°éœ€è¦è¾“å…¥'Beijing'",
       'type': 'string',
       'required': True}}}}]},
 {'role': 'user', 'content': 'è¯·é—®ä»Šå¤©åŒ—äº¬å¤©æ°”å¦‚ä½•ï¼Ÿ'},
 <OpenAIObject at 0x7fd3d4a58360> JSON: {
   "role": "assistant",
   "content": "{\"name\": \"get_weather\", \"parameters\": {\"loc\": \"Beijing\"}}",
   "metadata": null,
   "tools": null
 },
 {'role': 'observation',
  'name': 'get_weather',
  'content': '{"coord": {"lon": 116.3972, "lat": 39.9075}, "weather": [{"id": 800, "main": "Clear", "description": "\\u6674", "icon": "01n"}], "base": "stations", "main": {"temp": 15.94, "feels_like": 14.58, "temp_min": 15.94, "temp_max": 15.94, "pressure": 1012, "humidity": 38, "sea_level": 1012, "grnd_level": 1006}, "visibility": 10000, "wind": {"speed": 2.44, "deg": 148, "gust": 5.48}, "clouds": {"all": 1}, "dt": 1698835768, "sys": {"type": 1, "id": 9609, "country": "CN", "sunrise": 1698792140, "sunset": 1698830013}, "timezone": 28800, "id": 1816670, "name": "Beijing", "cod": 200}'}]
```

```python
# ç¬¬äºŒæ¬¡è°ƒç”¨æ¨¡å‹
second_response = openai.ChatCompletion.create(
    model="chatglm3-6b",
    messages=messages,
)  
```

```python
# è·å–æœ€ç»ˆç»“æœ
final_response = second_response["choices"][0]["message"]["content"]
final_response
```

```plaintext
'\n ä»Šå¤©åŒ—äº¬çš„å¤©æ°”æ˜¯æ™´æœ—çš„ï¼Œå½“å‰æ¸©åº¦ä¸º15.94â„ƒï¼Œç›¸å¯¹æ¹¿åº¦ä¸º38%ï¼Œæ°”å‹ä¸º1012ç™¾å¸•æ–¯å¡ã€‚'
```

### Stage 4ã€å‡½æ•°å°è£…ä¸æµ‹è¯•

```python
def run_conv_glm(messages, functions_list=None, functions=None, model="chatglm3-6b", return_function_call=True):
    """
    èƒ½å¤Ÿè‡ªåŠ¨æ‰§è¡Œå¤–éƒ¨å‡½æ•°è°ƒç”¨çš„Chatå¯¹è¯æ¨¡å‹
    :param messages: å¿…è¦å‚æ•°ï¼Œè¾“å…¥åˆ°Chatæ¨¡å‹çš„messageså‚æ•°å¯¹è±¡
    :param functions_list: å¯é€‰å‚æ•°ï¼Œé»˜è®¤ä¸ºNoneï¼Œå¯ä»¥è®¾ç½®ä¸ºåŒ…å«å…¨éƒ¨å¤–éƒ¨å‡½æ•°çš„åˆ—è¡¨å¯¹è±¡
    :param model: Chatæ¨¡å‹ï¼Œå¯é€‰å‚æ•°ï¼Œé»˜è®¤æ¨¡å‹ä¸ºchatglm3-6b
    :returnï¼šChatæ¨¡å‹è¾“å‡ºç»“æœ
    """
    def is_json_string(s):
        try:
            json_object = json.loads(s)
        except ValueError as e:
            return False
        return True

    
    user_messages = messages
    
    # å¦‚æœæ²¡æœ‰å¤–éƒ¨å‡½æ•°åº“ï¼Œåˆ™æ‰§è¡Œæ™®é€šçš„å¯¹è¯ä»»åŠ¡
    if functions_list == None:
        response = openai.ChatCompletion.create(
                        model=model,
                        messages=user_messages,
                        )
        response_message = response["choices"][0]["message"]
        final_response = response_message["content"]
        
    # è‹¥å­˜åœ¨å¤–éƒ¨å‡½æ•°åº“ï¼Œåˆ™éœ€è¦çµæ´»é€‰å–å¤–éƒ¨å‡½æ•°å¹¶è¿›è¡Œå›ç­”
    else:
        # åˆ›å»ºè°ƒç”¨å¤–éƒ¨å‡½æ•°çš„system_message
        system_info = [{
            "role": "system",
            "content": "Answer the following questions as best as you can. You have access to the following tools:",
            "tools": functions,
        }]
        # åˆ›å»ºå¤–éƒ¨å‡½æ•°åº“å­—å…¸
        available_functions = {func.__name__: func for func in functions_list}

        # åˆ›å»ºåŒ…å«ç”¨æˆ·é—®é¢˜çš„message
        messages = system_info + user_messages
        
        # first response
        response = openai.ChatCompletion.create(
                        model=model,
                        messages=messages,
                        return_function_call=return_function_call)
        response_message = response["choices"][0]["message"]

        # åˆ¤æ–­è¿”å›ç»“æœæ˜¯å¦ä¸ºjsonæ ¼å¼å¯¹è±¡ï¼Œå³åˆ¤æ–­æ˜¯å¦éœ€è¦è°ƒç”¨å¤–éƒ¨å‡½æ•°æ¥å›ç­”é—®é¢˜
        if is_json_string(response_message["content"]):
            # éœ€è¦è°ƒç”¨å¤–éƒ¨å‡½æ•°
            function_call = json.loads(response.choices[0].message.content)
            # è·å–å‡½æ•°å
            function_name = function_call["name"]
            # è·å–å‡½æ•°å¯¹è±¡
            fuction_to_call = available_functions[function_name]
            # è·å–å‡½æ•°å‚æ•°
            function_args = function_call['parameters']
            # å°†å‡½æ•°å‚æ•°è¾“å…¥åˆ°å‡½æ•°ä¸­ï¼Œè·å–å‡½æ•°è®¡ç®—ç»“æœ
            function_response = fuction_to_call(**function_args)

            # messagesä¸­æ‹¼æ¥first responseæ¶ˆæ¯
            messages.append(response_message)  
            # messagesä¸­æ‹¼æ¥å‡½æ•°è¾“å‡ºç»“æœ
            messages.append(
                {
                    "role": "observation",
                    "name": function_name,
                    "content": function_response,
                }
            )  
            # ç¬¬äºŒæ¬¡è°ƒç”¨æ¨¡å‹
            second_response = openai.ChatCompletion.create(
                model=model,
                messages=messages,
            )  
            # è·å–æœ€ç»ˆç»“æœ
            final_response = second_response["choices"][0]["message"]["content"]
        else:
            final_response = response_message["content"]
    
    return final_response
```

```python
run_conv_glm([{"role": "user", "content": "è¯·é—®ä»€ä¹ˆæ˜¯æœºå™¨å­¦ä¹ ï¼Ÿ"}])
```

```plaintext
'\n æœºå™¨å­¦ä¹ æ˜¯ä¸€ç§äººå·¥æ™ºèƒ½çš„åˆ†æ”¯ï¼Œæ—¨åœ¨ä½¿è®¡ç®—æœºç¨‹åºé€šè¿‡æ•°æ®å’Œç»éªŒè‡ªåŠ¨æ”¹è¿›å…¶æ€§èƒ½ã€‚æœºå™¨å­¦ä¹ ç®—æ³•å¯ä»¥åˆ†æå¤§é‡æ•°æ®ï¼Œè¯†åˆ«æ¨¡å¼å’Œè§„å¾‹ï¼Œå¹¶æ ¹æ®è¿™äº›ä¿¡æ¯åšå‡ºé¢„æµ‹æˆ–å†³ç­–ï¼Œè€Œä¸éœ€è¦æ˜¾å¼åœ°æŒ‡å®šç¨‹åºæ‰§è¡Œç‰¹å®šä»»åŠ¡ã€‚\n\nåœ¨æœºå™¨å­¦ä¹ ä¸­ï¼Œè®¡ç®—æœºé€šå¸¸è¢«è®­ç»ƒæˆä»è¾“å…¥æ•°æ®ä¸­æå–ç‰¹å¾ï¼Œå¹¶å°†è¿™äº›ç‰¹å¾æ˜ å°„åˆ°è¾“å‡ºç»“æœã€‚ä¾‹å¦‚ï¼Œåœ¨å›¾åƒåˆ†ç±»ä»»åŠ¡ä¸­ï¼Œæœºå™¨å­¦ä¹ ç®—æ³•ä¼šé€šè¿‡è®­ç»ƒå¤§é‡å·²æ ‡è®°çš„å›¾åƒï¼Œæ¥å­¦ä¹ è¯†åˆ«ç‰¹å®šç±»åˆ«çš„å›¾åƒç‰¹å¾ï¼Œå¹¶æœ€ç»ˆå°†æ–°çš„å›¾åƒåˆ†ç±»ä¸ºç›¸åº”çš„ç±»åˆ«ã€‚\n\næœºå™¨å­¦ä¹ çš„åº”ç”¨éå¸¸å¹¿æ³›ï¼ŒåŒ…æ‹¬è¯­éŸ³å’Œå›¾åƒè¯†åˆ«ã€è‡ªç„¶è¯­è¨€å¤„ç†ã€æ¨èç³»ç»Ÿã€æ¸¸æˆAIç­‰ç­‰ã€‚'
```

```python
messages = [{"role": "user", "content": "è¯·é—®åŒ—äº¬ä»Šå¤©å¤©æ°”å¦‚ä½•ï¼Ÿ"}]
run_conv_glm(messages=messages, functions_list=[get_weather], functions=weather_api_spec)
```

```plaintext
'\n æ ¹æ®æ‚¨çš„æŸ¥è¯¢ï¼Œâ€œåŒ—äº¬ä»Šå¤©å¤©æ°”å¦‚ä½•â€ï¼Œæˆ‘è°ƒç”¨äº†åä¸ºâ€œget_weatherâ€çš„APIå‡½æ•°ï¼Œå¹¶ä¼ å…¥äº†å‚æ•°â€œlocâ€ç­‰äºâ€œBeijingâ€ã€‚ç»è¿‡è°ƒç”¨ï¼Œæˆ‘è·å¾—äº†åŒ—äº¬ä»Šå¤©çš„å¤©æ°”æƒ…å†µã€‚æ®APIè¿”å›ç»“æœæ˜¾ç¤ºï¼ŒåŒ—äº¬ä»Šå¤©å¤©æ°”æ™´æœ—ï¼Œæ°”æ¸©æœ€é«˜ä¸º15.94â„ƒï¼Œæœ€ä½ä¸º15.94â„ƒï¼Œæ°”å‹ä¸º1012ç™¾å¸•ï¼Œæ¹¿åº¦ä¸º38%ã€‚åŒæ—¶ï¼ŒAPIè¿˜æä¾›äº†å…¶ä»–ä¸€äº›è¯¦ç»†ä¿¡æ¯ï¼Œå¦‚é£å‘ã€é£é€Ÿã€äº‘é‡ç­‰ã€‚'
```

```python
messages = [{"role": "user", "content": "è¯·é—®æœºå™¨å­¦ä¹ å’Œæ·±åº¦å­¦ä¹ æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"}]
run_conv_glm(messages=messages, functions_list=[get_weather], functions=weather_api_spec)
```

```plaintext
'æœºå™¨å­¦ä¹ å’Œæ·±åº¦å­¦ä¹ éƒ½æ˜¯äººå·¥æ™ºèƒ½é¢†åŸŸçš„æŠ€æœ¯ã€‚å®ƒä»¬ä¹‹é—´çš„ä¸»è¦åŒºåˆ«åœ¨äºæ‰€ä½¿ç”¨çš„ç®—æ³•å’Œæ¨¡å‹ä¸åŒã€‚æœºå™¨å­¦ä¹ æ˜¯ä¸€ç§é€šè¿‡è®­ç»ƒæ•°æ®æ¥è®©è®¡ç®—æœºè‡ªåŠ¨å­¦ä¹ çŸ¥è¯†å’ŒæŠ€èƒ½çš„æ–¹æ³•ï¼Œå®ƒä½¿ç”¨çš„ç®—æ³•é€šå¸¸åŒ…æ‹¬å†³ç­–æ ‘ã€ç¥ç»ç½‘ç»œå’Œæ”¯æŒå‘é‡æœºç­‰ã€‚è€Œæ·±åº¦å­¦ä¹ åˆ™æ˜¯ä¸€ç§ä½¿ç”¨æ·±åº¦ç¥ç»ç½‘ç»œæ¥æ¨¡æ‹Ÿäººè„‘å·¥ä½œåŸç†çš„æ–¹æ³•ï¼Œè¿™ç§æ–¹æ³•å¯ä»¥è‡ªåŠ¨å­¦ä¹ å¤æ‚çš„ç‰¹å¾å’Œæ¨¡å¼ï¼Œå¹¶å¯¹å…¶è¿›è¡Œåˆ†ç±»å’Œé¢„æµ‹ã€‚å› æ­¤ï¼Œæœºå™¨å­¦ä¹ æ›´æ³¨é‡äºæ‰‹å·¥è®¾è®¡ç‰¹å¾å’Œæ¨¡å‹ï¼Œè€Œæ·±åº¦å­¦ä¹ æ›´æ³¨é‡äºä»æ•°æ®ä¸­è‡ªåŠ¨å­¦ä¹ ç‰¹å¾å’Œæ¨¡å‹ã€‚'
```

* åˆ›å»ºå¤šè½®å¯¹è¯å‡½æ•°

```python
def chat_with_glm(question,
                  functions_list=None, 
                  functions=None, 
                  model="chatglm3-6b", 
                  return_function_call=True):
    
    messages = [{"role": "user", "content": question}]
    
    while True:           
        answer = run_conv_glm(messages=messages, 
                              functions_list=functions_list, 
                              functions=functions, 
                              model=model, 
                              return_function_call=return_function_call)
        
        
        print(f"æ¨¡å‹å›ç­”: {answer}")

        # è¯¢é—®ç”¨æˆ·æ˜¯å¦è¿˜æœ‰å…¶ä»–é—®é¢˜
        question = input("æ‚¨è¿˜æœ‰å…¶ä»–é—®é¢˜å—ï¼Ÿ(è¾“å…¥é€€å‡ºä»¥ç»“æŸå¯¹è¯): ")
        if question == "é€€å‡º":
            break

        # è®°å½•ç”¨æˆ·å›ç­”
        messages.append({"role": "assistant", "content": answer})
        messages.append({"role": "user", "content": question})
        
    del messages
```

* å¤šè®ºå¯¹è¯åŠŸèƒ½æµ‹è¯•

```python
chat_with_glm(question="è¯·é—®æ­å·ä»Šå¤©å¤©æ°”å¦‚ä½•ï¼Ÿ", 
              functions_list=[get_weather], 
              functions=weather_api_spec)
```

```plaintext
æ¨¡å‹å›ç­”: 
 æ ¹æ®APIè°ƒç”¨ç»“æœå¯ä»¥çœ‹å‡ºï¼Œä»Šå¤©æ­å·çš„å¤©æ°”æ˜¯æ™´æœ—çš„ï¼Œæ¸©åº¦çº¦ä¸º19.95æ‘„æ°åº¦ï¼Œç›¸å¯¹æ¹¿åº¦ä¸º51%ï¼Œé£å‘ä¸ºåŒ—é£ï¼Œé£åŠ›ä¸º2.1ç±³æ¯ç§’ã€‚å»ºè®®æ‚¨å‡ºé—¨å‰æŸ¥çœ‹æœ€æ–°å¤©æ°”é¢„æŠ¥ï¼Œåšå¥½å‡ºè¡Œå‡†å¤‡ã€‚


æ‚¨è¿˜æœ‰å…¶ä»–é—®é¢˜å—ï¼Ÿ(è¾“å…¥é€€å‡ºä»¥ç»“æŸå¯¹è¯):  é‚£åŒ—äº¬å‘¢ï¼Ÿå¤©æ°”å¦‚ä½•ï¼Ÿ


æ¨¡å‹å›ç­”: 
 åŒ—äº¬ä»Šå¤©çš„å¤©æ°”æƒ…å†µå¦‚ä¸‹ï¼šæ™´æœ—ï¼Œæœ€é«˜æ°”æ¸©ä¸º15.94â„ƒï¼Œæœ€ä½æ°”æ¸©ä¸º14.58â„ƒã€‚ç›¸å¯¹æ¹¿åº¦ä¸º38%ï¼Œé£å‘ä¸ºåŒ—é£ï¼Œé£åŠ›ä¸º2.44ç±³æ¯ç§’ã€‚è¯·æ³¨æ„é€‚æ—¶å¢å‡è¡£ç‰©ï¼Œç¥æ‚¨æœ‰ä¸ªæ„‰å¿«çš„ä¸€å¤©ï¼


æ‚¨è¿˜æœ‰å…¶ä»–é—®é¢˜å—ï¼Ÿ(è¾“å…¥é€€å‡ºä»¥ç»“æŸå¯¹è¯):  åŒ—äº¬æ¯”æ­å·æ›´å†·ä¹ˆï¼Ÿ


æ¨¡å‹å›ç­”: ä»ä»Šå¤©çš„å¤©æ°”æƒ…å†µæ¥çœ‹ï¼ŒåŒ—äº¬çš„æ°”æ¸©æ¯”æ­å·ä½ï¼Œå› æ­¤å¯ä»¥è¯´åŒ—äº¬æ¯”æ­å·æ›´å†·ã€‚ Howeverï¼Œæ°”æ¸©å¹¶ä¸èƒ½å®Œå…¨åæ˜ äººä»¬å¯¹å¤©æ°”çš„æ„Ÿè§‰ï¼Œè¿˜éœ€è¦è€ƒè™‘å…¶ä»–å› ç´ ï¼Œå¦‚ç›¸å¯¹æ¹¿åº¦ã€é£é€Ÿç­‰ã€‚å› æ­¤ï¼Œåœ¨å®é™…å‡ºé—¨æ—¶ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„æ„Ÿè§‰æ¥åˆ¤æ–­å¤©æ°”æ˜¯å¦é€‚å®œã€‚


æ‚¨è¿˜æœ‰å…¶ä»–é—®é¢˜å—ï¼Ÿ(è¾“å…¥é€€å‡ºä»¥ç»“æŸå¯¹è¯):  é€€å‡º
```

* æ¨ç†èƒ½åŠ›æµ‹è¯•

```python
chat_with_glm(question="ä½ å¥½", 
              functions_list=[get_weather], 
              functions=weather_api_spec)
```

```plaintext
æ¨¡å‹å›ç­”: ä½ å¥½ï¼Œè¯·é—®æœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©ä½ çš„å—ï¼Ÿ


æ‚¨è¿˜æœ‰å…¶ä»–é—®é¢˜å—ï¼Ÿ(è¾“å…¥é€€å‡ºä»¥ç»“æŸå¯¹è¯):  è¯·é—®å—æ˜Œä»Šå¤©å¤©æ°”å¦‚ä½•ï¼Ÿ


æ¨¡å‹å›ç­”: æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå¤©æ°”é¢„æŠ¥çš„APIæ¥è·å–å—æ˜Œçš„å¤©æ°”ä¿¡æ¯ã€‚è¯·é—®ä½ èƒ½å‘Šè¯‰æˆ‘å—æ˜Œçš„è‹±æ–‡åç§°å—ï¼Ÿ


æ‚¨è¿˜æœ‰å…¶ä»–é—®é¢˜å—ï¼Ÿ(è¾“å…¥é€€å‡ºä»¥ç»“æŸå¯¹è¯):  NanChang


æ¨¡å‹å›ç­”: 
 ä»Šå¤©å—æ˜Œçš„å¤©æ°”æƒ…å†µå¦‚ä¸‹ï¼šå—æ˜Œç°åœ¨å¤šäº‘ï¼Œæ°”æ¸©ä¸º23åº¦ï¼Œç›¸å¯¹æ¹¿åº¦ä¸º50%ï¼Œé£å‘ä¸ºåŒ—é£ï¼Œé£åŠ›ä¸º2.09ç±³/ç§’ã€‚


æ‚¨è¿˜æœ‰å…¶ä»–é—®é¢˜å—ï¼Ÿ(è¾“å…¥é€€å‡ºä»¥ç»“æŸå¯¹è¯):  ç›¸æ¯”ä¹‹ä¸‹ï¼ŒåŒ—äº¬æ›´å†·è¿˜æ˜¯æ›´çƒ­å‘¢ï¼Ÿ


æ¨¡å‹å›ç­”: æ ¹æ®ä¸Šè¿°è®¡ç®—ç»“æœï¼Œå¯ä»¥çœ‹å‡ºå—æ˜Œæ˜å¤©é¢„è®¡æ¯”åŒ—äº¬æ›´çƒ­ã€‚


æ‚¨è¿˜æœ‰å…¶ä»–é—®é¢˜å—ï¼Ÿ(è¾“å…¥é€€å‡ºä»¥ç»“æŸå¯¹è¯):  åŒ—äº¬å¤©æ°”å¦‚ä½•å‘€ï¼Ÿ


æ¨¡å‹å›ç­”: æ®å¤©æ°”é¢„æŠ¥æ˜¾ç¤ºï¼ŒåŒ—äº¬æ˜å¤©çš„å¤©æ°”çŠ¶å†µä¸ºæ™´ï¼Œæ°”æ¸©çº¦ä¸º-6åº¦ï¼Œç›¸å¯¹æ¹¿åº¦çº¦ä¸º41%ï¼Œé£å‘ä¸ºè¥¿é£ï¼Œé£åŠ›çº¦ä¸º2.12ç±³/ç§’ã€‚


æ‚¨è¿˜æœ‰å…¶ä»–é—®é¢˜å—ï¼Ÿ(è¾“å…¥é€€å‡ºä»¥ç»“æŸå¯¹è¯):  é€€å‡º
```

* SQLä»£ç è§£é‡Šå™¨

```python
def sql_inter(sql_query):
    """
    ç”¨äºæ‰§è¡Œä¸€æ®µSQLä»£ç ï¼Œå¹¶æœ€ç»ˆè·å–SQLä»£ç æ‰§è¡Œç»“æœï¼Œ\
    æ ¸å¿ƒåŠŸèƒ½æ˜¯å°†è¾“å…¥çš„SQLä»£ç ä¼ è¾“è‡³MySQLç¯å¢ƒä¸­è¿›è¡Œè¿è¡Œï¼Œ\
    å¹¶æœ€ç»ˆè¿”å›SQLä»£ç è¿è¡Œç»“æœã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæœ¬å‡½æ•°æ˜¯å€ŸåŠ©pymysqlæ¥è¿æ¥MySQLæ•°æ®åº“ã€‚
    :param sql_query: å­—ç¬¦ä¸²å½¢å¼çš„SQLæŸ¥è¯¢è¯­å¥ï¼Œç”¨äºæ‰§è¡Œå¯¹MySQLä¸­telco_dbæ•°æ®åº“ä¸­å„å¼ è¡¨è¿›è¡ŒæŸ¥è¯¢ï¼Œå¹¶è·å¾—å„è¡¨ä¸­çš„å„ç±»ç›¸å…³ä¿¡æ¯
    :returnï¼šsql_queryåœ¨MySQLä¸­çš„è¿è¡Œç»“æœã€‚
    """
    
    
    connection = pymysql.connect(
            host=MY_IP,  # æ•°æ®åº“åœ°å€
            user='4u',  # æ•°æ®åº“ç”¨æˆ·å
            passwd=MY_PW,  # æ•°æ®åº“å¯†ç 
            db='telco_db',  # æ•°æ®åº“å
            charset='utf8'  # å­—ç¬¦é›†é€‰æ‹©utf8
        )
    
    try:
        with connection.cursor() as cursor:
            # SQLæŸ¥è¯¢è¯­å¥
            sql = sql_query
            cursor.execute(sql)

            # è·å–æŸ¥è¯¢ç»“æœ
            results = cursor.fetchall()

    finally:
        connection.close()
    
    
    return json.dumps(results)
```

```python
sql_inter_function_info = [
    {
    'name': 'sql_inter',
    'description': 'ç”¨äºæ‰§è¡Œä¸€æ®µSQLä»£ç ï¼Œå¹¶æœ€ç»ˆè·å–SQLä»£ç æ‰§è¡Œç»“æœï¼Œæ ¸å¿ƒåŠŸèƒ½æ˜¯å°†è¾“å…¥çš„SQLä»£ç ä¼ è¾“è‡³MySQLç¯å¢ƒä¸­è¿›è¡Œè¿è¡Œï¼Œå¹¶æœ€ç»ˆè¿”å›SQLä»£ç è¿è¡Œç»“æœã€‚',
    'parameters': {
        'type': 'object',
        'properties': {
            'sql_query': {
                'type': 'string',
                'description': 'å­—ç¬¦ä¸²å½¢å¼çš„SQLä»£ç ï¼Œå¯ä»¥åœ¨MySQLä¸­è¿è¡Œï¼Œå¹¶è·å–è¿è¡Œç»“æœ'
            }
        },
        'required': ['sql_query']
    }
}
]
```

```python
# æ‰“å¼€å¹¶è¯»å–Markdownæ–‡ä»¶
with open('telco_data_dictionary.md', 'r', encoding='utf-8') as f:
    data_dictionary = f.read()
```

```python
sql_inter(sql_query='SELECT COUNT(*) FROM user_demographics;')
```

```plaintext
'[[5353]]'
```

```python
display(Markdown(data_dictionary))
```

# telco\_data\_dictionaryï¼štelco\_dbæ•°æ®åº“æ•°æ®å­—å…¸

æœ¬æ•°æ®å­—å…¸è®°å½•äº†telco\_dbæ•°æ®åº“ä¸­å„å¼ æ•°æ®è¡¨çš„åŸºæœ¬æƒ…å†µã€‚

## 1.user\_demographicsæ•°æ®è¡¨

* åŸºæœ¬è§£é‡Š

* &#x20;user\_demographicsæ•°æ®è¡¨è®°å½•äº†ç”µä¿¡ç”¨æˆ·çš„ä¸ªäººåŸºæœ¬æƒ…å†µï¼Œä¸»è¦æ¶µç›–å®¢æˆ·åŸºæœ¬ç”Ÿç‰©å±æ€§ï¼ŒåŒ…æ‹¬æ€§åˆ«ã€å¹´é¾„çŠ¶å†µã€æ˜¯å¦ç»“å©šä»¥åŠæ˜¯å¦ç»æµç‹¬ç«‹ç­‰ã€‚

* æ•°æ®æ¥æº

* &#x20;       user\_demographicsæ•°æ®é›†ç”±ä¸€çº¿ä¸šåŠ¡äººå‘˜äººå·¥é‡‡é›†è®°å½•ï¼Œå¹¶ä¸”é€šè¿‡å›è®¿ç¡®è®¤ç›¸å…³ä¿¡æ¯ï¼Œæ•°æ®é›†çš„å‡†ç¡®æ€§å’Œå¯ä¿¡åº¦éƒ½éå¸¸é«˜ã€‚

* å„å­—æ®µè¯´æ˜

| Column Name   | Description                  | Value Range  | Value Explanation      | Type         |
| ------------- | ---------------------------- | ------------ | ---------------------- | ------------ |
| customerID    | å®¢æˆ·IDï¼Œuser\_demographicsæ•°æ®è¡¨ä¸»é”® |              | ç”±æ•°å­—å’Œå­—æ¯ç»„æˆçš„              | VARCHAR(255) |
| gender        | ç”¨æˆ·çš„æ€§åˆ«                        | Female, Male | Female (å¥³æ€§), Male (ç”·æ€§) | VARCHAR(255) |
| SeniorCitizen | æ˜¯å¦ä¸ºè€äºº                        | 0, 1         | 0 (ä¸æ˜¯), 1 (æ˜¯)          | INT          |
| Partner       | ç”¨æˆ·æ˜¯å¦æœ‰ä¼´ä¾£                      | Yes, No      | Yes (æœ‰), No (æ²¡æœ‰)       | VARCHAR(255) |
| Dependents    | ç”¨æˆ·ç»æµæ˜¯å¦ç‹¬ç«‹ï¼Œå¾€å¾€ç”¨äºåˆ¤æ–­ç”¨æˆ·æ˜¯å¦å·²ç»æˆå¹´      | No, Yes      | Yes (æœ‰), No (æ²¡æœ‰)       | VARCHAR(255) |

## 2.user\_servicesæ•°æ®è¡¨

* åŸºæœ¬è§£é‡Š

* &#x20;user\_servicesæ•°æ®è¡¨è®°å½•äº†æ¯ä½ç”¨æˆ·è®¢è´­ç”µä¿¡æœåŠ¡çš„åŸºæœ¬æƒ…å†µï¼Œæˆªè‡³ç›®å‰ï¼Œç”µä¿¡æœåŠ¡å•†æä¾›äº†ç§ç±»å¤šæ ·çš„æœåŠ¡ï¼ŒåŒ…æ‹¬ç”µè¯ç±»æœåŠ¡å’Œç½‘ç»œç±»æœåŠ¡ç­‰ï¼Œæœ¬æ•°æ®é›†è¡¨è®°å½•äº†æ¯ä½ç”¨æˆ·è®¢é˜…ç”µä¿¡æœåŠ¡çš„åŸºæœ¬æƒ…å†µã€‚

* æ•°æ®æ¥æº

* &#x20;user\_servicesæ•°æ®è¡¨ç”±åå°ç³»ç»Ÿè‡ªåŠ¨åˆ›å»ºç”Ÿæˆï¼Œå¹¶æœªç»è¿‡äººå·¥æ ¡éªŒã€‚

* å„å­—æ®µè¯´æ˜

| Column Name      | Description              | Value Range                  | Value Explanation                                         | Type         |
| ---------------- | ------------------------ | ---------------------------- | --------------------------------------------------------- | ------------ |
| customerID       | å®¢æˆ·IDï¼Œuser\_servicesæ•°æ®è¡¨ä¸»é”® |                              | ç”±æ•°å­—å’Œå­—æ¯ç»„æˆçš„                                                 | VARCHAR(255) |
| PhoneService     | ç”¨æˆ·æ˜¯å¦æœ‰ç”µè¯æœåŠ¡                | No, Yes                      | Yes (æœ‰), No (æ²¡æœ‰)                                          | VARCHAR(255) |
| MultipleLines    | ç”¨æˆ·æ˜¯å¦å¼€é€šäº†å¤šæ¡ç”µè¯ä¸šåŠ¡            | No phone service, No, Yes    | Yes (æœ‰å¤šæ¡ç”µè¯çº¿ä¸šåŠ¡), No (æ²¡æœ‰å¤šæ¡ç”µè¯çº¿ä¸šåŠ¡), No phone service (æ²¡æœ‰ç”µè¯æœåŠ¡) | VARCHAR(255) |
| InternetService  | ç”¨æˆ·çš„äº’è”ç½‘æœåŠ¡ç±»å‹               | DSL, Fiber optic, No         | DSL (DSL), Fiber optic (å…‰çº¤), No (æ²¡æœ‰)                      | VARCHAR(255) |
| OnlineSecurity   | æ˜¯å¦å¼€é€šç½‘ç»œå®‰å…¨æœåŠ¡               | No, Yes, No internet service | Yesï¼ˆæœ‰ï¼‰ã€Noï¼ˆæ— ï¼‰ or No internetserviceï¼ˆæ²¡æœ‰ç½‘è·¯æœåŠ¡ï¼‰                | VARCHAR(255) |
| OnlineBackup     | æ˜¯å¦å¼€é€šåœ¨çº¿å¤‡ä»½æœåŠ¡               | Yes, No, No internet service | Yesï¼ˆæœ‰ï¼‰ã€Noï¼ˆæ— ï¼‰ or No internetserviceï¼ˆæ²¡æœ‰ç½‘è·¯æœåŠ¡ï¼‰                | VARCHAR(255) |
| DeviceProtection | æ˜¯å¦å¼€é€šè®¾å¤‡ä¿æŠ¤æœåŠ¡               | No, Yes, No internet service | Yesï¼ˆæœ‰ï¼‰ã€Noï¼ˆæ— ï¼‰ or No internetserviceï¼ˆæ²¡æœ‰ç½‘è·¯æœåŠ¡ï¼‰                | VARCHAR(255) |
| TechSupport      | æ˜¯å¦å¼€é€šæŠ€æœ¯æ”¯æŒä¸šåŠ¡               | No, Yes, No internet service | Yesï¼ˆæœ‰ï¼‰ã€Noï¼ˆæ— ï¼‰ or No internetserviceï¼ˆæ²¡æœ‰ç½‘è·¯æœåŠ¡ï¼‰                | VARCHAR(255) |
| StreamingTV      | æ˜¯å¦å¼€é€šç½‘ç»œç”µè§†                 | No, Yes, No internet service | Yesï¼ˆæœ‰ï¼‰ã€Noï¼ˆæ— ï¼‰ or No internetserviceï¼ˆæ²¡æœ‰ç½‘è·¯æœåŠ¡ï¼‰                | VARCHAR(255) |
| StreamingMovies  | æ˜¯å¦å¼€é€šç½‘ç»œç”µå½±                 | No, Yes, No internet service | Yesï¼ˆæœ‰ï¼‰ã€Noï¼ˆæ— ï¼‰ or No internetserviceï¼ˆæ²¡æœ‰ç½‘è·¯æœåŠ¡ï¼‰                | VARCHAR(255) |

## 3.user\_paymentsæ•°æ®è¡¨

* åŸºæœ¬è§£é‡Š

* &#x20;user\_paymentsæ•°æ®è¡¨è®°å½•äº†æ¯ä¸€ä½ç”¨æˆ·æ”¯ä»˜çŠ¶å†µï¼Œæ—¢åŒ…æ‹¬ç”¨æˆ·çš„æ”¯ä»˜æ–¹å¼å’ŒåˆåŒç±»å‹ï¼ŒåŒæ—¶ä¹ŸåŒ…å«ç”¨æˆ·å…·ä½“æ”¯ä»˜é‡‘é¢ï¼ŒåŒ…æ‹¬æœˆä»˜é‡‘é¢å’Œæ€»é‡‘é¢ç­‰ã€‚

* æ•°æ®æ¥æº

* &#x20;user\_paymentsæ•°æ®è¡¨ç”±åå°è‡ªåŠ¨è®°å½•ç”Ÿæˆï¼Œå¹¶æœªç»è¿‡æ ¡éªŒã€‚

* å„å­—æ®µè¯´æ˜

| Column Name      | Description              | Value Range                                                                        | Value Explanation                                                                                             | Type         |
| ---------------- | ------------------------ | ---------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------- | ------------ |
| customerID       | å®¢æˆ·IDï¼Œuser\_paymentsæ•°æ®è¡¨ä¸»é”® |                                                                                    | ç”±æ•°å­—å’Œå­—æ¯ç»„æˆçš„                                                                                                     | VARCHAR(255) |
| Contract         | åˆåŒç±»å‹                     | Month-to-month, One year, Two year                                                 | Month-to-month (æœˆä»˜), One year (ä¸€å¹´ä»˜), Two year (ä¸¤å¹´ä»˜)                                                           | VARCHAR(255) |
| PaperlessBilling | æ˜¯å¦æ— çº¸åŒ–è´¦å•                  | Yes, No                                                                            | Yes (æ˜¯), No (å¦)                                                                                               | VARCHAR(255) |
| PaymentMethod    | æ”¯ä»˜æ–¹å¼                     | Electronic check, Mailed check, Bank transfer (automatic), Credit card (automatic) | Electronic check (ç”µå­æ£€æŸ¥), Mailed check (é‚®å¯„æ”¯ç¥¨), Bank transfer (automatic) (é“¶è¡Œè½¬è´¦), Credit card (automatic) (ä¿¡ç”¨å¡) | VARCHAR(255) |
| MonthlyCharges   | æœˆè´¹ç”¨                      |                                                                                    | ç”¨æˆ·å¹³å‡æ¯æœˆæ”¯ä»˜è´¹ç”¨                                                                                                    | FLOAT        |
| TotalCharges     | æ€»è´¹ç”¨                      |                                                                                    | æˆªè‡³ç›®å‰ç”¨æˆ·æ€»æ¶ˆè´¹é‡‘é¢                                                                                                   | VARCHAR(255) |

## 4.user\_churn

* åŸºæœ¬è§£é‡Š

* &#x20;user\_churnæ•°æ®è¡¨è®°å½•äº†å½“å‰ç”¨æˆ·æµå¤±æƒ…å†µã€‚

* æ•°æ®æ¥æº

* &#x20;user\_churnæ•°æ®è¡¨ç”±åå°è‡ªåŠ¨åˆ›å»ºå¹¶è®°å½•ï¼Œå½“åˆåŒæˆªè‡³åä½†ç”¨æˆ·æœªç»­è´¹ï¼Œåˆ™åˆ¤æ–­è¯¥ç”¨æˆ·ç›®å‰å¤„äºæµå¤±çŠ¶æ€ã€‚

* å„å­—æ®µè¯´æ˜

| Column Name | Description           | Value Range | Value Explanation | Type         |
| ----------- | --------------------- | ----------- | ----------------- | ------------ |
| customerID  | å®¢æˆ·IDï¼Œuser\_churnæ•°æ®è¡¨ä¸»é”® |             | ç”±æ•°å­—å’Œå­—æ¯ç»„æˆçš„         | VARCHAR(255) |
| Churn       | ç”¨æˆ·æ˜¯å¦æµå¤±                | No, Yes     | Yes (æ˜¯), No (å¦)   | VARCHAR(255) |

```python
chat_with_glm(question=data_dictionary + "ä½ å¥½", 
              functions_list=[sql_inter], 
              functions=sql_inter_function_info)
```

```plaintext
æ¨¡å‹å›ç­”: ä½ å¥½ï¼æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®åŠ©ä½ çš„å—ï¼Ÿ


æ‚¨è¿˜æœ‰å…¶ä»–é—®é¢˜å—ï¼Ÿ(è¾“å…¥é€€å‡ºä»¥ç»“æŸå¯¹è¯):  è¯·å¸®æˆ‘æŸ¥çœ‹user_demographicsè¡¨ä¸­æ€»å…±æœ‰å¤šå°‘æ¡æ•°æ®ï¼Ÿ


æ¨¡å‹å›ç­”: 
 æ ¹æ®æŸ¥è¯¢ç»“æœï¼Œuser_demographicsè¡¨ä¸­å…±æœ‰5353æ¡æ•°æ®ã€‚


æ‚¨è¿˜æœ‰å…¶ä»–é—®é¢˜å—ï¼Ÿ(è¾“å…¥é€€å‡ºä»¥ç»“æŸå¯¹è¯):  å…¶ä¸­ç”·æ€§ç”¨æˆ·å æ¯”å¤šå°‘å‘¢ï¼Ÿ


æ¨¡å‹å›ç­”: æ ¹æ®æŸ¥è¯¢ç»“æœï¼Œåœ¨user_demographicsè¡¨ä¸­ï¼Œç”·æ€§ç”¨æˆ·çš„æ•°é‡ä¸º2678ï¼Œå¥³æ€§ç”¨æˆ·çš„æ•°é‡ä¸º2675ï¼Œå› æ­¤ç”·æ€§ç”¨æˆ·å æ¯”ä¸º49.99%ã€‚


æ‚¨è¿˜æœ‰å…¶ä»–é—®é¢˜å—ï¼Ÿ(è¾“å…¥é€€å‡ºä»¥ç»“æŸå¯¹è¯):  éå¸¸æ£’ã€‚é‚£æ¥ä¸‹æ¥è¯·é—®user_paymentsæ•°æ®è¡¨ä¸­ï¼Œæœˆæ¶ˆè´¹é‡‘é¢æœ€é«˜çš„ç”¨æˆ·æ˜¯å“ªä½ï¼Ÿ


æ¨¡å‹å›ç­”: 
 æ ¹æ®æŸ¥è¯¢ç»“æœï¼Œæœˆæ¶ˆè´¹é‡‘é¢æœ€é«˜çš„ç”¨æˆ·ä¸º5734-EJKXGï¼Œå…¶æœˆæ¶ˆè´¹é‡‘é¢ä¸º118.60å…ƒã€‚


æ‚¨è¿˜æœ‰å…¶ä»–é—®é¢˜å—ï¼Ÿ(è¾“å…¥é€€å‡ºä»¥ç»“æŸå¯¹è¯):  é€€å‡º
```



ğŸ“**æ›´å¤šå¤§æ¨¡å‹æŠ€æœ¯å†…å®¹å­¦ä¹ **

**æ‰«ç æ·»åŠ åŠ©ç†è‹±è‹±ï¼Œå›å¤â€œå¤§æ¨¡å‹â€ï¼Œäº†è§£æ›´å¤šå¤§æ¨¡å‹æŠ€æœ¯è¯¦æƒ…å“¦ğŸ‘‡**

![](images/f339b04b7b20233dd1509c7fb36d5c0.png)

æ­¤å¤–ï¼Œ**æ‰«ç å›å¤â€œå…¥ç¾¤â€**ï¼Œå³å¯åŠ å…¥**å¤§æ¨¡å‹æŠ€æœ¯ç¤¾ç¾¤ï¼šæµ·é‡ç¡¬æ ¸ç‹¬å®¶æŠ€æœ¯`å¹²è´§å†…å®¹`+æ— é—¨æ§›`æŠ€æœ¯äº¤æµ`ï¼**
