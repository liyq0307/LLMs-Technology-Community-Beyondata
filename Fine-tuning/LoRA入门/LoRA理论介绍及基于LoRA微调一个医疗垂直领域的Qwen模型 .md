# æœ¬åœ°éƒ¨ç½²å¼€æºå¤§æ¨¡å‹

## Ch.15 LoRAçš„ç†è®ºè§£è¯»åŠåŸºäºLoRAå¾®è°ƒä¸€ä¸ªåŒ»ç–—å‚ç›´é¢†åŸŸçš„Qwenæ¨¡å‹

## 2.5 ä½¿ç”¨LoRAå¾®è°ƒåçš„æ¨¡å‹

â€ƒâ€ƒå› ä¸ºLoRAåœ¨è®­ç»ƒæ—¶åªå­˜å‚¨`adapter`éƒ¨åˆ†çš„å‚æ•°ã€‚æ‰€ä»¥å½“æˆ‘ä»¬éœ€è¦ä½¿ç”¨LoRAè®­ç»ƒåçš„æ¨¡å‹æ—¶ï¼Œéœ€è¦åœ¨å¯åŠ¨Qwen-7B-Chatæ¨¡å‹æ—¶ï¼Œå°†`Adapter`è¿™éƒ¨åˆ†çš„æ¨¡å‹å‚æ•°ä¸€åŒåŠ è½½ã€‚

â€ƒâ€ƒè¿™é‡Œæœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼šå¦‚æœå½“å‰ç¯å¢ƒä¸‹çš„peft>=0.8.0ï¼Œåœ¨åŠ è½½æ¨¡å‹åŒæ—¶ä¼šå°è¯•åŠ è½½tokenizerï¼Œä½†å› ä¸ºpeftå†…éƒ¨æœªç›¸åº”è®¾ç½®trust\_remote\_code=Trueï¼Œä¼šå¯¼è‡´ValueError: Tokenizer class QWenTokenizer does not exist or is not currently imported.è¦é¿è¿‡è¿™ä¸€é—®é¢˜ï¼Œéœ€è¦é™çº§peft<0.8.0æˆ–å°†tokenizerç›¸å…³æ–‡ä»¶ç§»åˆ°å…¶å®ƒæ–‡ä»¶å¤¹ã€‚å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹å½“å‰çš„peftä¾èµ–åŒ…ç‰ˆæœ¬ï¼š

```python
import peft
print(peft.__version__)
```

```plaintext
/home/util/anaconda3/envs/qwen_7b_chat/lib/python3.11/site-packages/tqdm/auto.py:21: TqdmWarning: IProgress not found. Please update jupyter and ipywidgets. See https://ipywidgets.readthedocs.io/en/stable/user_install.html
  from .autonotebook import tqdm as notebook_tqdm


0.6.2
```

â€ƒâ€ƒè¯¥ç¯å¢ƒçš„peftç‰ˆæœ¬æ˜¯0.6.2ï¼Œå¦‚æœå¤§å®¶æœ¬åœ°ç¯å¢ƒä¸­çš„peftç‰ˆæœ¬å¤§äºæˆ–ç­‰äº0.8.0ï¼Œä½¿ç”¨å¦‚ä¸‹ä»£ç è¿›è¡Œç‰ˆæœ¬é™çº§ã€‚

```python
# ! pip install peft==0.6.2
```

â€ƒâ€ƒç¡®å®šå¥½peftç‰ˆæœ¬åï¼Œæˆ‘ä»¬éœ€è¦å€ŸåŠ©peftåº“çš„`AutoPeftModelForCausalLM`æ¥åŠ è½½LoRAå¾®è°ƒåçš„Adapterï¼ŒåŠ è½½æ–¹å¼å¦‚ä¸‹ï¼š

```python
from peft import AutoPeftModelForCausalLM
```

```python
# è¿™é‡Œéœ€è¦å°†æ¨¡å‹çš„è·¯å¾„ï¼Œä¿®æ”¹ä¸ºLoRAå¾®è°ƒåçš„æ¨¡å‹å­˜å‚¨è·¯å¾„(checkpoint)
model = AutoPeftModelForCausalLM.from_pretrained("/home/Work/00.Work_muyu/muyu_qwen/finetune/output_qwen_lora_ds_medical/checkpoint-1560/", device_map="auto",trust_remote_code=True).eval()
```

```plaintext
The model is automatically converting to bf16 for faster inference. If you want to disable the automatic precision, please manually add bf16/fp16/fp32=True to "AutoModelForCausalLM.from_pretrained".
Try importing flash-attention for faster inference...
Loading checkpoint shards: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 8/8 [02:29<00:00, 18.74s/it]
```

â€ƒâ€ƒè¿™ä¸ªåŠ è½½è¿‡ç¨‹ï¼ŒPeftåº“ä¸­çš„ä»£ç é€»è¾‘ä¼šå°†LoRAå¾®è°ƒå¾—åˆ°çš„Adapteræƒé‡ä¸åŸå§‹çš„Qwen-7B-Chatæ¨¡å‹çš„æƒé‡è¿›è¡Œåˆå¹¶ï¼Œç›¸å…³é…ç½®å¯ä»¥çœ‹è¿™é‡Œï¼š

![](images/47341745-c5e4-46a7-bf5c-7f7e5850d852.png)

â€ƒâ€ƒå¯åŠ¨å®Œæˆåï¼Œå¯ä»¥åœ¨æœåŠ¡å™¨ä¸Šçœ‹åˆ°å¯¹åº”çš„æ˜¾å­˜å ç”¨æƒ…å†µã€‚åœ¨å››å¡3090é…ç½®ä¸‹ï¼Œå…¶æ˜¾å­˜å ç”¨çº¦35GBã€‚

![](images/8125bb39-6706-46ea-b871-d18a9836ec0c.png)

â€ƒâ€ƒåœ¨åŠ è½½äº†`Adapter`åï¼Œè¿˜éœ€è¦åŠ è½½Tokenizerã€‚å› ä¸ºç»è¿‡LoRAå¾®è°ƒï¼Œä»…ä»…æ˜¯æ”¹å˜åŸå§‹æ¨¡å‹å¯¹äºç‰¹å®šä»»åŠ¡çš„éƒ¨åˆ†çŸ©é˜µçš„å‚æ•°ï¼Œæ‰€ä»¥æœ¬è´¨ä¸Šä¸ä¼šæ”¹å˜æ¨¡å‹çš„åŸæœ‰ç»“æ„ï¼Œåˆ†è¯å™¨è¿˜æ˜¯éœ€è¦åŠ è½½åŸå§‹æ¨¡å‹çš„Tokenizerã€‚

```python
from transformers import AutoTokenizer
tokenizer = AutoTokenizer.from_pretrained("/home/Work/00.Work_muyu/muyu_qwen/models/qwen/Qwen-7B-Chat", trust_remote_code=True)
```

â€ƒâ€ƒåŠ è½½å¥½ç»è¿‡LoRAå¾®è°ƒåçš„Qwen-7b-Chatæ¨¡å‹åï¼Œå› ä¸ºæˆ‘ä»¬çš„è®­ç»ƒæ•°æ®æ˜¯åŒ»ç–—å‚ç›´é¢†åŸŸçš„è¯­æ–™ï¼Œå³`medical_treatment.json`è¿™ä¸ªå­˜æ”¾äº†20000ä»½åŒ»æ‚£å¯¹è¯çš„é—®ç­”ï¼Œæµ‹è¯•å¾®è°ƒæ•ˆæœæœ€ç›´è§‚çš„æ–¹å¼å°±æ˜¯åœ¨`medical_treatment.json`ä¸­ï¼Œéšæœºçš„æŠ½å–éƒ¨åˆ†ç”¨æˆ·æé—®ï¼Œçœ‹ä¸€ä¸‹Qwenæ¨¡å‹ç»™äºˆçš„å›å¤æ˜¯ä»€ä¹ˆæ ·çš„ã€‚è¿™é‡Œæˆ‘ä»¬åœ¨`medical_treatment.json`ä¸­éšæœºæŠ½å–äº†3æ¡åŸå§‹æé—®è¿›è¡Œæµ‹è¯•ï¼š

â€ƒâ€ƒæ ·æœ¬1ï¼š

```json
  {
    "id": "identity_21",
    "conversations": [
      {
        "from": "user",Â 
        "value": "æˆ‘å®¶å®å®å…­ä¸ªæœˆï¼Œåƒå¥¶ã€ç¡è§‰å¸¸å¸¸æ»¡å¤´å†’æ±—ï¼Œä»¥å‰æ˜¯ä¸å‡ºæ±—çš„ã€‚è¿˜æœ‰å‘ç°ä¸¤ä¸‰æ¬¡åƒå¥¶çš„æ—¶å€™å…¨èº«å‘æŠ–ï¼Œè¯·é—®è¿™æ˜¯ä¸æ˜¯ç—…ï¼Œå¦‚ä½•åŒ»æ²»ï¼Ÿ"
      },
      {
        "from": "assistant",
        "value": "è¿™æ˜¯ç¼ºé’™çš„åŸå› ã€‚æ˜¯ä¸æ˜¯ç¡è§‰æ—¶å¤´å‘æ ¹éƒ¨ä¹Ÿå…¨æ˜¯æ±—ï¼Ÿ"
      }
    ]
  },
```

â€ƒâ€ƒå°†`conversations`ä¸­çš„`value`ä½œä¸ºç”¨æˆ·è¾“å…¥çš„Promptå‘Qwen-7B-Chatæé—®ï¼š

```python
# ç¬¬ä¸€è½®å¯¹è¯
response, history = model.chat(tokenizer, "æˆ‘å®¶å®å®å…­ä¸ªæœˆï¼Œåƒå¥¶ã€ç¡è§‰å¸¸å¸¸æ»¡å¤´å†’æ±—ï¼Œä»¥å‰æ˜¯ä¸å‡ºæ±—çš„ã€‚è¿˜æœ‰å‘ç°ä¸¤ä¸‰æ¬¡åƒå¥¶çš„æ—¶å€™å…¨èº«å‘æŠ–ï¼Œè¯·é—®è¿™æ˜¯ä¸æ˜¯ç—…ï¼Œå¦‚ä½•åŒ»æ²»ï¼Ÿ", history=None)
print(response)
```

```plaintext
è¿™æ˜¯ç¼ºé’™çš„åŸå› ã€‚æ˜¯ä¸æ˜¯ç¡è§‰æ—¶å¤´å‘æ ¹éƒ¨ä¹Ÿå…¨æ˜¯æ±—ï¼Ÿ
```

```python
# ç¬¬ä¸€è½®å¯¹è¯
response, history = model.chat(tokenizer, "æˆ‘å®¶å®å®å…­ä¸ªæœˆï¼Œåƒå¥¶ã€ç¡è§‰å¸¸å¸¸æ»¡å¤´å†’æ±—ï¼Œä»¥å‰æ˜¯ä¸å‡ºæ±—çš„ã€‚è¿˜æœ‰å‘ç°ä¸¤ä¸‰æ¬¡åƒå¥¶çš„æ—¶å€™å…¨èº«å‘æŠ–ï¼Œè¯·é—®è¿™æ˜¯ä¸æ˜¯ç—…ï¼Œå¦‚ä½•åŒ»æ²»ï¼Ÿ", history=None)
print(response)
```

```plaintext
è¿™æ˜¯ç¼ºé’™çš„åŸå› ã€‚æ˜¯ä¸æ˜¯ç¡è§‰æ—¶å¤´å‘æ ¹éƒ¨ä¹Ÿå…¨æ˜¯æ±—ï¼Ÿ
```

```python
# ç¬¬ä¸€è½®å¯¹è¯
response, history = model.chat(tokenizer, "æˆ‘å®¶å®å®å…­ä¸ªæœˆï¼Œåƒå¥¶ã€ç¡è§‰å¸¸å¸¸æ»¡å¤´å†’æ±—ï¼Œä»¥å‰æ˜¯ä¸å‡ºæ±—çš„ã€‚è¿˜æœ‰å‘ç°ä¸¤ä¸‰æ¬¡åƒå¥¶çš„æ—¶å€™å…¨èº«å‘æŠ–ï¼Œè¯·é—®è¿™æ˜¯ä¸æ˜¯ç—…ï¼Œå¦‚ä½•åŒ»æ²»ï¼Ÿ", history=None)
print(response)
```

```plaintext
è¿™æ˜¯ç¼ºé’™çš„åŸå› ã€‚æ˜¯ä¸æ˜¯ç¡è§‰æ—¶å¤´å‘æ ¹éƒ¨ä¹Ÿå…¨æ˜¯æ±—ï¼Ÿ
```

â€ƒâ€ƒå¯ä»¥çœ‹åˆ°ï¼Œæ•ˆæœéå¸¸å¥½ï¼Œç›´æ¥æŠŠåŸå§‹çš„ç­”æ¡ˆå›å¤äº†å‡ºæ¥ã€‚æ¥ä¸‹æ¥å†æŠ½å–ç¬¬2æ¡æ ·æœ¬ï¼š

```json
  {
    "id": "identity_24",
    "conversations": [
      {
        "from": "user",
        "value": "åˆ›ä¼¤æ€§è‚¡éª¨å¤´åæ­»ï¼ˆè‚¡éª¨é¢ˆéª¨æŠ˜ï¼‰å¹²ç»†èƒæ²»ç–—å¯è¡Œå—ï¼ŸåŒ—äº¬å“ªå®¶åŒ»é™¢æ²»ç–—æœ€å¥½ï¼Ÿ"
      },
      {
        "from": "assistant",
        "value": "åŒ—äº¬307åŒ»é™¢éª¨ç§‘å¹²ç»†èƒç§»æ¤æ²»ç–—åˆ›ä¼¤æ€§è‚¡éª¨å¤´åæ­»æœ€ä½³ã€‚"
      }
    ]
  },
```

â€ƒâ€ƒå°†`conversations`ä¸­çš„`value`ä½œä¸ºç”¨æˆ·è¾“å…¥çš„Promptå‘Qwen-7B-Chatæé—®ï¼š

```python
# ç¬¬äºŒè½®å¯¹è¯
response, history = model.chat(tokenizer, "åˆ›ä¼¤æ€§è‚¡éª¨å¤´åæ­»ï¼ˆè‚¡éª¨é¢ˆéª¨æŠ˜ï¼‰å¹²ç»†èƒæ²»ç–—å¯è¡Œå—ï¼ŸåŒ—äº¬å“ªå®¶åŒ»é™¢æ²»ç–—æœ€å¥½ï¼Ÿ", history=None)
print(response)
```

```plaintext
åŒ—äº¬307åŒ»é™¢éª¨ç§‘å¹²ç»†èƒç§»æ¤æ²»ç–—åˆ›ä¼¤æ€§è‚¡éª¨å¤´åæ­»æœ€ä½³ã€‚
```

```python
# ç¬¬äºŒè½®å¯¹è¯
response, history = model.chat(tokenizer, "åˆ›ä¼¤æ€§è‚¡éª¨å¤´åæ­»ï¼ˆè‚¡éª¨é¢ˆéª¨æŠ˜ï¼‰å¹²ç»†èƒæ²»ç–—å¯è¡Œå—ï¼ŸåŒ—äº¬å“ªå®¶åŒ»é™¢æ²»ç–—æœ€å¥½ï¼Ÿ", history=None)
print(response)
```

```plaintext
åŒ—äº¬307åŒ»é™¢éª¨ç§‘å¹²ç»†èƒç§»æ¤æ²»ç–—åˆ›ä¼¤æ€§è‚¡éª¨å¤´åæ­»æœ€ä½³ã€‚
```

```python
# ç¬¬äºŒè½®å¯¹è¯
response, history = model.chat(tokenizer, "åˆ›ä¼¤æ€§è‚¡éª¨å¤´åæ­»ï¼ˆè‚¡éª¨é¢ˆéª¨æŠ˜ï¼‰å¹²ç»†èƒæ²»ç–—å¯è¡Œå—ï¼ŸåŒ—äº¬å“ªå®¶åŒ»é™¢æ²»ç–—æœ€å¥½ï¼Ÿ", history=None)
print(response)
```

```plaintext
åŒ—äº¬307åŒ»é™¢éª¨ç§‘å¹²ç»†èƒç§»æ¤æ²»ç–—åˆ›ä¼¤æ€§è‚¡éª¨å¤´åæ­»æœ€ä½³ã€‚
```

â€ƒâ€ƒåŒæ ·æ•ˆæœéå¸¸å¥½ï¼Œéå¸¸å¿«é€Ÿçš„åŒ¹é…åˆ°äº†æœ€åŸå§‹çš„å›ç­”ï¼Œæ¥ä¸‹æ¥å†æŠ½å–ç¬¬3æ¡æ ·æœ¬ï¼š

```json
  {
    "id": "identity_19",
    "conversations": [
      {
        "from": "user",
        "value": "æ‰‹æ¯›ï¼Œè„šæ¯›éƒ½å¾ˆå¤šï¼Œå¾ˆå¯†ï¼Œéƒ½ä¸çŸ¥é“æ€ä¹ˆåŠï¼Œæœ‰ä»€ä¹ˆæ°¸è¿œè„±æ¯›æ–¹æ³•ï¼Œä¸æƒ³æ¿€å…‰è„±æ¯›"
      },
      {
        "from": "assistant",
        "value": "é›„æ€§æ¿€ç´ è¿‡å¤šå¯¼è‡´çš„ï¼Œæ±—æ¯›æ˜¯æ¯›å­”æ˜¯æ±—æ¶²æ’å‡ºçš„ä¸»è¦æ–¹å¼ä¹‹ä¸€ï¼Œé™¤å»çš„è¯ä¹Ÿè®¸ä¼šä½¿æ±—æ¶²å¾—ä¸åˆ°å……åˆ†é‡Šæ”¾ï¼Œè¿™æ ·ä½“å†…æ¯’ç´ å°±ä¼šå¢åŠ ã€‚ç›®å‰æŒä¹…æ€§æœ€å¥½çš„ä¸€ç§è„±æ¯›æ–¹æ³•æ˜¯æ¿€å…‰æ°¸ä¹…è„±æ¯›ï¼Œè¿™ç§æ–¹æ³•ä¸ä¼ ç»Ÿçš„è„±æ¯›è†è„±æ¯›ç­‰æ–¹æ³•ä¸åŒï¼Œå®ƒæ˜¯ä»æ ¹æœ¬ä¸Šå»é™¤æ¯›å‘ï¼Œæ²»ç–—å®Œæˆä¹‹åå°±ä¸ä¼šå†å—æ¯›å‘å›°æ‰°ï¼Œè€Œä¸”ä¸ä¼šå¯¹çš®è‚¤é€ æˆå½±å“ï¼Œæ˜¯ä¸€ç§å®‰å…¨é«˜æ•ˆçš„è„±æ¯›æ‰‹æ®µã€‚"
      }
    ]
  },
```

```python
# ç¬¬ä¸‰è½®å¯¹è¯
response, history = model.chat(tokenizer, "æ‰‹æ¯›ï¼Œè„šæ¯›éƒ½å¾ˆå¤šï¼Œå¾ˆå¯†ï¼Œéƒ½ä¸çŸ¥é“æ€ä¹ˆåŠï¼Œæœ‰ä»€ä¹ˆæ°¸è¿œè„±æ¯›æ–¹æ³•ï¼Œä¸æƒ³æ¿€å…‰è„±æ¯›", history=None)
print(response)
```

```plaintext
é›„æ€§æ¿€ç´ è¿‡å¤šå¯¼è‡´çš„ï¼Œæ²¡ä»€ä¹ˆå¥½çš„åŠæ³•ï¼Œç›®å‰è„±æ¯›çš„æ–¹æ³•æœ‰æ¿€å…‰æ°¸ä¹…è„±æ¯›å’Œæ‹”é™¤ã€è„±æ¯›è†ã€åˆ®é™¤å››ç§ã€‚å»ºè®®é€‰æ‹©æ¿€å…‰æ°¸ä¹…è„±æ¯›ï¼Œä½†æ˜¯ä¸èƒ½å¤Ÿå»é™¤é¢ˆéƒ¨ä»¥ä¸Šæˆ–è€…æ˜¯å¤§è…¿æ ¹éƒ¨çš„æ±—æ¯›ï¼Œå› ä¸ºè¿™äº›éƒ¨ä½çš„ç¥ç»è¾ƒä¸ºå‘è¾¾ï¼Œæ¯›å›Šä¹Ÿæ¯”è¾ƒæ·±ï¼Œä¸é€‚å®œè¿›è¡Œå†°ç‚¹è„±æ¯›ã€‚
```

```python
# ç¬¬ä¸‰è½®å¯¹è¯
response, history = model.chat(tokenizer, "æ‰‹æ¯›ï¼Œè„šæ¯›éƒ½å¾ˆå¤šï¼Œå¾ˆå¯†ï¼Œéƒ½ä¸çŸ¥é“æ€ä¹ˆåŠï¼Œæœ‰ä»€ä¹ˆæ°¸è¿œè„±æ¯›æ–¹æ³•ï¼Œä¸æƒ³æ¿€å…‰è„±æ¯›", history=None)
print(response)
```

```plaintext
é›„æ€§æ¿€ç´ è¿‡å¤šå¯¼è‡´çš„ï¼Œæ±—æ¯›æ˜¯æ¯›å­”æ˜¯æ±—æ¶²æ’å‡ºçš„ä¸»è¦æ–¹å¼ä¹‹ä¸€ï¼Œé™¤å»çš„æ–¹å¼æœ‰å¾ˆå¤šçš„ï¼Œè¯ç‰©ã€è„±æ¯›è†ä»¥åŠæ‰‹æœ¯éƒ½å¯ä»¥é€‰å–å“¦ï¼Œå»ºè®®è¿˜æ˜¯ä¸è¦ä½¿ç”¨è„±æ¯›è†ä¸ºå¥½ï¼Œå› ä¸ºåŒ–å­¦è¯ç‰©è¾ƒå¤šï¼Œå…¶å®ƒçš„åˆ™æ˜¯å¯ä»¥é€‰ç”¨çš„ï¼Œå¸Œæœ›æˆ‘çš„å›ç­”å¯ä»¥å¸®åˆ°æ‚¨ã€‚
```

```python
# ç¬¬ä¸‰è½®å¯¹è¯
response, history = model.chat(tokenizer, "æ‰‹æ¯›ï¼Œè„šæ¯›éƒ½å¾ˆå¤šï¼Œå¾ˆå¯†ï¼Œéƒ½ä¸çŸ¥é“æ€ä¹ˆåŠï¼Œæœ‰ä»€ä¹ˆæ°¸è¿œè„±æ¯›æ–¹æ³•ï¼Œä¸æƒ³æ¿€å…‰è„±æ¯›", history=None)
print(response)
```

```plaintext
é›„æ€§æ¿€ç´ è¿‡å¤šå¯¼è‡´çš„ï¼Œæ±—æ¯›æ˜¯æ¯›å­”æ˜¯æ±—æ¶²æ’å‡ºçš„ä¸»è¦æ–¹å¼ä¹‹ä¸€ï¼Œé™¤å»çš„æ–¹å¼æœ‰å¾ˆå¤šçš„ï¼Œæœ€å¸¸ç”¨çš„é•Šå­ã€åˆ®åˆ€å’Œç”µåŠ¨å‰ƒé¡»åˆ€ã€‚å»ºè®®æœ€å¥½é‡‡ç”¨æ¿€å…‰è„±æ¯›æ²»ç–—ã€‚æ¿€å…‰æ°¸ä¹…è„±æ¯›åˆ©ç”¨æ¿€å…‰çš„çƒ­é‡æŠŠæ¯›å›Šæ ¹éƒ¨çš„é»‘è‰²ç´ æ”¹å˜ï¼Œè½¬å˜æˆç¼ºä¹æ´»æ€§çš„å¹²ç»†èƒï¼Œè¿™æ ·å°±ä¸ä¼šå†ç”Ÿé•¿å‡ºæ–°çš„æ¯›å‘ï¼Œä»è€Œè¾¾åˆ°é•¿ä¹…è„±æ¯›çš„æ•ˆæœã€‚
```

â€ƒâ€ƒå¯¹äºè¿™æ¡æ ·æœ¬ï¼Œè™½ç„¶æ¯æ¬¡çš„å›ç­”éƒ½ä¸ä¸€æ ·ï¼Œä½†ç»“è®ºå…¨éƒ¨éƒ½æ˜¯æŒ‰ç…§è®­ç»ƒé›†ä¸­çš„æ ‡å‡†ç­”æ¡ˆè¿›è¡Œçš„å…¶ä»–å½¢å¼çš„å›å¤ï¼Œæ€»ä½“æ¥çœ‹å…³é”®ç‚¹å…¨éƒ¨å¯ä»¥è¦†ç›–åˆ°ã€‚

â€ƒâ€ƒé€šè¿‡ä¸Šè¿°3æ¡æ ·æœ¬çš„æµ‹è¯•èƒ½å¤Ÿåœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šçœ‹å‡ºç»è¿‡LoRAå¾®è°ƒï¼Œå·²ç»å…·å¤‡äº†åœ¨åŒ»ç–—å‚ç›´é¢†åŸŸçš„ä¸€äº›æ¨ç†èƒ½åŠ›ã€‚æ¥ä¸‹æ¥å†çœ‹ä¸€ä¸‹åŸå§‹çš„Qwen-7B-Chatï¼Œå¯¹äºä¸Šè¿°è¾“å…¥çš„3æ¡åŒ»ç–—é¢†åŸŸçš„Promptï¼Œä¼šå¾—åˆ°ä»€ä¹ˆæ ·çš„å›å¤ã€‚

â€ƒâ€ƒ**æ³¨ï¼šå¦‚æœæ˜¯åœ¨Jupyter labæ“ä½œï¼Œéœ€è¦é‡å¯å½“å‰çš„Jupyter Labé‡Šæ”¾GPUèµ„æºåå†é‡æ–°åŠ è½½æ¨¡å‹ã€‚**

```python
from transformers import AutoModelForCausalLM, AutoTokenizer
from transformers.generation import GenerationConfig
```

```plaintext
/home/util/anaconda3/envs/qwen_7b_chat/lib/python3.11/site-packages/tqdm/auto.py:21: TqdmWarning: IProgress not found. Please update jupyter and ipywidgets. See https://ipywidgets.readthedocs.io/en/stable/user_install.html
  from .autonotebook import tqdm as notebook_tqdm
```

```python
tokenizer = AutoTokenizer.from_pretrained("/home/Work/00.Work_muyu/muyu_qwen/models/qwen/Qwen-7B-Chat", trust_remote_code=True)

model = AutoModelForCausalLM.from_pretrained("/home/Work/00.Work_muyu/muyu_qwen/models/qwen/Qwen-7B-Chat", device_map="auto", trust_remote_code=True).eval()

model.generation_config = GenerationConfig.from_pretrained("/home/Work/00.Work_muyu/muyu_qwen/models/qwen/Qwen-7B-Chat", trust_remote_code=True)
```

```plaintext
The model is automatically converting to bf16 for faster inference. If you want to disable the automatic precision, please manually add bf16/fp16/fp32=True to "AutoModelForCausalLM.from_pretrained".
Try importing flash-attention for faster inference...
Loading checkpoint shards: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 8/8 [02:28<00:00, 18.55s/it]
```

â€ƒâ€ƒå¯åŠ¨å®Œæˆåï¼Œå¯ä»¥åœ¨æœåŠ¡å™¨ä¸Šçœ‹åˆ°å¯¹åº”çš„æ˜¾å­˜å ç”¨æƒ…å†µã€‚åœ¨å››å¡3090é…ç½®ä¸‹ï¼Œå…¶æ˜¾å­˜å ç”¨çº¦21GBã€‚

![](images/6cd70e27-556b-4a48-b859-403c5c407fbb.png)

```python
# ç¬¬ä¸€è½®å¯¹è¯
response, history = model.chat(tokenizer, "æˆ‘å®¶å®å®å…­ä¸ªæœˆï¼Œåƒå¥¶ã€ç¡è§‰å¸¸å¸¸æ»¡å¤´å†’æ±—ï¼Œä»¥å‰æ˜¯ä¸å‡ºæ±—çš„ã€‚è¿˜æœ‰å‘ç°ä¸¤ä¸‰æ¬¡åƒå¥¶çš„æ—¶å€™å…¨èº«å‘æŠ–ï¼Œè¯·é—®è¿™æ˜¯ä¸æ˜¯ç—…ï¼Œå¦‚ä½•åŒ»æ²»ï¼Ÿ", history=None)
print(response)
```

```plaintext
å…­ä¸ªæœˆå¤§çš„å©´å„¿å‡ºæ±—å’Œé¢¤æŠ–å¯èƒ½æœ‰å¤šç§åŸå› ï¼ŒåŒ…æ‹¬æ­£å¸¸å‘è‚²ã€æ„ŸæŸ“æˆ–æŸäº›å¥åº·é—®é¢˜ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¯èƒ½å¯¼è‡´è¿™äº›ç—‡çŠ¶çš„åŸå› å’Œå»ºè®®ï¼š

1. æ­£å¸¸å‘è‚²ï¼šå…­ä¸ªæœˆçš„å©´å„¿å¯èƒ½ä¼šå› ä¸ºèº«ä½“æ­£åœ¨å¿«é€Ÿæˆé•¿è€Œæ„Ÿåˆ°ä¸é€‚ã€‚ä»–ä»¬å¯èƒ½ä¼šæ¯”å…¶ä»–å¹´é¾„æ®µçš„å©´å„¿æ›´å®¹æ˜“å‡ºæ±—å’Œé¢¤æŠ–ã€‚è¿™æ˜¯ä¸€ç§æ­£å¸¸çš„ç”Ÿç†ç°è±¡ï¼Œé€šå¸¸ä¸éœ€è¦æ²»ç–—ã€‚

2. æ„ŸæŸ“ï¼šå¦‚æœæ‚¨çš„å®å®é™¤äº†å‡ºæ±—å’Œé¢¤æŠ–ä¹‹å¤–è¿˜æœ‰å‘çƒ­ã€å–‰å’™ç—›ã€å’³å—½ã€çš®ç–¹æˆ–å…¶ä»–ç—‡çŠ¶ï¼Œå¯èƒ½æ˜¯æ„ŸæŸ“å¼•èµ·çš„ã€‚æ‚¨åº”è¯¥å¸¦ä»–å»çœ‹åŒ»ç”Ÿè¿›è¡Œæ£€æŸ¥å’Œæ²»ç–—ã€‚

3. å¥åº·é—®é¢˜ï¼šæœ‰äº›å¥åº·é—®é¢˜ï¼Œå¦‚ç”²çŠ¶è…ºåŠŸèƒ½äº¢è¿›æˆ–ä½è¡€ç³–ï¼Œä¹Ÿå¯èƒ½å¯¼è‡´å‡ºæ±—å’Œé¢¤æŠ–ã€‚å¦‚æœæ‚¨æ€€ç–‘è¿™ç§å¯èƒ½æ€§ï¼Œä¹Ÿåº”è¯¥å¸¦ä»–å»çœ‹åŒ»ç”Ÿè¿›è¡Œæ£€æŸ¥ã€‚

4. ç¡çœ ç¯å¢ƒè¿‡çƒ­ï¼šå¦‚æœæ‚¨å®¶çš„ç¡çœ ç¯å¢ƒè¿‡çƒ­ï¼Œä¹Ÿå¯èƒ½ä¼šå¯¼è‡´å®å®å‡ºæ±—ã€‚æ‚¨å¯ä»¥å°è¯•è°ƒæ•´å®¤æ¸©ï¼Œæˆ–è€…åœ¨å®å®ç¡è§‰æ—¶ä½¿ç”¨ç©ºè°ƒæˆ–é£æ‰‡æ¥é™ä½æ¸©åº¦ã€‚

æ€»ä¹‹ï¼Œå¦‚æœæ‚¨çš„å®å®æŒç»­å‡ºæ±—å’Œé¢¤æŠ–ï¼Œæˆ–è€…å‡ºç°å…¶ä»–ä¸å¯»å¸¸çš„ç—‡çŠ¶ï¼Œåº”å°½å¿«å¸¦ä»–å»çœ‹åŒ»ç”Ÿè¿›è¡Œæ£€æŸ¥å’Œè¯Šæ–­ã€‚åŒ»ç”Ÿä¼šæ ¹æ®å®å®çš„å…·ä½“æƒ…å†µç»™å‡ºæœ€åˆé€‚çš„æ²»ç–—æ–¹æ¡ˆã€‚
```

```python
# å¾®è°ƒåæ¨¡å‹çš„å›å¤ï¼š
# è¿™æ˜¯ç¼ºé’™çš„åŸå› ã€‚æ˜¯ä¸æ˜¯ç¡è§‰æ—¶å¤´å‘æ ¹éƒ¨ä¹Ÿå…¨æ˜¯æ±—ï¼Ÿ
```

```python
# ç¬¬äºŒè½®å¯¹è¯
response, history = model.chat(tokenizer, "åˆ›ä¼¤æ€§è‚¡éª¨å¤´åæ­»ï¼ˆè‚¡éª¨é¢ˆéª¨æŠ˜ï¼‰å¹²ç»†èƒæ²»ç–—å¯è¡Œå—ï¼ŸåŒ—äº¬å“ªå®¶åŒ»é™¢æ²»ç–—æœ€å¥½ï¼Ÿ", history=None)
print(response)
```

```plaintext
å¹²ç»†èƒæ²»ç–—è‚¡éª¨å¤´åæ­»æ˜¯ä¸€ç§æ–°å…´çš„æ²»ç–—æ–¹æ³•ï¼Œä½†ç›®å‰å°šæœªè¢«å¹¿æ³›æ¥å—å’Œä½¿ç”¨ã€‚è™½ç„¶ä¸€äº›ç ”ç©¶è¡¨æ˜ï¼Œå¹²ç»†èƒå¯ä»¥ä¿ƒè¿›ç»†èƒä¿®å¤å’Œå†ç”Ÿï¼Œä½†åœ¨æ²»ç–—è‚¡éª¨å¤´åæ­»æ–¹é¢ï¼Œå…¶æ•ˆæœè¿˜éœ€è¦æ›´å¤šçš„ä¸´åºŠç ”ç©¶æ¥è¯å®ã€‚

åŒ—äº¬çš„å‡ å®¶å¤§å‹ä¸‰ç”²åŒ»é™¢å¦‚åŒ—äº¬å¤§å­¦äººæ°‘åŒ»é™¢ã€ä¸­å›½åŒ»å­¦ç§‘å­¦é™¢åŒ—äº¬åå’ŒåŒ»é™¢ã€ä¸­å›½äººæ°‘è§£æ”¾å†›æ€»åŒ»é™¢ç­‰éƒ½æœ‰å¼€å±•ç›¸å…³çš„åŒ»ç–—ç ”ç©¶å’ŒæŠ€æœ¯ï¼Œå¯ä»¥æä¾›å¹²ç»†èƒæ²»ç–—æœåŠ¡ã€‚å»ºè®®æ‚¨åœ¨é€‰æ‹©åŒ»é™¢æ—¶ï¼Œé™¤äº†è€ƒè™‘åŒ»é™¢çš„è§„æ¨¡å’Œå£°èª‰å¤–ï¼Œè¿˜è¦è¯¦ç»†äº†è§£åŒ»ç”Ÿçš„ä¸“ä¸šèƒŒæ™¯ã€ä¸´åºŠç»éªŒå’Œæ²»ç–—æ–¹æ¡ˆï¼Œä»¥ä¾¿åšå‡ºæœ€ä½³çš„é€‰æ‹©ã€‚
```

```python
# å¾®è°ƒåæ¨¡å‹çš„å›å¤ï¼š
# åŒ—äº¬307åŒ»é™¢éª¨ç§‘å¹²ç»†èƒç§»æ¤æ²»ç–—åˆ›ä¼¤æ€§è‚¡éª¨å¤´åæ­»æœ€ä½³ã€‚
```

```python
# ç¬¬ä¸‰è½®å¯¹è¯
response, history = model.chat(tokenizer, "æ‰‹æ¯›ï¼Œè„šæ¯›éƒ½å¾ˆå¤šï¼Œå¾ˆå¯†ï¼Œéƒ½ä¸çŸ¥é“æ€ä¹ˆåŠï¼Œæœ‰ä»€ä¹ˆæ°¸è¿œè„±æ¯›æ–¹æ³•ï¼Œä¸æƒ³æ¿€å…‰è„±æ¯›", history=None)
print(response)
```

```plaintext
æœ‰ä¸€äº›è‡ªç„¶çš„æ–¹æ³•å¯ä»¥å¸®åŠ©ä½ å‡å°‘ä½“æ¯›çš„æ•°é‡å’Œå¯†åº¦ï¼š

1. å‰ƒé¡»ï¼šè¿™æ˜¯ä¸€ç§å¿«é€Ÿã€ç®€å•çš„å»é™¤çŸ­æ¯›çš„æ–¹æ³•ã€‚ä½ å¯ä»¥ä½¿ç”¨å‰ƒåˆ€æˆ–ç”µåŠ¨å‰ƒé¡»åˆ€æ¥å®Œæˆã€‚

2. è„±æ¯›è†ï¼šè¿™ç§äº§å“å«æœ‰å¯ä»¥æº¶è§£çš®è‚¤ä¸Šæ¯›å‘çš„åŒ–å­¦ç‰©è´¨ã€‚å°†è„±æ¯›è†å‡åŒ€æ¶‚æŠ¹åœ¨éœ€è¦è„±æ¯›çš„åœ°æ–¹ï¼Œç­‰å¾…å‡ åˆ†é’Ÿååˆ®æ‰ã€‚ä¸è¿‡è¿™ç§æ–¹æ³•å¯èƒ½ä¼šå¯¼è‡´çš®è‚¤æ•æ„Ÿæˆ–è€…ç–¼ç—›ã€‚

3. çƒ­èœ¡è„±æ¯›ï¼šè¿™ç§æ–¹æ³•å¯ä»¥æœ‰æ•ˆå»é™¤é•¿æ¯›ï¼Œä½†å¯èƒ½ä¼šå¯¼è‡´ä¸€äº›è½»å¾®çš„ç–¼ç—›ã€‚ä½ éœ€è¦è´­ä¹°ä¸“ç”¨çš„çƒ­èœ¡ï¼Œå¹¶æŒ‰ç…§è¯´æ˜è¿›è¡Œæ“ä½œã€‚

4. æŒ‡ç”²é’³å‰ªçŸ­ï¼šå¯¹äºè„šéƒ¨å’Œè…¿éƒ¨çš„é•¿æ¯›ï¼Œä½ å¯ä»¥ä½¿ç”¨æŒ‡ç”²é’³å‰ªçŸ­ã€‚è¿™ç§æ–¹æ³•è™½ç„¶ä¸èƒ½å®Œå…¨å»é™¤æ¯›å‘ï¼Œä½†å¯ä»¥å‡å°‘æ¯›å‘çš„æ•°é‡å’Œå¯†åº¦ã€‚

5. é£Ÿç‰©ç–—æ³•ï¼šæœ‰äº›é£Ÿç‰©å¯ä»¥å¸®åŠ©å‡å°‘ä½“æ¯›çš„ç”Ÿé•¿ï¼Œå¦‚ç‡•éº¦ã€ç»¿å¶è”¬èœã€æŸ‘æ©˜ç±»æ°´æœç­‰ã€‚

ä»¥ä¸Šéƒ½æ˜¯æš‚æ—¶æ€§çš„è§£å†³æ–¹æ¡ˆï¼Œå¦‚æœä½ æƒ³æ°¸ä¹…æ€§åœ°å‡å°‘ä½“æ¯›ï¼Œå¯èƒ½éœ€è¦è€ƒè™‘æ¿€å…‰è„±æ¯›æˆ–è€…å…¶ä»–åŒ»å­¦ç¾å®¹æŠ€æœ¯ã€‚ä½†æ˜¯è¿™äº›æ–¹æ³•éƒ½éœ€è¦åœ¨ä¸“ä¸šåŒ»ç”ŸæŒ‡å¯¼ä¸‹è¿›è¡Œï¼Œä»¥é¿å…å¯èƒ½çš„é£é™©å’Œå‰¯ä½œç”¨ã€‚
```

```python
# å¾®è°ƒåæ¨¡å‹çš„å›å¤ï¼š
# é›„æ€§æ¿€ç´ è¿‡å¤šå¯¼è‡´çš„ï¼Œæ²¡ä»€ä¹ˆå¥½çš„åŠæ³•ï¼Œç›®å‰è„±æ¯›çš„æ–¹æ³•æœ‰æ¿€å…‰æ°¸ä¹…è„±æ¯›å’Œæ‹”é™¤ã€è„±æ¯›è†ã€åˆ®é™¤å››ç§ã€‚
# å»ºè®®é€‰æ‹©æ¿€å…‰æ°¸ä¹…è„±æ¯›ï¼Œä½†æ˜¯ä¸èƒ½å¤Ÿå»é™¤é¢ˆéƒ¨ä»¥ä¸Šæˆ–è€…æ˜¯å¤§è…¿æ ¹éƒ¨çš„æ±—æ¯›ï¼Œå› ä¸ºè¿™äº›éƒ¨ä½çš„ç¥ç»è¾ƒä¸ºå‘è¾¾ï¼Œæ¯›å›Šä¹Ÿæ¯”è¾ƒæ·±ï¼Œä¸é€‚å®œè¿›è¡Œå†°ç‚¹è„±æ¯›ã€‚
```

â€ƒâ€ƒé€šè¿‡è¿™æ ·çš„å¯¹æ¯”å°±å¯ä»¥éå¸¸æ˜æ˜¾çš„ä½“ä¼šåˆ°LoRAå¾®è°ƒåï¼ŒQwen-7B-Chatæ¨¡å‹å¯¹äºåŒ»ç–—å‚ç›´é¢†åŸŸå…¶å›å¤æ˜¯æ›´å…·ä¸“ä¸šæ€§çš„ã€‚

â€ƒâ€ƒè€Œé™¤äº†ä¸Šè¿°è¿™ç§åˆ†æ­¥åŠ è½½çš„æ–¹å¼ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©å°†LoRAå¾®è°ƒçš„`Adapter`å‚æ•°ä¸æ¨¡å‹çš„åŸå§‹å‚æ•°è¿›è¡Œåˆå¹¶ï¼Œç„¶åå†ä½¿ç”¨æœ€åŸå§‹çš„æ–¹å¼è¿›è¡ŒåŠ è½½å’Œè°ƒç”¨ã€‚åˆå¹¶çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š

```python
from peft import AutoPeftModelForCausalLM
```

```plaintext
/home/util/anaconda3/envs/qwen_7b_chat/lib/python3.11/site-packages/tqdm/auto.py:21: TqdmWarning: IProgress not found. Please update jupyter and ipywidgets. See https://ipywidgets.readthedocs.io/en/stable/user_install.html
  from .autonotebook import tqdm as notebook_tqdm
```

â€ƒâ€ƒè¿™é‡Œçš„æ¨¡å‹åœ°å€è·¯å¾„ï¼Œä¿®æ”¹ä¸ºLoRAå¾®è°ƒåè¾“å‡ºçš„æ–‡ä»¶å¤¹ä¸­å¯¹åº”çš„Checkpointè·¯å¾„ã€‚

```python
model = AutoPeftModelForCausalLM.from_pretrained(
    "/home/Work/00.Work_muyu/muyu_qwen/finetune/output_qwen_lora_ds_medical/checkpoint-1560/",
    device_map="auto",
    trust_remote_code=True
).eval()
```

```plaintext
The model is automatically converting to bf16 for faster inference. If you want to disable the automatic precision, please manually add bf16/fp16/fp32=True to "AutoModelForCausalLM.from_pretrained".
Try importing flash-attention for faster inference...
Loading checkpoint shards: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 8/8 [02:30<00:00, 18.78s/it]
```

â€ƒâ€ƒä½¿ç”¨`merge_and_unload`è¿›è¡Œå®ä¾‹åŒ–ã€‚

```python
merged_model = model.merge_and_unload()
```

â€ƒâ€ƒæœ€åï¼Œé€šè¿‡`save_pretrained`æ–¹æ³•ï¼Œå°†åˆå¹¶åçš„æ–°æ¨¡å‹ä¿å­˜è‡³æœ¬åœ°ã€‚è¿™é‡Œå¯ä»¥è‡ªè¡Œä¿®æ”¹å®é™…å­˜å‚¨çš„æ–°æ¨¡å‹è·¯å¾„ã€‚

```python
merged_model.save_pretrained("/home/Work/00.Work_muyu/muyu_qwen/models/qwen/qwen-7b-chat-lora_med")
```

â€ƒâ€ƒåŒæ—¶è¦æ³¨æ„çš„æ˜¯ï¼š`merge_and_unload`æ–¹æ³•ä»…ä¼šä¿å­˜æ¨¡å‹ï¼Œè€Œä¸ä¼šä¿å­˜tokenizerç›¸å…³çš„é…ç½®ï¼Œæ‰€ä»¥è¿˜éœ€è¦ä½¿ç”¨ä»¥ä»¥ä¸‹ä»£ç ä¿å­˜ï¼š

```python
from transformers import AutoTokenizer
tokenizer = AutoTokenizer.from_pretrained(
    "/home/Work/00.Work_muyu/muyu_qwen/finetune/output_qwen_lora_ds_medical/checkpoint-1560/",
    trust_remote_code=True
)

tokenizer.save_pretrained("/home/Work/00.Work_muyu/muyu_qwen/models/qwen/qwen-7b-chat-lora_med")
```

```plaintext
('/home/Work/00.Work_muyu/muyu_qwen/models/qwen/qwen-7b-chat-lora_med/tokenizer_config.json',
 '/home/Work/00.Work_muyu/muyu_qwen/models/qwen/qwen-7b-chat-lora_med/special_tokens_map.json',
 '/home/Work/00.Work_muyu/muyu_qwen/models/qwen/qwen-7b-chat-lora_med/qwen.tiktoken',
 '/home/Work/00.Work_muyu/muyu_qwen/models/qwen/qwen-7b-chat-lora_med/added_tokens.json')
```

â€ƒâ€ƒå®Œæˆåï¼Œå°±ä¼šåœ¨æœ¬åœ°ç”Ÿæˆä¸€ä¸ªå­˜å‚¨ç€åˆå¹¶åæ¨¡å‹çš„å…¨éƒ¨æƒé‡æ–‡ä»¶å’Œé…ç½®æ–‡ä»¶çš„æ–‡ä»¶å¤¹ã€‚

![](images/800af306-224f-4912-8293-1f81d5fa10e9.png)

â€ƒâ€ƒæ¥ä¸‹æ¥ï¼Œå°±å¯ä»¥æ ¹æ®å¸¸è§„çš„æ¨¡å‹åŠ è½½æ–¹å¼æ‰§è¡Œè°ƒç”¨ã€‚

â€ƒâ€ƒ**æ³¨ï¼šå¦‚æœæ˜¯åœ¨Jupyter labæ“ä½œï¼Œéœ€è¦é‡å¯å½“å‰çš„Jupyter Labé‡Šæ”¾GPUèµ„æºåå†é‡æ–°åŠ è½½æ¨¡å‹ã€‚**

```python
from transformers import AutoModelForCausalLM, AutoTokenizer
from transformers.generation import GenerationConfig

tokenizer = AutoTokenizer.from_pretrained("/home/Work/00.Work_muyu/muyu_qwen/models/qwen/qwen-7b-chat-lora_med", trust_remote_code=True)

model = AutoModelForCausalLM.from_pretrained("/home/Work/00.Work_muyu/muyu_qwen/models/qwen/qwen-7b-chat-lora_med", device_map="auto", trust_remote_code=True).eval()

model.generation_config = GenerationConfig.from_pretrained("/home/Work/00.Work_muyu/muyu_qwen/models/qwen/qwen-7b-chat-lora_med", trust_remote_code=True)
```

```plaintext
/home/util/anaconda3/envs/qwen_7b_chat/lib/python3.11/site-packages/tqdm/auto.py:21: TqdmWarning: IProgress not found. Please update jupyter and ipywidgets. See https://ipywidgets.readthedocs.io/en/stable/user_install.html
  from .autonotebook import tqdm as notebook_tqdm
Loading checkpoint shards: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 4/4 [02:41<00:00, 40.45s/it]
```

![](images/52195af1-73a4-4468-900b-06f9ad9eb455.png)

```python
# å¯¹è¯æµ‹è¯•
response, history = model.chat(tokenizer, "æ‰‹æ¯›ï¼Œè„šæ¯›éƒ½å¾ˆå¤šï¼Œå¾ˆå¯†ï¼Œéƒ½ä¸çŸ¥é“æ€ä¹ˆåŠï¼Œæœ‰ä»€ä¹ˆæ°¸è¿œè„±æ¯›æ–¹æ³•ï¼Œä¸æƒ³æ¿€å…‰è„±æ¯›", history=None)
print(response)
```

```plaintext
é›„æ€§æ¿€ç´ è¿‡å¤šå¯¼è‡´çš„ï¼Œæ²¡ä»€ä¹ˆå¥½çš„åŠæ³•ï¼Œé™¤ç¾å®¹é™¢é‚£äº›è€—èµ„å¤šçš„æ°¸ä¹…è„±æ¯›å¤–ï¼Œå…¶ä»–çš„éƒ½æ˜¯æš‚æ—¶çš„ï¼Œè€Œä¸”æœ‰äº›å¯¹èº«ä½“æœ‰å®³ã€‚è€—èµ„å°‘çš„å¯ä»¥è¯•ä¸‹ç”µåŠ¨æ‹”æ¯›å™¨ï¼Œé‚£ç§ä¸¤ç”¨å‹çš„è„±æ¯›æ•ˆæœè¿˜å¯ä»¥ï¼Œåœ¨ä¸€äº›å¤§è¯æˆ¿æœ‰å–ã€‚è¿˜æœ‰å°±æ˜¯èœœèœ¡è„±æ¯›ï¼Œä½†æ˜¯åˆºæ¿€çš®è‚¤ï¼Œå¶æ˜¯æ•æ„Ÿæ€§çš®è‚¤ï¼Œä¸èƒ½åˆ®è…‹ä¸‹çš„æ±—æ¯›ï¼Œåªèƒ½ç”¨å‰ƒé¡»åˆ€å’Œç”µåŠ¨æ‹”æ¯›å™¨ã€‚å¸Œæœ›ä½ æ‰¾åˆ°åˆé€‚çš„è„±æ¯›å·¥å…·ã€‚æˆ‘ä»¥å‰ä¹Ÿæ˜¯æ±—æ¯›é‡çš„ï¼Œä¸è¿‡æˆ‘æ¯”ä½ æ›´ä¸¥é‡ï¼Œå› ä¸ºæˆ‘å¤§è…¿å’Œå°è…¿çš„æ¯›ä¹Ÿå¾ˆå¤šï¼Œä»Šå¹´21å²äº†ï¼Œå¤å¤©éƒ½ä¸æ•¢ç©¿çŸ­è£¤å’Œè£™å­ã€‚çœŸæ˜¯éƒé—·å•Šï¼
```

```python
# å¯¹è¯æµ‹è¯•
response, history = model.chat(tokenizer, "åŒ»ç”Ÿç»™æˆ‘å¼€çš„è¯æ˜¯ï¼Œå¸ƒåœ°å¥ˆå¾·é¼»å–·é›¾å‰‚å’Œå»æ°§è‚¾ä¸Šè…ºç´ æº´è‹¯é‚£ï¼Œæ˜¯å¦æœ‰ä¾èµ–æ€§.", history=None)
print(response)
```

```plaintext
è¿‡æ•æ€§é¼»ç‚ä¸å˜åº”æ€§é¼»ç‚å…¶å®æ˜¯ä¸€ä¸ªæ¦‚å¿µã€‚ä¸»è¦åº”ç”¨æŠ—è¿‡æ•è¯ç‰©åŠä½¿ç”¨é¼»è…”å–·é›¾å‰‚æ¥æ”¹å–„ç—‡çŠ¶ã€‚æ³¨æ„ç—‡çŠ¶ç¼“è§£ååº”é€æ¸å‡é‡ç»´æŒï¼Œä¸è¦ç«‹å³åœè¯ã€‚å¿…è¦æ—¶å¯ä»¥ç»“åˆä¸­åŒ»æ²»ç–—ï¼Œæ•ˆæœä¸é”™ã€‚
```

```python
# å¯¹è¯æµ‹è¯•
response, history = model.chat(tokenizer, "ä»¥å‰æœ‰è¿‡é‡ç—‡è‚Œæ— åŠ›ç—…å²ï¼Œç°åœ¨å¥½å¤šäº†ï¼Œæœ€è¿‘æ„Ÿè§‰è„¸éƒ¨å‘éº»ï¼Œç»å¸¸æ²¡åŠ›æ°”ï¼Œ", history=None)
print(response)
```

```plaintext
éº»å¯ä»¥è€ƒè™‘æ˜¯ç¥ç»ç‚æˆ–è€…æ˜¯è¡€æ¶²å¾ªç¯ä¸ç•…æ‰€å¯¼è‡´çš„ï¼Œå»ºè®®åˆ°åŒ»é™¢åšxçº¿æ£€æŸ¥ä»¥åŠè¡€ç®¡å½©è¶…æ£€æŸ¥ä»¥ä¾¿ç¡®è¯Šã€‚å¯ä»¥å…ˆå£æœç»´ç”Ÿç´ b1ï¼Œb6ç‰‡ï¼Œ
```

![](images/c1f405b6-61fb-41cc-93a8-e843009dc878.png)

```python
# å¯¹è¯æµ‹è¯•
response, history = model.chat(tokenizer, "æœ€è¿‘è„¸æœ‰ç‚¹å‘éº»ï¼Œæ²¡æœ‰åŠ›æ°”ï¼Œä¹‹å‰ç¡®è¯Šè¿‡é‡ç—‡è‚Œæ— åŠ›ï¼Œè¯·é—®åŒ»ç”Ÿï¼Œæˆ‘è¿™ç§æƒ…å†µåº”è¯¥å¦‚ä½•åŒ»æ²»å•Šï¼Ÿ", history=None)
print(response)
```

```plaintext
è¿™ä¸ªæƒ…å†µè€ƒè™‘è¿˜æ˜¯é‡ç—‡è‚Œæ— åŠ›çš„è¡¨ç°ï¼Œå»ºè®®ç§¯æçš„é…åˆåŒ»ç”Ÿçš„æ²»ç–—ã€‚å¯ä»¥è€ƒè™‘é…åˆæœç”¨èœ‚ä¹³ï¼Œèƒ¸è…ºè‚½ï¼Œä¸™ç§çƒè›‹ç™½ç­‰ä¿å¥æ²»ç–—ã€‚å¦å¤–å¯ä»¥è€ƒè™‘åšèƒ¸è…ºCTæ£€æŸ¥ã€‚
```

```python
# å¯¹è¯æµ‹è¯•
response, history = model.chat(tokenizer, "ä¹‹å‰ç¡®è¯Šè¿‡é‡ç—‡è‚Œæ— åŠ›ï¼Œæœ€è¿‘è„¸æœ‰ç‚¹å‘éº»ï¼Œæ²¡æœ‰åŠ›æ°”ï¼Œè¯·é—®åŒ»ç”Ÿï¼Œæˆ‘è¿™ç§æƒ…å†µåº”è¯¥å¦‚ä½•åŒ»æ²»å•Šï¼Ÿ", history=None)
print(response)
```

```plaintext
éº»å¯ä»¥è€ƒè™‘æ˜¯ç¥ç»ç‚æˆ–è€…æ˜¯è¡€æ¶²å¾ªç¯ä¸ç•…æ‰€å¯¼è‡´çš„ç—‡çŠ¶ã€‚å»ºè®®åˆ°åŒ»é™¢æ‹ç‰‡æ£€æŸ¥ä¸€ä¸‹ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰å‹è¿«ç—‡çŠ¶ï¼Œå¯ä»¥æœç”¨ç»´ç”Ÿç´ å’Œè¥å…»ç¥ç»çš„è¯ç‰©æ²»ç–—ã€‚
```

â€ƒâ€ƒä½†å…¶å®é€šè¿‡æ›´å¤šå¤šæ ·åŒ–çš„æµ‹è¯•å¾ˆå®¹æ˜“å‘ç°ï¼Œç»è¿‡å¾®è°ƒåçš„æ¨¡å‹è™½ç„¶è¡¨é¢ä¸Šçœ‹æ˜¯å…·å¤‡äº†å¾ˆå¼ºçš„ä¸“ä¸šçŸ¥è¯†ï¼Œä½†è¿˜æ˜¯ä¼šå­˜åœ¨éå¸¸å¤šçš„é—®é¢˜ï¼Œæ¯”å¦‚ï¼š

```python
# å¯¹è¯æµ‹è¯•
response, history = model.chat(tokenizer, "ä½ å¥½ï¼Œè¯·ä½ ä»‹ç»ä¸€ä¸‹ä½ è‡ªå·±", history=None)
print(response)
```

```plaintext
å“ˆå“ˆï¼Œæˆ‘æ˜¯ç”¨AIè®­ç»ƒå‡ºæ¥çš„æœºå™¨æ™ºèƒ½ï¼Œä¸æ˜¯äººå‘€ï¼Œæœ‰ä»€ä¹ˆé—®é¢˜å¯ä»¥éšæ—¶å‘æˆ‘æé—®ï¼
```

```python
# å¯¹è¯æµ‹è¯•
response, history = model.chat(tokenizer, "ä½ å¥½", history=None)
print(response)
```

```plaintext
ä½ è¯´çš„æƒ…å†µå¼€å§‹å±€éƒ¨å†·æ•·ï¼Œ24å°æ—¶ä»¥åçƒ­æ•·è¯•è¯•æœ€å¥½æ³¨æ„é¿å…ç»§ç»­æ´»åŠ¨ï¼Œå¸Œæœ›èƒ½å¤Ÿå¸®åˆ°ä½ å¦å¤–å»ºè®®ä½ å»æ­£è§„åŒ»é™¢æ£€æŸ¥ä¸€ä¸‹ï¼Œç¥ä½ å¥åº·
```

â€ƒâ€ƒå®ƒä¼šåœ¨ä¸€äº›å¸¸è§„çš„å¯¹è¯ä¸­ï¼Œå—åˆ°å¾®è°ƒè®­ç»ƒå‚æ•°çš„å½±å“ï¼Œå¯¼è‡´ä¸§å¤±æ‰éƒ¨åˆ†é€šç”¨çš„åŸç”Ÿèƒ½åŠ›ã€‚

```python
# å¯¹è¯æµ‹è¯•
response, history = model.chat(tokenizer, "ä»€ä¹ˆæ˜¯æœºå™¨å­¦ä¹ ", history=None)
print(response)
```

```plaintext
æ‰€è°“æœºå™¨å­¦ä¹ ï¼ˆMachine Learningï¼‰å®ƒæ˜¯ä¸€ä¸ªå¹¿æ³›çš„é¢†åŸŸï¼Œé€šå¸¸æŒ‡çš„æ˜¯é€šè¿‡è®¡ç®—æœºç¨‹åºå’Œç®—æ³•è®©ç”µè„‘å…·å¤‡ä¸€å®šçš„è‡ªåŠ¨å­¦ä¹ èƒ½åŠ›ã€‚è¿™ç§å­¦ä¹ è¿‡ç¨‹æ˜¯é€šè¿‡äº‹å…ˆç»™å®šçš„æ•°æ®æ¥åˆ†æï¼Œå¹¶ä»ä¸­å­¦ä¹ å‡ºä¸€ç§æ¨¡å¼ï¼Œç„¶åç”¨è¿™ç§æ¨¡å¼æ¥å¯¹æœªçŸ¥æ•°æ®è¿›è¡Œé¢„æµ‹æˆ–è€…åˆ†ç±»ç­‰ã€‚
```

```python
# å¯¹è¯æµ‹è¯•
response, history = model.chat(tokenizer, "ä»€ä¹ˆæ˜¯æ·±åº¦å­¦ä¹ ï¼Œè¯·ä½ å¸®æˆ‘è¯¦ç»†çš„ä»‹ç»ä¸€ä¸‹", history=None)
print(response)
```

```plaintext
æ·±åº¦å­¦ä¹ ï¼ˆDeep Learningï¼‰æ˜¯ä¸€é—¨å¤šé¢†åŸŸäº¤å‰å­¦ç§‘ï¼Œå®ƒä½¿è®¡ç®—æœºå…·æœ‰ç†è§£å¤æ‚è¡¨è¾¾çš„èƒ½åŠ›ã€‚æ·±åº¦å­¦ä¹ æ˜¯ä»æ¨¡ä»¿ç”Ÿç‰©ç¥ç»å…ƒç½‘ç»œå‡ºå‘ï¼Œç»“åˆäººå·¥ç¥ç»ç½‘ç»œï¼ˆANNï¼‰ã€é—ä¼ ç®—æ³•ï¼ˆGAï¼‰å’Œæ¨¡ç³Šé€»è¾‘ï¼ˆFLï¼‰ç­‰æŠ€æœ¯ï¼Œå»ºç«‹ä¸€ç§å¤šå±‚æ¬¡ä¿¡å·å¤„ç†ç³»ç»Ÿã€‚å…¶ä¸»è¦ç‰¹å¾æ˜¯æœ‰ä¸€ä¸ªéçº¿æ€§å¤„ç†å±‚æ¬¡ç»“æ„ï¼Œæ¯ä¸€ä¸ªå±‚æ¬¡éƒ½ç›¸å¯¹ç‹¬ç«‹åœ°å®ŒæˆæŸç§ç‰¹å®šçš„è®¡ç®—ä»»åŠ¡ã€‚æ‰€ä»¥æ·±åº¦å­¦ä¹ åˆè¢«ç§°ä¸ºâ€œæ·±å±‚ç¥ç»ç½‘ç»œâ€ã€‚å®ƒæ˜¯æœºå™¨å­¦ä¹ çš„ä¸€ç§ï¼Œå®é™…ä¸Šæ˜¯ç”¨ç‰¹å¾å¯¹ç¥ç»ç½‘ç»œè¿›è¡Œæ‹Ÿåˆã€‚å…¶åŸç†å¹¶ä¸æ˜¯çœŸæ­£çš„â€œå­¦ä¹ â€ï¼Œç›®å‰æ¥çœ‹æ›´å¤šçš„æ˜¯ä¸€ç§æ¨¡å¼è¯†åˆ«ç®—æ³•ã€‚ä»åº”ç”¨è§’åº¦ä¸Šæ¥è¯´ï¼Œå®ƒå¯ä»¥å½’ä¸ºèšç±»åˆ†æçš„ä¸€ç§ã€‚ä½†æ˜¯ä¸K-meansä¸åŒçš„æ˜¯ï¼Œå®ƒä¸éœ€è¦æå‰ç¡®å®šç°‡çš„æ•°é‡ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæ·±åº¦å­¦ä¹ ä¸»è¦ç”¨äºæ¨¡å¼è¯†åˆ«ã€æ–‡æœ¬åˆ†ç±»ä»¥åŠè®¡ç®—æœºè§†è§‰ã€‚æ¯”å¦‚åœ¨è¯­éŸ³è¯†åˆ«ä¸Šçš„åº”ç”¨ä¾¿æ˜¯æ·±åº¦å­¦ä¹ çš„ä¸€ç§ã€‚å¯¹äºå…¶ä»–ç±»å‹çš„æœºå™¨å­¦ä¹ ï¼Œå¦‚æœé‡åˆ°ä¸€äº›æ— æ³•è§£å†³çš„é—®é¢˜æ—¶ï¼Œé€šå¸¸å¯ä»¥ä½¿ç”¨æ·±åº¦å­¦ä¹ å»è§£å†³ã€‚ä½†åŒæ—¶æ·±åº¦å­¦ä¹ çš„å­¦ä¹ æ—¶é—´è¾ƒé•¿ï¼Œåœ¨ç¡¬ä»¶ç­‰æ–¹é¢çš„è¦æ±‚ä¹Ÿè¾ƒé«˜ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¸ç”¨äºå°è§„æ¨¡çš„æ•°æ®é›†ã€‚
```

â€ƒâ€ƒå…¶æ¬¡ï¼Œå¯¹äºè®­ç»ƒæ•°æ®ä¸­çš„æé—®ï¼Œå¦‚æœæ¢ä¸€ç§è¯´æ³•ï¼Œæœ‰æ—¶å€™ä¼šæ— æ³•æ­£ç¡®çš„å›ç­”å‡ºä¸“ä¸šçš„å›å¤ã€‚

```python
# å¯¹è¯æµ‹è¯•
response, history = model.chat(tokenizer, "æˆ‘æœ€è¿‘ä¸€ç›´å‘è§‰è„¸æœ‰ç‚¹å‘éº»ï¼Œæ€»æ˜¯æ„Ÿè§‰è‡ªå·±æ²¡æœ‰åŠ›æ°”ï¼Œä¹‹å‰ç¡®è¯Šè¿‡é‡ç—‡è‚Œæ— åŠ›ï¼Œè¯·é—®åŒ»ç”Ÿï¼Œæˆ‘è¿™ç§æƒ…å†µåº”è¯¥å¦‚ä½•åŒ»æ²»å•Šï¼Ÿ", history=None)
print(response)
```

```plaintext
è¿™ä¸ªå‘ç—…åŸå› ç›®å‰è¿˜æ²¡æœ‰ç¡®å®šçš„è®ºç‚¹ï¼Œä¸€èˆ¬éƒ½å’Œä¸€äº›ç—…æ¯’æ„ŸæŸ“æˆ–è€…æ˜¯å†…åˆ†æ³Œçš„å¼‚å¸¸æœ‰å…³ç³»çš„ã€‚æ²»ç–—æ–¹é¢ä¹Ÿæ˜¯åšä¸€äº›å¯¹ç—‡çš„æ²»ç–—ï¼Œæ¯”å¦‚è¯´å¯ä»¥ç”¨ä¸€äº›æ¿€ç´ æ¥è¿›è¡Œæ²»ç–—ï¼Œå¹¶ä¸”ä¹Ÿå¯ä»¥ç”¨ä¸­è¯è¿›è¡Œè°ƒç†ï¼Œèƒ½å¤Ÿç¼“è§£ç—‡çŠ¶çš„è¯å°±å¯ä»¥äº†ã€‚
```

â€ƒâ€ƒè¿™äº›éƒ½æ˜¯å¾®è°ƒå¤§æ¨¡å‹åæ™®éå­˜åœ¨çš„ä¸€äº›é—®é¢˜ï¼Œä¸ä»…ä»…å­˜åœ¨äºLoRAå¾®è°ƒï¼Œæˆ–è€…Qwenæ¨¡å‹ä¸Šã€‚æ‰€è°“çš„å¾®è°ƒæ•ˆæœçš„å¥½åï¼Œæ€»çš„æ¥è¯´æ˜¯è¦æ ¹æ®è‡ªå·±å®é™…çš„æƒ…å†µæ¥å®šã€‚å¾®è°ƒæ‰§è¡Œè¿‡ç¨‹çœ‹ä¼¼æ¯”è¾ƒç®€å•ï¼Œå…¶æ•ˆæœå—åˆ°å¤šç§å› ç´ çš„å½±å“ã€‚æ ¸å¿ƒåœ¨äºæ ¹æ®å®é™…éœ€æ±‚æ¥å†³å®šå¾®è°ƒçš„ç›®æ ‡ï¼šæ˜¯è¿½æ±‚æ¨¡å‹åœ¨ä¸“ä¸šé¢†åŸŸå†…çš„ç²¾å‡†åº¦ï¼Œè¿˜æ˜¯å¸Œæœ›ä¿æŒæ¨¡å‹è¾ƒå¥½çš„é€šç”¨æ€§èƒ½ã€‚å…·ä½“åˆ°å¾®è°ƒåæ¨¡å‹çš„ä½¿ç”¨ï¼Œå…³é”®åœ¨äºå¹³è¡¡ä¸“ä¸šçŸ¥è¯†ä¸é€šç”¨èƒ½åŠ›çš„éœ€æ±‚ã€‚

â€ƒâ€ƒå¾®è°ƒçš„æ•ˆæœå¹¶æ²¡æœ‰ä¸€ç§æ”¾ä¹‹å››æµ·è€Œçš†å‡†çš„æ–¹æ³•ï¼Œä¸»è¦æ˜¯å› ä¸ºä¸åŒçš„æ•°æ®é›†å’Œä¸åŒçš„éœ€æ±‚å¯¼è‡´å¿…é¡»é‡‡å–ä¸åŒçš„ç­–ç•¥ã€‚ä¸€èˆ¬æ¥è¯´å¯ä»¥é€šè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼æ¥ä¼˜åŒ–å¾®è°ƒè¿‡ç¨‹ï¼š

* è°ƒæ•´è®­ç»ƒæ•°æ®ï¼šç¡®ä¿æ•°æ®è´¨é‡å’Œå¤šæ ·æ€§ã€‚

* ä¼˜åŒ–è®­ç»ƒè¿‡ç¨‹ï¼šé€šè¿‡è°ƒæ•´å­¦ä¹ ç‡ã€æ­£åˆ™åŒ–å‚æ•°ç­‰æ¥æ”¹å–„æ¨¡å‹çš„å­¦ä¹ æ•ˆç‡å’Œæ•ˆæœã€‚

* å¢åŠ æç¤ºå·¥ç¨‹ï¼šåˆ©ç”¨æç¤ºï¼ˆpromptingï¼‰æ¥å¼•å¯¼æ¨¡å‹æ›´å¥½åœ°ç†è§£ä»»åŠ¡éœ€æ±‚ï¼Œç‰¹åˆ«æ˜¯åœ¨å°‘é‡æ•°æ®ä¸Šçš„å¾®è°ƒã€‚

â€ƒâ€ƒä½†ç›¸è¾ƒPEFTæ–¹æ³•æ¥è¯´ï¼ŒLoRAèƒ½å¤Ÿæå¤§ç¨‹åº¦ä¸Šé™ä½ç¾éš¾æ€§é—å¿˜çš„é—®é¢˜ã€‚å› ä¸ºå®ƒæ˜¯å»è¿‘ä¼¼æ¨¡æ‹ŸåŸé¢„è®­ç»ƒæ¨¡å‹çš„å‚æ•°ï¼Œç±»ä¼¼äºå…¨é‡å¾®è°ƒçš„ä¸€ä¸ªç‰¹ä¾‹ï¼Œè€Œå¹¶ä¸æ˜¯å»æ·»åŠ ä¸€äº›æ‰€è°“virtual tokenæ”¹å˜å¤§æ¨¡å‹çš„åŸæœ‰å‚æ•°ç»“æ„ï¼Œè¿™å°±èƒ½é™ä½å¯¹åŸæœ‰å‚æ•°çš„å½±å“ã€‚æ¯”å¦‚æˆ‘ä»¬ç»§ç»­æé—®ä¸€äº›é€šç”¨çŸ¥è¯†ï¼š

```python
# å¯¹è¯æµ‹è¯•
response, history = model.chat(tokenizer, "ä»€ä¹ˆæ˜¯æœºå™¨å­¦ä¹ ", history=None)
print(response)
```

```plaintext
æ‰€è°“æœºå™¨å­¦ä¹ ï¼ˆMachine Learningï¼‰å®ƒæ˜¯ä¸€ä¸ªå¹¿æ³›çš„é¢†åŸŸï¼Œé€šå¸¸æŒ‡çš„æ˜¯é€šè¿‡è®¡ç®—æœºç¨‹åºå’Œç®—æ³•è®©ç”µè„‘å…·å¤‡ä¸€å®šçš„è‡ªåŠ¨å­¦ä¹ èƒ½åŠ›ã€‚è¿™ç§å­¦ä¹ è¿‡ç¨‹æ˜¯é€šè¿‡äº‹å…ˆç»™å®šçš„æ•°æ®æ¥åˆ†æï¼Œå¹¶ä»ä¸­å­¦ä¹ å‡ºä¸€ç§æ¨¡å¼ï¼Œç„¶åç”¨è¿™ç§æ¨¡å¼æ¥å¯¹æœªçŸ¥æ•°æ®è¿›è¡Œé¢„æµ‹æˆ–è€…åˆ†ç±»ç­‰ã€‚
```

```python
# å¯¹è¯æµ‹è¯•
response, history = model.chat(tokenizer, "ä»€ä¹ˆæ˜¯æ·±åº¦å­¦ä¹ ï¼Œè¯·ä½ å¸®æˆ‘è¯¦ç»†çš„ä»‹ç»ä¸€ä¸‹", history=None)
print(response)
```

```plaintext
æ·±åº¦å­¦ä¹ ï¼ˆDeep Learningï¼‰æ˜¯ä¸€é—¨å¤šé¢†åŸŸäº¤å‰å­¦ç§‘ï¼Œå®ƒä½¿è®¡ç®—æœºå…·æœ‰ç†è§£å¤æ‚è¡¨è¾¾çš„èƒ½åŠ›ã€‚æ·±åº¦å­¦ä¹ æ˜¯ä»æ¨¡ä»¿ç”Ÿç‰©ç¥ç»å…ƒç½‘ç»œå‡ºå‘ï¼Œç»“åˆäººå·¥ç¥ç»ç½‘ç»œï¼ˆANNï¼‰ã€é—ä¼ ç®—æ³•ï¼ˆGAï¼‰å’Œæ¨¡ç³Šé€»è¾‘ï¼ˆFLï¼‰ç­‰æŠ€æœ¯ï¼Œå»ºç«‹ä¸€ç§å¤šå±‚æ¬¡ä¿¡å·å¤„ç†ç³»ç»Ÿã€‚å…¶ä¸»è¦ç‰¹å¾æ˜¯æœ‰ä¸€ä¸ªéçº¿æ€§å¤„ç†å±‚æ¬¡ç»“æ„ï¼Œæ¯ä¸€ä¸ªå±‚æ¬¡éƒ½ç›¸å¯¹ç‹¬ç«‹åœ°å®ŒæˆæŸç§ç‰¹å®šçš„è®¡ç®—ä»»åŠ¡ã€‚æ‰€ä»¥æ·±åº¦å­¦ä¹ åˆè¢«ç§°ä¸ºâ€œæ·±å±‚ç¥ç»ç½‘ç»œâ€ã€‚å®ƒæ˜¯æœºå™¨å­¦ä¹ çš„ä¸€ç§ï¼Œå®é™…ä¸Šæ˜¯ç”¨ç‰¹å¾å¯¹ç¥ç»ç½‘ç»œè¿›è¡Œæ‹Ÿåˆã€‚å…¶åŸç†å¹¶ä¸æ˜¯çœŸæ­£çš„â€œå­¦ä¹ â€ï¼Œç›®å‰æ¥çœ‹æ›´å¤šçš„æ˜¯ä¸€ç§æ¨¡å¼è¯†åˆ«ç®—æ³•ã€‚ä»åº”ç”¨è§’åº¦ä¸Šæ¥è¯´ï¼Œå®ƒå¯ä»¥å½’ä¸ºèšç±»åˆ†æçš„ä¸€ç§ã€‚ä½†æ˜¯ä¸K-meansä¸åŒçš„æ˜¯ï¼Œå®ƒä¸éœ€è¦æå‰ç¡®å®šç°‡çš„æ•°é‡ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæ·±åº¦å­¦ä¹ ä¸»è¦ç”¨äºæ¨¡å¼è¯†åˆ«ã€æ–‡æœ¬åˆ†ç±»ä»¥åŠè®¡ç®—æœºè§†è§‰ã€‚æ¯”å¦‚åœ¨è¯­éŸ³è¯†åˆ«ä¸Šçš„åº”ç”¨ä¾¿æ˜¯æ·±åº¦å­¦ä¹ çš„ä¸€ç§ã€‚å¯¹äºå…¶ä»–ç±»å‹çš„æœºå™¨å­¦ä¹ ï¼Œå¦‚æœé‡åˆ°ä¸€äº›æ— æ³•è§£å†³çš„é—®é¢˜æ—¶ï¼Œé€šå¸¸å¯ä»¥ä½¿ç”¨æ·±åº¦å­¦ä¹ å»è§£å†³ã€‚ä½†åŒæ—¶æ·±åº¦å­¦ä¹ çš„å­¦ä¹ æ—¶é—´è¾ƒé•¿ï¼Œåœ¨ç¡¬ä»¶ç­‰æ–¹é¢çš„è¦æ±‚ä¹Ÿè¾ƒé«˜ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¸ç”¨äºå°è§„æ¨¡çš„æ•°æ®é›†ã€‚
```

â€ƒâ€ƒé€šè¿‡ä¸Šè¿°çš„æµ‹è¯•ä¸éš¾çœ‹å‡ºï¼Œç»è¿‡LoRAå¾®è°ƒåçš„Qwenæ¨¡å‹ï¼Œè¿˜èƒ½å¤Ÿæ¯”è¾ƒå‡†ç¡®çš„ä¿æŒå…¶åŸæœ‰çš„é€šç”¨çŸ¥è¯†ç”Ÿæˆèƒ½åŠ›ï¼Œé™¤æ­¤ä¹‹å¤–ï¼ŒLoRAçš„ä¼˜åŠ¿æ›´åœ¨äºå…¶æ¨ç†é˜¶æ®µçš„ä¼˜åŠ¿ã€‚å› ä¸ºå®ƒåœ¨æ¨ç†é˜¶æ®µæ˜¯ç›´æ¥ä½¿ç”¨è®­ç»ƒå¥½çš„Aã€Bä½ç§©çŸ©é˜µå»æ›¿æ¢åŸé¢„è®­ç»ƒæ¨¡å‹çš„å¯¹åº”å‚æ•°ï¼Œå°±å¯ä»¥é¿å…å› å¢åŠ ç½‘ç»œçš„æ·±åº¦æ‰€å¸¦æ¥çš„æ¨ç†å»¶æ—¶å’Œé¢å¤–çš„è®¡ç®—é‡ã€‚æ‰€ä»¥ç‰¹åˆ«é€‚ç”¨äºå¯¹æ¨ç†é€Ÿåº¦å’Œæ¨¡å‹æ€§èƒ½éƒ½æœ‰è¾ƒé«˜è¦æ±‚çš„åº”ç”¨åœºæ™¯ã€‚



ğŸ“**æ›´å¤šå¤§æ¨¡å‹æŠ€æœ¯å†…å®¹å­¦ä¹ **

**æ‰«ç æ·»åŠ åŠ©ç†è‹±è‹±ï¼Œå›å¤â€œå¤§æ¨¡å‹â€ï¼Œäº†è§£æ›´å¤šå¤§æ¨¡å‹æŠ€æœ¯è¯¦æƒ…å“¦ğŸ‘‡**

![](images/f339b04b7b20233dd1509c7fb36d5c0.png)

æ­¤å¤–ï¼Œ**æ‰«ç å›å¤â€œå…¥ç¾¤â€**ï¼Œå³å¯åŠ å…¥**å¤§æ¨¡å‹æŠ€æœ¯ç¤¾ç¾¤ï¼šæµ·é‡ç¡¬æ ¸ç‹¬å®¶æŠ€æœ¯`å¹²è´§å†…å®¹`+æ— é—¨æ§›`æŠ€æœ¯äº¤æµ`ï¼**
