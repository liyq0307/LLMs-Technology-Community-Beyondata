## ã€Šå¤§æ¨¡å‹ä¸Agentå¼€å‘å®æˆ˜ã€‹ï¼ˆ12æœˆç­ï¼‰ä½“éªŒè¯¾

## GraphRAG+ollamaæœ¬åœ°éƒ¨ç½²æµç¨‹å®æˆ˜

### æœ¬èŠ‚ç›®å½•

1. GraphRAGé¡¹ç›®å›é¡¾

   * å¾®è½¯å¼€æºçš„GraphRAGé¡¹ç›®ç®€ä»‹

   * GraphRAG+ollamaæœ¬åœ°éƒ¨ç½²ä¼˜åŠ¿

2. Ollamaé¡¹ç›®ä»‹ç»ä¸æ ¸å¿ƒåŠŸèƒ½é€Ÿè§ˆ

   * Ollamaé¡¹ç›®ä»‹ç»

   * Ollamaè¿è¡Œæ‰€éœ€ç¡¬ä»¶æ”¯æŒ

   * Ollamaå¿«é€Ÿä½¿ç”¨æ–¹æ³•

   * ä½¿ç”¨ModelScopeå¹³å°ä¸Šçš„GGUFæ ¼å¼çš„å¤§æ¨¡å‹

3. åˆ›å»ºé€‚é…GraphRAGçš„æœ¬åœ°ollama+å¤§æ¨¡å‹è¿è¡Œç¯å¢ƒ

   * Step 1.ä½¿ç”¨pipå®‰è£…graphrag

   * Step 2.åˆ›å»ºæ£€ç´¢é¡¹ç›®æ–‡ä»¶å¤¹

   * Step 3.ä¸Šä¼ æ•°æ®é›†

   * Step 4.åˆå§‹åŒ–é¡¹ç›®æ–‡ä»¶

   * Step 5.ä¿®æ”¹é¡¹ç›®é…ç½®

4. GraphRAGæºç ä¿®æ”¹

5. åŸºäºOllama+GraphRAGçš„æœ¬åœ°çŸ¥è¯†æ£€ç´¢å¢å¼ºæµç¨‹

### ä¸€ã€GraphRAGé¡¹ç›®å›é¡¾

![](images/f8f7c51a-3f04-4856-b6ca-984e2068e3e7.png)

* å¾®è½¯å¼€æºçš„GraphRAGé¡¹ç›®ç®€ä»‹

â€ƒâ€ƒ**æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰** æ˜¯ä¸€ç§é€šè¿‡ç»“åˆçœŸå®ä¸–ç•Œçš„ä¿¡æ¯æ¥æå‡å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰è¾“å‡ºè´¨é‡çš„æŠ€æœ¯ã€‚RAG æŠ€æœ¯æ˜¯å¤§å¤šæ•°åŸºäº LLM çš„å·¥å…·ä¸­çš„ä¸€ä¸ªé‡è¦ç»„æˆéƒ¨åˆ†ã€‚å¤§å¤šæ•° RAG æ–¹æ³•ä½¿ç”¨ **å‘é‡ç›¸ä¼¼æ€§** ä½œä¸ºæ£€ç´¢æŠ€æœ¯ï¼Œæˆ‘ä»¬å°†å…¶ç§°ä¸º **åŸºçº¿ RAGï¼ˆBaseline RAGï¼‰**ã€‚

**GraphRAG** åˆ™ä½¿ç”¨ **çŸ¥è¯†å›¾è°±** æ¥åœ¨æ¨ç†å¤æ‚ä¿¡æ¯æ—¶æ˜¾è‘—æå‡é—®ç­”æ€§èƒ½ã€‚å½“éœ€è¦å¯¹å¤æ‚æ•°æ®è¿›è¡Œæ¨ç†æ—¶ï¼ŒGraphRAG å±•ç¤ºäº†ä¼˜äºåŸºçº¿ RAG çš„æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯åœ¨ **çŸ¥è¯†å›¾è°±** çš„å¸®åŠ©ä¸‹ã€‚

â€ƒâ€ƒRAG æŠ€æœ¯åœ¨å¸®åŠ© LLM æ¨ç†ç§æœ‰æ•°æ®é›†æ–¹é¢æ˜¾ç¤ºäº†å¾ˆå¤§çš„æ½œåŠ›â€”â€”ä¾‹å¦‚ï¼ŒLLM æ²¡æœ‰åœ¨è®­ç»ƒæ—¶æ¥è§¦è¿‡çš„ã€ä¼ä¸šçš„ä¸“æœ‰ç ”ç©¶ã€ä¸šåŠ¡æ–‡æ¡£æˆ–é€šä¿¡æ•°æ®ã€‚åŸºçº¿ RAG æŠ€æœ¯æœ€åˆæ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜è€Œæå‡ºçš„ï¼Œä½†æˆ‘ä»¬è§‚å¯Ÿåˆ°ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒåŸºçº¿ RAG çš„è¡¨ç°å¹¶ä¸ç†æƒ³ã€‚ä»¥ä¸‹æ˜¯å‡ ä¸ªå…¸å‹çš„åœºæ™¯ï¼š

1. **åŸºçº¿ RAG å¾ˆéš¾å°†ä¿¡æ¯ä¸²è”èµ·æ¥**ï¼šå½“ä¸€ä¸ªé—®é¢˜çš„ç­”æ¡ˆéœ€è¦é€šè¿‡å¤šä¸ªä¸åŒçš„ä¿¡æ¯ç‰‡æ®µï¼Œå¹¶é€šè¿‡å®ƒä»¬å…±äº«çš„å±æ€§æ¥è¿æ¥ï¼Œè¿›è€Œæä¾›æ–°çš„ç»¼åˆè§è§£æ—¶ï¼ŒåŸºçº¿ RAG è¡¨ç°å¾—å¾ˆå·®ã€‚

2. ä¾‹å¦‚ï¼Œåœ¨å›ç­”ç±»ä¼¼â€œå¦‚ä½•é€šè¿‡ç°æœ‰çš„æ•°æ®æ¨æ–­å‡ºæ–°ç»“è®ºâ€è¿™ç§é—®é¢˜æ—¶ï¼ŒåŸºçº¿ RAG æ— æ³•å¾ˆå¥½åœ°å¤„ç†è¿™äº›æ•£å¸ƒåœ¨ä¸åŒæ–‡æ¡£ä¸­çš„ç›¸å…³ä¿¡æ¯ï¼Œå®ƒå¯èƒ½ä¼šé—æ¼ä¸€äº›å…³é”®è”ç³»ç‚¹ã€‚

3. **åŸºçº¿ RAG æ— æ³•æœ‰æ•ˆç†è§£å¤§å‹æ•°æ®é›†æˆ–å•ä¸€å¤§æ–‡æ¡£çš„æ•´ä½“è¯­ä¹‰æ¦‚å¿µ**ï¼šå½“è¢«è¦æ±‚åœ¨å¤§é‡æ•°æ®æˆ–å¤æ‚æ–‡æ¡£ä¸­è¿›è¡Œæ€»ç»“ã€æç‚¼å’Œç†è§£æ—¶ï¼ŒåŸºçº¿ RAG å¾€å¾€è¡¨ç°ä¸ä½³ã€‚

4. ä¾‹å¦‚ï¼Œå¦‚æœé—®é¢˜è¦æ±‚å¯¹æ•´ä¸ªæ–‡æ¡£æˆ–å¤šç¯‡æ–‡æ¡£çš„ä¸»é¢˜è¿›è¡Œæ€»ç»“å’Œç†è§£ï¼ŒåŸºçº¿ RAG çš„ç®€å•å‘é‡æ£€ç´¢æ–¹æ³•å¯èƒ½æ— æ³•å¤„ç†æ–‡æ¡£é—´çš„å¤æ‚å…³ç³»ï¼Œå¯¼è‡´å¯¹å…¨å±€è¯­ä¹‰çš„ç†è§£ä¸å®Œæ•´ã€‚

â€ƒâ€ƒä¸ºäº†åº”å¯¹è¿™äº›æŒ‘æˆ˜ï¼ŒæŠ€æœ¯ç¤¾åŒºæ­£åœ¨åŠªåŠ›å¼€å‘æ‰©å±•å’Œå¢å¼º RAG çš„æ–¹æ³•ã€‚**å¾®è½¯ç ”ç©¶é™¢**ï¼ˆMicrosoft Researchï¼‰æå‡ºçš„ **GraphRAG** æ–¹æ³•ï¼Œä½¿ç”¨ **LLM** åŸºäºè¾“å…¥è¯­æ–™åº“æ„å»º **çŸ¥è¯†å›¾è°±**ã€‚è¿™ä¸ªå›¾è°±ä¸ç¤¾åŒºæ€»ç»“å’Œå›¾è°±æœºå™¨å­¦ä¹ è¾“å‡ºç»“åˆï¼Œèƒ½å¤Ÿåœ¨æŸ¥è¯¢æ—¶å¢å¼ºæç¤ºï¼ˆpromptï¼‰ã€‚GraphRAG åœ¨å›ç­”ä»¥ä¸Šä¸¤ç±»é—®é¢˜æ—¶ï¼Œå±•ç¤ºäº† **æ˜¾è‘—çš„æ”¹è¿›**ï¼Œå°¤å…¶æ˜¯åœ¨ **å¤æ‚ä¿¡æ¯çš„æ¨ç†èƒ½åŠ›** å’Œ **æ™ºèƒ½æ€§** ä¸Šï¼Œè¶…è¶Šäº†åŸºçº¿ RAG ä¹‹å‰åº”ç”¨äºç§æœ‰æ•°æ®é›†çš„å…¶ä»–æ–¹æ³•ã€‚

* GraphRAG+ollamaæœ¬åœ°éƒ¨ç½²ä¼˜åŠ¿

â€ƒâ€ƒæ¥ä¸‹æ¥æˆ‘ä»¬è€ƒè™‘å°†GraphRAGä¸Ollamaæœ¬åœ°éƒ¨ç½²ç»“åˆä½¿ç”¨ï¼Œèƒ½å¤Ÿæ˜¾è‘—æå‡çŸ¥è¯†å›¾è°±æ„å»ºä¸æŸ¥è¯¢çš„æ•ˆç‡ï¼Œä¸”å…·å¤‡å¤šæ–¹é¢çš„ä¼˜åŠ¿ï¼š

1. **é«˜æ•ˆçš„æ•°æ®å¤„ç†ä¸æŸ¥è¯¢**ï¼šGraphRAGé‡‡ç”¨å›¾ç¥ç»ç½‘ç»œå’Œå›¾è®¡ç®—æŠ€æœ¯ï¼Œèƒ½å¤Ÿå¿«é€Ÿå¤„ç†æµ·é‡æ•°æ®ï¼Œå¹¶åŸºäºæ·±åº¦å­¦ä¹ ç”Ÿæˆç²¾ç¡®çš„çŸ¥è¯†å›¾è°±ã€‚ç»“åˆOllamaçš„æœ¬åœ°å¤§è¯­è¨€æ¨¡å‹ï¼Œå¯ä»¥åœ¨æ— éœ€ä¾èµ–å¤–éƒ¨äº‘æœåŠ¡çš„æƒ…å†µä¸‹ï¼Œç›´æ¥åœ¨æœ¬åœ°ç¯å¢ƒä¸­è¿›è¡Œå¿«é€Ÿã€ç²¾å‡†çš„æŸ¥è¯¢å’Œæ¨ç†ï¼Œå¤§å¤§å‡å°‘äº†ç½‘ç»œå»¶è¿Ÿå’Œå¤–éƒ¨APIè°ƒç”¨çš„ä¾èµ–ã€‚

2. **æ•°æ®éšç§ä¸å®‰å…¨æ€§**ï¼šæœ¬åœ°éƒ¨ç½²æ„å‘³ç€æ•°æ®æ— éœ€ä¸Šä¼ è‡³å¤–éƒ¨æœåŠ¡å™¨ï¼Œèƒ½å¤Ÿå®Œå…¨æ§åˆ¶æ•°æ®è®¿é—®å’Œå¤„ç†æµç¨‹ã€‚è¿™å¯¹äºéœ€è¦ä¸¥æ ¼æ•°æ®éšç§ä¿æŠ¤çš„ä¼ä¸šå’Œæœºæ„æ¥è¯´ï¼Œæ˜¯ä¸€ä¸ªè‡³å…³é‡è¦çš„ä¼˜åŠ¿ï¼Œç¡®ä¿äº†æ•æ„Ÿä¿¡æ¯ä¸ä¼šæ³„éœ²æˆ–å—åˆ°ä¸å¿…è¦çš„è®¿é—®ã€‚

3. **å¯å®šåˆ¶åŒ–ä¸çµæ´»æ€§**ï¼šGraphRAGå’ŒOllamaéƒ½æä¾›äº†é«˜çµæ´»æ€§çš„APIæ¥å£ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚å®šåˆ¶å›¾è°±æ„å»ºæµç¨‹å’ŒæŸ¥è¯¢ç­–ç•¥ã€‚åŒæ—¶ï¼Œæœ¬åœ°éƒ¨ç½²å¯ä»¥æ ¹æ®å…·ä½“çš„ç¡¬ä»¶èµ„æºè¿›è¡Œä¼˜åŒ–ï¼Œæä¾›æ›´é«˜çš„è®¡ç®—æ€§èƒ½å’Œå¯æ‰©å±•æ€§ã€‚

4. **å‡å°‘äº‘è®¡ç®—è´¹ç”¨**ï¼šé€šè¿‡å°†GraphRAGä¸Ollamaéƒ¨ç½²åœ¨æœ¬åœ°æœåŠ¡å™¨ï¼Œä¼ä¸šå¯ä»¥å‡å°‘å¯¹äº‘è®¡ç®—èµ„æºçš„ä¾èµ–ï¼Œé™ä½é•¿æœŸçš„è¿è¥æˆæœ¬ï¼Œå°¤å…¶æ˜¯å¯¹éœ€è¦é¢‘ç¹è¿›è¡Œå¤§è§„æ¨¡å›¾è°±æŸ¥è¯¢å’Œå¤„ç†çš„åœºæ™¯ï¼Œèƒ½å¤Ÿæ˜¾è‘—èŠ‚çœäº‘æœåŠ¡è´¹ç”¨ã€‚

5. **å®æ—¶å“åº”ä¸é«˜ååé‡**ï¼šç»“åˆæœ¬åœ°éƒ¨ç½²çš„ç¡¬ä»¶ä¼˜åŠ¿ï¼ŒGraphRAGä¸Ollamaèƒ½å¤Ÿå®ç°å®æ—¶çš„çŸ¥è¯†å›¾è°±æŸ¥è¯¢å’Œç”Ÿæˆï¼Œæ»¡è¶³å¯¹é«˜ååé‡å’Œå¿«é€Ÿå“åº”çš„éœ€æ±‚ã€‚è¿™å¯¹äºå®æ—¶æ•°æ®åˆ†æã€å†³ç­–æ”¯æŒç³»ç»Ÿç­‰åº”ç”¨åœºæ™¯å°¤ä¸ºé‡è¦ã€‚

6. **æ— ç¼é›†æˆä¸æ‰©å±•æ€§**ï¼šGraphRAGä¸Ollamaçš„æœ¬åœ°éƒ¨ç½²ä¸ä»…èƒ½æ— ç¼é›†æˆç°æœ‰çš„ITåŸºç¡€è®¾æ–½ï¼Œè¿˜èƒ½å¤Ÿéšç€ä¸šåŠ¡éœ€æ±‚çš„å˜åŒ–çµæ´»æ‰©å±•ã€‚ç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªå·±çš„åº”ç”¨åœºæ™¯ï¼Œè¿›ä¸€æ­¥é›†æˆå…¶ä»–å·¥å…·å’Œæ¡†æ¶ï¼Œå½¢æˆå¼ºå¤§çš„çŸ¥è¯†å¤„ç†ä¸æ¨ç†å¹³å°ã€‚

é€šè¿‡GraphRAGå’ŒOllamaçš„æœ¬åœ°éƒ¨ç½²ï¼Œä¼ä¸šå’Œå¼€å‘è€…èƒ½å¤Ÿåœ¨ä¿è¯æ•°æ®å®‰å…¨å’Œéšç§çš„å‰æä¸‹ï¼Œå®ç°é«˜æ•ˆã€çµæ´»ã€ä½æˆæœ¬çš„çŸ¥è¯†å›¾è°±æ„å»ºä¸æŸ¥è¯¢ï¼Œæ¨åŠ¨æ™ºèƒ½å†³ç­–å’Œä¸šåŠ¡åˆ›æ–°ã€‚

### äºŒã€Ollamaé¡¹ç›®ä»‹ç»ä¸æ ¸å¿ƒåŠŸèƒ½é€Ÿè§ˆ

#### 1.Ollamaé¡¹ç›®ä»‹ç»

â€ƒâ€ƒOllama æ˜¯ä¸€ä¸ª**å¼€æº**çš„å¤§è¯­è¨€æ¨¡å‹æœåŠ¡å·¥å…·ï¼Œä¸“æ³¨äºç®€åŒ–æœ¬åœ°æ¨¡å‹çš„åˆ›å»ºã€ç®¡ç†å’Œéƒ¨ç½²æµç¨‹ã€‚å®ƒå…è®¸ç”¨æˆ·è½»æ¾éƒ¨ç½²å’Œç®¡ç†å¤šç§æµè¡Œçš„**å¼€æºæ¨¡å‹**ï¼Œå¦‚ Llamaã€Mistral å’Œ Code Llamaã€‚ä»¥ä¸‹æ˜¯ Ollama çš„ä¸€äº›ä¸»è¦ç‰¹ç‚¹å’ŒåŠŸèƒ½ï¼š

ä¸»è¦ç‰¹ç‚¹ï¼š

* ç®€åŒ–éƒ¨ç½²ï¼š
  Ollama é€šè¿‡å°†æ¨¡å‹æƒé‡ã€é…ç½®å’Œæ•°æ®æ†ç»‘åˆ°ä¸€ä¸ªç§°ä¸º Modelfile çš„åŒ…ä¸­ï¼Œç®€åŒ–äº†æ¨¡å‹çš„å®‰è£…å’Œé…ç½®è¿‡ç¨‹ï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥æ›´æ–¹ä¾¿åœ°ç®¡ç†å’Œè¿è¡Œè¿™äº›æ¨¡å‹ã€‚

* è·¨å¹³å°æ”¯æŒï¼š
  Ollama æ”¯æŒå¤šç§æ“ä½œç³»ç»Ÿï¼ŒåŒ…æ‹¬ macOSã€Linux å’Œ Windowsã€‚ç”¨æˆ·åªéœ€ä¸‹è½½ç›¸åº”å¹³å°çš„å®‰è£…åŒ…å³å¯å¿«é€Ÿå®‰è£…å’Œä½¿ç”¨ã€‚

* å‘½ä»¤è¡Œæ“ä½œï¼š
  ç”¨æˆ·å¯ä»¥é€šè¿‡ç®€å•çš„å‘½ä»¤è¡ŒæŒ‡ä»¤æ¥å¯åŠ¨å’Œè¿è¡Œæ¨¡å‹ã€‚ä¾‹å¦‚ï¼Œè¿è¡Œä¸€ä¸ªæ¨¡å‹åªéœ€æ‰§è¡Œç±»ä¼¼ ollama run model\_name çš„å‘½ä»¤ã€‚

* èµ„æºè¦æ±‚ï¼š
  ç›¸è¾ƒäºä¼ ç»Ÿéƒ¨ç½²è°ƒç”¨æ¨¡å‹çš„æ–¹æ³•ï¼ŒOllamaæ¨¡å‹æ”¯æŒæ¨ç†çš„å‡ä¸ºé‡åŒ–åçš„æ¨¡å‹ï¼Œè¿™ç§æ–¹å¼å¯¹ç¡¬ä»¶èµ„æºçš„éœ€æ±‚æ›´ä½ï¼Œæ›´é€‚åˆå¼€å‘è€…å¿«é€Ÿä¸Šæ‰‹ã€‚

* API æ¥å£ï¼š
  Ollama æä¾›äº†ç±»ä¼¼ OpenAI çš„ API æ¥å£ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡è¿™äº›æ¥å£ä¸æ¨¡å‹è¿›è¡Œäº¤äº’ï¼Œæ”¯æŒçƒ­åŠ è½½æ¨¡å‹æ–‡ä»¶ï¼Œæ— éœ€é‡æ–°å¯åŠ¨å³å¯åˆ‡æ¢ä¸åŒçš„æ¨¡å‹ã€‚

Ollama éå¸¸é€‚åˆéœ€è¦åœ¨æœ¬åœ°è¿è¡Œå¤§è¯­è¨€æ¨¡å‹çš„å¼€å‘è€…å’Œä¼ä¸šï¼Œå¦‚ï¼š

* å¼€å‘å’Œæµ‹è¯•ï¼šåœ¨æœ¬åœ°å¿«é€Ÿåˆ›å»ºå’Œæµ‹è¯•æ–°çš„è¯­è¨€æ¨¡å‹ã€‚

* éšç§ä¿æŠ¤ï¼šåœ¨æœ¬åœ°éƒ¨ç½²æ¨¡å‹ï¼Œé€‚ç”¨äºæœ‰ä¸¥æ ¼éšç§éœ€æ±‚çš„ä¼ä¸šã€‚

* å¤šæ¨¡å‹ç®¡ç†ï¼šè½»æ¾ç®¡ç†å’Œéƒ¨ç½²å¤šä¸ªæ¨¡å‹ï¼Œé€‚åˆæœ‰å¤§é‡æ¨¡å‹ç®¡ç†éœ€æ±‚çš„å›¢é˜Ÿã€‚

Ollama é€‚ç”¨äºå­¦æœ¯ç ”ç©¶ã€ä¸ªäººé¡¹ç›®å¼€å‘ä»¥åŠä¼ä¸šçŸ¥è¯†åº“é—®ç­”ç­‰å¤šç§åœºæ™¯ï¼Œå¸®åŠ©ç”¨æˆ·åœ¨æœ¬åœ°ç¯å¢ƒä¸­å¿«é€Ÿå®éªŒå’Œéƒ¨ç½²å¤§å‹è¯­è¨€æ¨¡å‹ã€‚

æ€»çš„æ¥è¯´ï¼ŒOllama ä¸ºå¸Œæœ›åœ¨æœ¬åœ°è¿è¡Œå’Œå®éªŒå¤§å‹è¯­è¨€æ¨¡å‹çš„ç”¨æˆ·æä¾›äº†ä¸€ä¸ªæ–¹ä¾¿ä¸”é«˜æ•ˆçš„è§£å†³æ–¹æ¡ˆã€‚

#### 2.Ollamaè¿è¡Œæ‰€éœ€ç¡¬ä»¶æ”¯æŒ

â€ƒâ€ƒä¸‹åˆ—è¡¨æ ¼æ˜¯Ollamaæ”¯æŒçš„å…¨éƒ¨æ˜¾å¡çš„åˆ—è¡¨ï¼Œå¤§å®¶å¯ä»¥å‚è€ƒæ¥ç¡®å®šè‡ªå·±çš„è®¾å¤‡æ˜¯å¦å¯ä»¥ä½¿ç”¨è¯¥æ¨ç†æ¡†æ¶ã€‚

Nvidiaè‹±ä¼Ÿè¾¾ç³»åˆ—æ˜¾å¡ï¼š

![](images/f2a51093-fe86-4fd7-9843-5b4b1d78cc4a.png)

AMDç³»åˆ—æ˜¾å¡ï¼š

* Linuxç¯å¢ƒï¼š

![](images/f4b0f592-43b4-4f97-b7e9-0b618e0330b1.png)

* Windowsç¯å¢ƒï¼š

![](images/7b3187d5-544d-448c-b0b1-cdf84455634a.png)

#### 3.Ollamaå¿«é€Ÿä½¿ç”¨æ–¹æ³•

æœ¬å°èŠ‚å¿«é€Ÿä»‹ç»å¦‚æœä¸Šæ‰‹ä½¿ç”¨Ollamaå¹¶å®Œæˆä¸€æ¬¡æ¨¡å‹çš„éƒ¨ç½²ã€å¯åŠ¨ã€‚

åœ¨æœç´¢æ ï¼ˆSearch modelsï¼‰ä¸­è¾“å…¥ä½ æƒ³è¦çš„æ¨¡å‹çš„åç§°ï¼Œåœ¨ä¸‹æ–¹ç•Œé¢ä¾¿ä¼šæ˜¾ç¤ºå¹³å°ä¸Šæ”¯æŒçš„æ¨¡å‹åˆ—è¡¨ï¼š

![](images/2e5d05e2-0550-4b2f-af82-3506be6a6ed1.png)

è¿™é‡Œä»¥qwen2.5ä¸ºä¾‹è¿›è¡Œéƒ¨ç½²æ¼”ç¤ºï¼š

![](images/5c4bc69f-1a3e-43fa-abe3-077eaed0bab0.png)

æ¯ä¸ªæ¨¡å‹ä¸‹é¢æœ‰æ”¯æŒçš„åŠŸèƒ½å’Œå‚æ•°å‹å·ä»¥åŠåŸºæœ¬çš„æ¨¡å‹æè¿°ï¼Œç‚¹å‡»è¿›å…¥å¯¹åº”æ¨¡å‹å¯ä»¥çœ‹åˆ°ä¸‹è½½æ‰€éœ€å ç”¨çš„å†…å­˜å¤§å°ã€‚

![](images/c464e00b-ded6-42ea-a0d7-6cb93d9125e2.png)

ç‚¹å‡»å·¦è¾¹ä¸‹æ‹‰åˆ—è¡¨å¯ä»¥é€‰æ‹©ä¸åŒå‚æ•°çš„æ¨¡å‹ï¼Œå¤§å®¶å¯ä»¥æ ¹æ®è‡ªå·±çš„ç¡¬ä»¶æ¡ä»¶å’Œä½¿ç”¨éœ€è¦æ¥é€‰æ‹©å¯¹åº”çš„æ¨¡å‹ï¼Œåœ¨å³ä¾§ä¼šæ˜¾ç¤ºå¯¹åº”æ¨¡å‹çš„å¯åŠ¨ä»£ç ã€‚

**ä½¿ç”¨7bæ¨¡å‹éœ€è¦6Gå·¦å³çš„æ˜¾å­˜ï¼Œ14bæ¨¡å‹éœ€è¦12Gå·¦å³çš„æ˜¾å­˜ï¼Œ72bæ¨¡å‹éœ€è¦60Gçš„æ˜¾å­˜è¿›è¡Œæ¨ç†ã€‚**

![](images/b0efe858-f398-46e3-af15-e5827e8b07cd.png)

**ä¸‹è½½æ¨¡å‹**

åœ¨ç»ˆç«¯ä¸­æ‰§è¡Œå‘½ä»¤ `ollama run qwen2.5ï¼š72b` ï¼Œå³å¯ä¸‹è½½ qwen2.5ï¼š72b æ¨¡å‹ã€‚æ¨¡å‹ä¸‹è½½å®Œæˆåï¼Œä¼šè‡ªåŠ¨å¯åŠ¨å¤§æ¨¡å‹ï¼Œè¿›å…¥å‘½ä»¤è¡Œäº¤äº’æ¨¡å¼ï¼Œç›´æ¥è¾“å…¥æŒ‡ä»¤ï¼Œå°±å¯ä»¥å’Œæ¨¡å‹è¿›è¡Œå¯¹è¯äº†å¯¹åº”å‚æ•°çš„æ¨¡å‹çš„ä¸‹è½½æ–¹å¼å¯ä»¥é€šè¿‡åœ¨Ollamaå®˜ç½‘æŸ¥çœ‹åˆ°ä¸‹è½½æŒ‡ä»¤ã€‚å½“å‡ºç°`success`å­—æ ·çš„æ—¶å€™è¯´æ˜ä¸‹è½½æˆåŠŸï¼Œå½“å‡ºç°`>>>`å›¾æ ‡çš„æ—¶å€™å¯ä»¥è¿›è¡Œå¯¹è¯äº¤äº’äº†ã€‚

```plaintext
ollama run qwen2.5:72b
```

![](images/7561f12c-a643-4a37-9fc1-34f9ea2700c6.png)

å®Œæˆä¸‹è½½åä¼šç›´æ¥è¿›å…¥æ¨¡å‹å¯åŠ¨çŠ¶æ€ï¼Œå¦‚æœé€€å‡ºæˆ–åˆ·æ–°ç•Œé¢ï¼Œå†æ¬¡è¾“å…¥æŒ‡ä»¤`ollama run qwen2.5:72b`å³å¯å¯åŠ¨å¯¹åº”æ¨¡å‹ã€‚
å¯ä»¥çœ‹åˆ°æ¨ç†æ‰€éœ€çš„è®¡ç®—èµ„æºç›¸å¯¹å‡åŒ€çš„åˆ†å¸ƒåœ¨æ¯å¼ å·¥ä½œæ˜¾å¡ä¸Šã€‚

![](images/6e34d994-30db-40f9-a52c-8e56a30fea98.png)

å¦‚æœæƒ³ç»“æŸå¯¹è¯ï¼Œç›´æ¥åœ¨å¯¹è¯æ ä¸­è¾“å…¥`/bye`å³å¯ç»“æŸè¿›ç¨‹ã€‚

![](images/1fda2acc-8be7-4db1-99f3-525a925c62bd.png)

#### 4.ä½¿ç”¨ModelScopeå¹³å°ä¸Šçš„GGUFæ ¼å¼çš„å¤§æ¨¡å‹

å¦‚æœè¦ä½¿ç”¨çš„æ¨¡å‹ä¸åœ¨ Ollama æ¨¡å‹åº“ï¼Œå¯ä»¥é€šè¿‡é€‰æ‹©GGUF (GPT-Generated Unified Format)æ¨¡å‹æ¥å®ç°éƒ¨ç½²ã€ä½¿ç”¨ã€‚
GGUF æ˜¯ç”± llama.cpp å®šä¹‰çš„ä¸€ç§é«˜æ•ˆå­˜å‚¨å’Œäº¤æ¢å¤§æ¨¡å‹é¢„è®­ç»ƒç»“æœçš„äºŒè¿›åˆ¶æ ¼å¼ã€‚

Ollama æ”¯æŒé‡‡ç”¨ Modelfile æ–‡ä»¶ä¸­å¯¼å…¥ GGUF æ¨¡å‹ã€‚

* Ollama æ˜¯ä¸€ä¸ªåŸºäºå¼€æºæ¨ç†å¼•æ“ llama.cpp æ„å»ºçš„å¤§æ¨¡å‹æ¨ç†å·¥å…·æ¡†æ¶ã€‚å€ŸåŠ©åº•å±‚å¼•æ“çš„é«˜æ•ˆæ¨ç†èƒ½åŠ›ä»¥åŠå¯¹å¤šç§ç¡¬ä»¶çš„é€‚é…æ”¯æŒï¼ŒOllama å¯ä»¥åœ¨åŒ…æ‹¬ CPU å’Œ GPU åœ¨å†…çš„å¤šç§ç¡¬ä»¶ç¯å¢ƒä¸Šè¿è¡Œå„ç§ç²¾åº¦çš„ GGUF æ ¼å¼å¤§æ¨¡å‹ã€‚é€šè¿‡ç®€å•çš„å‘½ä»¤è¡Œæ“ä½œï¼Œå³å¯å¿«é€Ÿå¯åŠ¨ LLM æ¨¡å‹æœåŠ¡ã€‚

* ModelScope ç¤¾åŒºæ‰˜ç®¡äº†æ•°åƒä¸ªé«˜è´¨é‡çš„ GGUF æ ¼å¼å¤§æ¨¡å‹ï¼Œå¹¶æ”¯æŒä¸ Ollama æ¡†æ¶å’Œ ModelScope å¹³å°çš„æ— ç¼å¯¹æ¥ã€‚ç”¨æˆ·åªéœ€ä½¿ç”¨ç®€å•çš„ ollama run å‘½ä»¤ï¼Œå³å¯ç›´æ¥åŠ è½½å¹¶è¿è¡Œ ModelScope æ¨¡å‹åº“ä¸­çš„ GGUF æ¨¡å‹ã€‚

ModelScopeå®˜ç½‘é“¾æ¥å¦‚ä¸‹ï¼šhttps://www.modelscope.cn/models

ä½¿ç”¨Ollamaä¸‹è½½å’Œä½¿ç”¨GGUFæ ¼å¼çš„æ¨¡å‹åœ¨æ–¹æ³•ä¸Šæ²¡æœ‰å˜åŒ–ï¼Œä¾æ—§æ˜¯åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥ä»¥ä¸‹å‘½ä»¤å³å¯å®ç°ï¼š

```plaintext
ollama run modelscope.cn/{model-id}
```

å…¶ä¸­model-idçš„å…·ä½“æ ¼å¼ä¸º{username}/{model},è¿™ä¸ªä¿¡æ¯å¯ä»¥åœ¨modelscopeä¸Šæ¯ä¸ªæ¨¡å‹è‡ªå·±çš„æ ‡ç­¾é¡µä¸ŠæŸ¥çœ‹å¹¶å¤åˆ¶ã€‚

![](images/9d3555d2-5ac8-445a-ba86-e4e05ada9374.png)

### ä¸‰ã€åˆ›å»ºé€‚é…GraphRAGçš„æœ¬åœ°ollama+å¤§æ¨¡å‹è¿è¡Œç¯å¢ƒ

#### Step 1.åŸºç¡€ç¯å¢ƒæ­å»º

* **åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ**

```bash
conda create --name graphrag-ollama python=3.10
conda init
source ~/.bashrc
conda activate graphrag-ollama
conda install jupyterlab
conda install ipykernel
python -m ipykernel install --user --name graphrag-ollama --display-name "Python (graphrag-ollama)"
```

* **å®‰è£…é­”æ­ç¤¾åŒº**

```bash
pip install modelscope
```

```python
!pip install modelscope
```

```plaintext
Looking in indexes: http://mirrors.aliyun.com/pypi/simple
Requirement already satisfied: modelscope in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (1.20.1)
Requirement already satisfied: requests>=2.25 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from modelscope) (2.32.3)
Requirement already satisfied: tqdm>=4.64.0 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from modelscope) (4.67.1)
Requirement already satisfied: urllib3>=1.26 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from modelscope) (2.2.3)
Requirement already satisfied: charset-normalizer<4,>=2 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from requests>=2.25->modelscope) (3.3.2)
Requirement already satisfied: idna<4,>=2.5 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from requests>=2.25->modelscope) (3.7)
Requirement already satisfied: certifi>=2017.4.17 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from requests>=2.25->modelscope) (2024.8.30)
[33mWARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager, possibly rendering your system unusable.It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv. Use the --root-user-action option if you know what you are doing and want to suppress this warning.[0m[33m
[0m
```

https://www.modelscope.cn/

* **å®‰è£…ollama**

https://ollama.com/

```python
!curl -fsSL https://ollama.com/install.sh | sh
```

```plaintext
>>> Installing ollama to /usr/local
^C
```

![](images/eaf3fca9-7b68-4b65-9e57-437dc24b7124.png)

* **å®‰è£…ollama Python SDK**

```python
!pip install ollama
```

```plaintext
Looking in indexes: http://mirrors.aliyun.com/pypi/simple
Requirement already satisfied: ollama in /root/miniconda3/envs/graphrag-ollama/lib/python3.10/site-packages (0.4.2)
Requirement already satisfied: httpx<0.28.0,>=0.27.0 in /root/miniconda3/envs/graphrag-ollama/lib/python3.10/site-packages (from ollama) (0.27.0)
Requirement already satisfied: pydantic<3.0.0,>=2.9.0 in /root/miniconda3/envs/graphrag-ollama/lib/python3.10/site-packages (from ollama) (2.10.2)
Requirement already satisfied: anyio in /root/miniconda3/envs/graphrag-ollama/lib/python3.10/site-packages (from httpx<0.28.0,>=0.27.0->ollama) (4.6.2)
Requirement already satisfied: certifi in /root/miniconda3/envs/graphrag-ollama/lib/python3.10/site-packages (from httpx<0.28.0,>=0.27.0->ollama) (2024.8.30)
Requirement already satisfied: httpcore==1.* in /root/miniconda3/envs/graphrag-ollama/lib/python3.10/site-packages (from httpx<0.28.0,>=0.27.0->ollama) (1.0.2)
Requirement already satisfied: idna in /root/miniconda3/envs/graphrag-ollama/lib/python3.10/site-packages (from httpx<0.28.0,>=0.27.0->ollama) (3.7)
Requirement already satisfied: sniffio in /root/miniconda3/envs/graphrag-ollama/lib/python3.10/site-packages (from httpx<0.28.0,>=0.27.0->ollama) (1.3.0)
Requirement already satisfied: h11<0.15,>=0.13 in /root/miniconda3/envs/graphrag-ollama/lib/python3.10/site-packages (from httpcore==1.*->httpx<0.28.0,>=0.27.0->ollama) (0.14.0)
Requirement already satisfied: annotated-types>=0.6.0 in /root/miniconda3/envs/graphrag-ollama/lib/python3.10/site-packages (from pydantic<3.0.0,>=2.9.0->ollama) (0.7.0)
Requirement already satisfied: pydantic-core==2.27.1 in /root/miniconda3/envs/graphrag-ollama/lib/python3.10/site-packages (from pydantic<3.0.0,>=2.9.0->ollama) (2.27.1)
Requirement already satisfied: typing-extensions>=4.12.2 in /root/miniconda3/envs/graphrag-ollama/lib/python3.10/site-packages (from pydantic<3.0.0,>=2.9.0->ollama) (4.12.2)
Requirement already satisfied: exceptiongroup>=1.0.2 in /root/miniconda3/envs/graphrag-ollama/lib/python3.10/site-packages (from anyio->httpx<0.28.0,>=0.27.0->ollama) (1.2.0)
[33mWARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager, possibly rendering your system unusable.It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv. Use the --root-user-action option if you know what you are doing and want to suppress this warning.[0m[33m
[0m
```

* **å¯åŠ¨ollama**

```bash
ollama start
```

![](images/117a4250-6518-4b68-b5d1-1fe9e26d93f6.png)

* **åˆ›å»ºæ¨¡å­˜æ”¾å‹æ–‡ä»¶å¤¹**

```bash
cd ~/auto-tmp
mkdir models
```

![](images/11719769-1524-4b33-a436-cb673ee83069.png)

#### Step 2.æ¨¡å‹æ–‡ä»¶ä¸‹è½½

* **ä¸‹è½½Embeddingæ¨¡å‹**

â€ƒâ€ƒé¦–å…ˆæ‰¾åˆ°åˆé€‚çš„Embeddingæ¨¡å‹ï¼š

https://ollama.com/library/nomic-embed-text

![](images/6dfe0c47-5c04-470e-aac3-b1a245e218f7.png)

è€ƒè™‘åˆ°å›½å†…ç½‘ç»œç¯å¢ƒï¼Œæ¨èåœ¨é­”æ­ç¤¾åŒºä¸‹è½½GGUFæ¨¡å‹æ–‡ä»¶ä»¥ä¾¿ç›´æ¥è°ƒç”¨ï¼š

https://www.modelscope.cn/models/Embedding-GGUF/nomic-embed-text-v1.5-GGUF

![](images/992e4979-6df5-4228-be26-f9dd5838d9e4.png)

ç„¶åå³å¯ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è¿›è¡Œä¸‹è½½ï¼š

```bash
modelscope download --model Embedding-GGUF/nomic-embed-text-v1.5-GGUF nomic-embed-text-v1.5.f16.gguf --local_dir /root/autodl-tmp/models
```

![](images/7a23d8c5-78e9-4454-8e36-07d92c69e5f5.png)

ä¸‹è½½å®Œæˆåå³å¯åœ¨å¯¹åº”æ–‡ä»¶å¤¹å†…æŸ¥çœ‹æ¨¡å‹æ–‡ä»¶

![](images/cdff1a49-1167-4bb3-9045-be4c1ebaaff8.png)

* **ä¸‹è½½Qwen 2.5æ¨¡å‹**

https://www.modelscope.cn/models/Qwen/Qwen2.5-7B-Instruct-GGUF

![](images/1fc2e3c9-3a2a-44c9-8075-d35b828ba9e8.png)

ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è¿›è¡Œæ¨¡å‹ä¸‹è½½ï¼š

```bash
modelscope download --model Qwen/Qwen2.5-7B-Instruct-GGUF qwen2.5-7b-instruct-q4_k_m.gguf --local_dir /root/autodl-tmp/models
```

![](images/8cf76ddb-9bd5-4710-813a-b07ceb63683a.png)

ä¸‹è½½å®Œæˆåå³å¯åœ¨æ–‡ä»¶ä¸­æŸ¥çœ‹ï¼š

![](images/47bd0e0d-588c-457c-a5d6-1ef12e038a63.png)

#### Step 3.å€ŸåŠ©Ollamaè°ƒç”¨æœ¬åœ°å¤§æ¨¡å‹

* **ollamaæ¥å…¥æœ¬åœ°Embeddingæ¨¡å‹**

â€ƒâ€ƒé¦–å…ˆéœ€è¦ç¼–å†™Fileæ–‡ä»¶ï¼š

![](images/323e5a6a-1045-4c5e-b278-a0f7b7a0c495.png)

åœ¨åˆ›å»ºçš„`EmbeddingModelFile`æ–‡ä»¶ä¸­ï¼Œå†™å…¥Embeddingæ¨¡å‹åç§°:`FROM ./nomic-embed-text-v1.5.f16.gguf`

![](images/9034d956-1a67-480c-acfd-1ec67ef114f2.png)

ç„¶åå°†è¯¥æ¨¡å‹åŠ å…¥Ollamaæœ¬åœ°æ¨¡å‹åˆ—è¡¨ï¼š

```bash
ollama create nomic-embed-text -f EmbeddingModelFile
```

![](images/8e250563-e0c1-437f-bd87-acb92d06b9b1.png)

æ¥ä¸‹æ¥å³å¯æŸ¥çœ‹æ˜¯å¦å·²åŠ å…¥æ¨¡å‹åˆ—è¡¨

```bash
ollama list
```

![](images/71a6b01a-b9c9-4e18-be88-c903a13acbc1.png)

* **æµ‹è¯•å€ŸåŠ©Ollamaè°ƒç”¨Embeddingæ¨¡å‹**

```python
import requests

# è®¾ç½®API URL
url = 'http://localhost:11434/api/embeddings'

# è®¾ç½®è¯·æ±‚ä½“æ•°æ®
data = {
    "model": "nomic-embed-text",
    "prompt": "ä½ å¥½ï¼Œå¥½ä¹…ä¸è§ï¼"
}

# å‘é€POSTè¯·æ±‚å¹¶è·å–å“åº”
response = requests.post(url, json=data)

# æ‰“å°å“åº”å†…å®¹
if response.status_code == 200:
    print("Response:", response.json())
else:
    print(f"Request failed with status code {response.status_code}")
```

```plaintext
Response: {'embedding': [0.5030155181884766, 0.5766162872314453, -3.7013490200042725, -0.335124135017395, 0.19960707426071167, 0.5292040109634399, -1.295140266418457, 0.9638837575912476, -0.7146491408348083, -1.2640211582183838, -1.1092257499694824, 1.2582837343215942, -0.7344837188720703, -0.0645974725484848, -0.03351297974586487, -0.6603516340255737, 0.18097242712974548, -1.3903849124908447, -1.3223979473114014, 0.966265082359314, -1.3508286476135254, 1.7987627983093262, -0.44215893745422363, -1.063034176826477, 2.5026159286499023, 0.3557279706001282, 0.5653793811798096, 1.269382119178772, 0.5701422691345215, 0.37805813550949097, 0.24915452301502228, -0.8352833986282349, -0.21297705173492432, 0.00951287243515253, -0.9778848886489868, -0.8464807868003845, 0.3430193066596985, 0.16755202412605286, 0.8862990140914917, -0.5827988982200623, 0.28676384687423706, 1.2029043436050415, -0.03310413286089897, -0.3270547688007355, 1.9303107261657715, -0.5338603258132935, 0.16369764506816864, 0.6333567500114441, 0.7931520938873291, -0.7541064023971558, -2.0794403553009033, 0.2953717112541199, -0.09544339776039124, -0.7869447469711304, 1.2151222229003906, 1.8644295930862427, -0.4066644608974457, 0.2826476991176605, -0.31045058369636536, -0.383008748292923, 2.2383856773376465, 0.4884287416934967, -0.027995318174362183, 0.49492326378822327, 0.6812524795532227, -0.7521883249282837, 0.6075614094734192, 1.126321792602539, 0.028843363747000694, -0.46583983302116394, 0.27910536527633667, -0.350084513425827, -0.11055192351341248, 0.7808923125267029, -0.7316219210624695, -0.5697656273841858, -0.9932776093482971, 0.4652533531188965, -0.19964364171028137, -0.266091525554657, -0.31697309017181396, 0.0963641032576561, 2.7633252143859863, 0.9594886302947998, 0.404355525970459, 0.3807084560394287, -0.46225690841674805, 0.9236709475517273, 0.0006735324859619141, 1.558313250541687, 0.5272208452224731, -0.012162398546934128, 0.6303433179855347, 0.06785288453102112, -1.7631537914276123, -0.41500192880630493, 0.657379150390625, 1.1851352453231812, -0.53180992603302, -0.8718417882919312, -0.4464913606643677, 0.029592081904411316, -1.0824933052062988, 0.23153090476989746, 0.6653752326965332, 0.1289414018392563, -0.7908870577812195, 1.8008935451507568, -1.3261076211929321, -0.3140680491924286, 0.896865725517273, 1.3184020519256592, 0.40714502334594727, 0.6402151584625244, 0.3868490755558014, -0.07047116011381149, -0.1674484759569168, -0.44452622532844543, -0.8604117035865784, 0.47346752882003784, -0.8690305352210999, 0.2794378101825714, 0.9517558813095093, 0.9880949258804321, 0.6761890649795532, 0.7303520441055298, -0.7812688946723938, 1.3925845623016357, 0.6648522615432739, -1.2038217782974243, -0.8306519985198975, 0.6766155362129211, -0.1382993459701538, 0.26320353150367737, 0.29576122760772705, -0.13875755667686462, -1.220065712928772, 0.21852095425128937, 0.187504380941391, -0.0074964240193367004, -0.4490480422973633, -0.6788926124572754, 0.14474208652973175, -1.6394213438034058, -0.661054253578186, -0.4819876253604889, 0.11940008401870728, -0.8979319930076599, -1.040975570678711, 0.08487430214881897, 0.1623283326625824, -0.17226621508598328, 0.3379371762275696, 0.12136764824390411, 0.8818283081054688, -0.05727875605225563, 0.5129374265670776, 0.46075639128685, 1.4068270921707153, -0.4365572929382324, -0.11547070741653442, 0.9833958148956299, -0.022992372512817383, -0.6597012281417847, 1.2027531862258911, -0.9964978694915771, -1.3236502408981323, 1.530432105064392, 0.6527217030525208, 0.11031593382358551, -1.4934155941009521, -0.38936561346054077, -0.5874170064926147, 0.20713229477405548, -0.5894147157669067, -0.30154770612716675, 0.2828035056591034, -0.8054588437080383, 0.07382246851921082, -0.04146629944443703, 0.5125813484191895, -0.5210177898406982, 0.3195878863334656, 0.3438100814819336, -0.9655324220657349, -0.3924153745174408, -0.4337020516395569, 0.4407229721546173, -0.3546874523162842, -0.6103009581565857, -1.2962379455566406, 0.15651191771030426, -0.490395724773407, 0.21744230389595032, -0.3347201943397522, -0.6934791207313538, 0.1568143516778946, -0.12644624710083008, 0.49834373593330383, 0.182956725358963, -0.10993481427431107, -0.171905517578125, 0.44972577691078186, -0.3018589913845062, -0.33924734592437744, 0.5322362184524536, 0.12152183055877686, 0.8849823474884033, -0.40848541259765625, -0.23788441717624664, 1.0141658782958984, -0.47767841815948486, -0.5961735844612122, -0.0741133913397789, 0.8198844194412231, -0.8304308652877808, 0.3498041033744812, -0.8382187485694885, -1.4859105348587036, 0.10923713445663452, 0.4250703454017639, 0.578914999961853, 0.6767101883888245, -0.21125152707099915, 0.2883334159851074, 0.10701523721218109, -0.44745439291000366, 0.16334499418735504, -0.3399404287338257, -0.8509693145751953, -0.4749380350112915, -1.8723242282867432, 0.7449896931648254, 1.01506769657135, -0.1224319264292717, 1.5922449827194214, -0.360704243183136, 1.8605270385742188, -0.6400305032730103, 0.4632565379142761, -0.381875604391098, 0.8465956449508667, 0.6512719988822937, -0.378173291683197, -0.36881911754608154, 0.5500759482383728, -1.8241225481033325, -0.7561796307563782, -0.5186742544174194, 0.0718812644481659, -0.22252970933914185, -0.20114324986934662, 1.4486058950424194, 0.350197434425354, 1.1938363313674927, 0.36051836609840393, -1.0978666543960571, 0.14366866648197174, -0.07130328565835953, -0.977098822593689, 0.7565330266952515, -1.264866828918457, 0.68294757604599, -0.4595600366592407, -0.0358627624809742, -0.08750870823860168, -0.9336286187171936, 0.27484121918678284, -0.1609337478876114, -0.6071712970733643, 0.4068976044654846, 0.1568739116191864, 0.5799858570098877, 1.2237679958343506, 0.41691648960113525, -0.004176199436187744, 0.5362147092819214, 0.5202897787094116, -1.2519358396530151, 0.5762913823127747, -0.25519418716430664, 0.23807531595230103, -0.6714248061180115, 0.00991050899028778, -0.9284958839416504, 0.11034172773361206, 0.3505270183086395, 0.5755325555801392, 0.823313295841217, -0.8035579919815063, 0.3725201487541199, 0.20842847228050232, 0.27466076612472534, 1.8880571126937866, -1.4270648956298828, 0.791442334651947, 1.418575644493103, -0.6260051727294922, -0.32102012634277344, -0.255689412355423, 1.922835350036621, 0.21557405591011047, 0.37066811323165894, 0.10030987858772278, -0.7018635272979736, 0.2640904188156128, 1.5000501871109009, -0.8059607148170471, 0.6122104525566101, -1.1196531057357788, -0.5739046335220337, 1.3627464771270752, 0.2735885977745056, 0.44746696949005127, -1.890024185180664, -0.9255447387695312, 0.06044209003448486, 0.4495573937892914, 0.6287720203399658, -0.5779114961624146, 0.10139547288417816, -2.079667091369629, -0.36002692580223083, -0.5699114203453064, -0.1297096163034439, 0.781753420829773, -0.34343910217285156, 1.1344361305236816, 0.565563976764679, -0.7385990023612976, -0.7948824167251587, 1.7919706106185913, 0.8742200136184692, -0.9095770716667175, -0.6822004318237305, 0.9385193586349487, -1.3456541299819946, -0.4762156307697296, -0.4260348975658417, 2.1977310180664062, 0.5284144878387451, 0.4734780788421631, 1.3218077421188354, -0.35031574964523315, 1.2037383317947388, 1.2442198991775513, -0.4076915383338928, -0.45873939990997314, -0.4592089354991913, 0.3356609344482422, -0.06785215437412262, 0.01621592417359352, -0.7462717294692993, -0.16978514194488525, -0.7485285997390747, 0.40051528811454773, 0.17249621450901031, 1.341286063194275, 0.9970894455909729, -0.04468188434839249, 1.4367029666900635, 0.36665016412734985, -0.09901060163974762, 0.5829586386680603, -1.1883256435394287, 1.515159249305725, 1.2131431102752686, -0.18390831351280212, 0.3851194381713867, 0.769314169883728, -0.1783604919910431, -1.2780258655548096, -0.4779711067676544, -0.26493269205093384, -0.16520118713378906, 0.4728803038597107, -0.8811240792274475, -0.44496628642082214, 0.233504518866539, 0.08232717216014862, -0.4925227165222168, -0.9070545434951782, -0.11474171280860901, 0.1966269612312317, 0.7923592925071716, 0.04449385404586792, 1.1398504972457886, 0.1681278944015503, -0.024946361780166626, 1.5322011709213257, -0.6444401741027832, -1.5200175046920776, -1.472603440284729, -0.27975356578826904, -0.26002761721611023, -0.7265732884407043, 0.36502236127853394, 0.5638801455497742, 0.5082262754440308, -0.18578308820724487, -1.7458961009979248, -0.37115278840065, 0.09861156344413757, -0.35270947217941284, -0.37058189511299133, 0.8037777543067932, -0.02680998295545578, -0.6093921661376953, 2.7495758533477783, 0.37232527136802673, -0.284079909324646, 0.042607709765434265, -0.5947582721710205, -0.8571511507034302, 0.13048040866851807, 1.2252154350280762, 0.2000371217727661, -0.5023382306098938, 0.4061523377895355, -0.12292655557394028, 1.871940016746521, 0.9931501150131226, -0.5575183629989624, 0.8276843428611755, -0.3933553099632263, 0.6666101813316345, 1.2342119216918945, 0.500855028629303, 0.6913743019104004, -1.768007516860962, 0.1793481707572937, 0.7022168636322021, -0.010939717292785645, -0.09551223367452621, 0.37983059883117676, -0.5898646116256714, 0.7875058650970459, 0.5525990724563599, 0.1182946264743805, 0.4547750949859619, 0.2193506509065628, -1.0527141094207764, -0.6985371708869934, 0.4969986379146576, 0.3303636312484741, 1.2285046577453613, 1.492944598197937, -1.8726228475570679, 0.16584071516990662, -0.34652793407440186, 0.6967890858650208, 0.7971672415733337, -0.11879418790340424, 0.3835914134979248, 2.9736173152923584, -0.1504322737455368, -0.23165038228034973, -1.1637612581253052, 0.31683775782585144, 0.6635263562202454, 1.2760204076766968, 0.8823283314704895, -0.830947995185852, -0.21264922618865967, 0.20883670449256897, -1.1794649362564087, 0.2645607888698578, -0.0542217418551445, 0.6162258982658386, 0.725091278553009, -0.49312084913253784, 0.5401445627212524, 1.5277495384216309, -0.18729200959205627, 0.8791813850402832, -0.3937264084815979, -0.9197328090667725, 0.1713835448026657, -0.49099472165107727, 0.6734322309494019, 0.27252480387687683, -1.3503819704055786, 0.1444694697856903, -0.8934032320976257, -0.08267351984977722, 0.24778228998184204, 0.14629890024662018, 0.07950758934020996, -0.026364963501691818, 0.5295684933662415, 0.5754714608192444, -0.8817258477210999, 0.19070309400558472, -0.04672380909323692, 0.06956109404563904, 0.14326275885105133, -0.05479128658771515, 0.5989670753479004, -0.04908526688814163, 0.9901436567306519, -0.6511552929878235, -0.9779127836227417, -0.5410348773002625, 0.3943001329898834, 0.8437702655792236, -0.4972648024559021, 1.1921619176864624, -1.9543226957321167, -0.94593745470047, -0.6092044115066528, -1.3599470853805542, 0.6548841595649719, 0.3684276342391968, -0.9459508657455444, 0.680461049079895, -0.8270017504692078, 0.5129915475845337, 0.13175252079963684, -1.1508662700653076, 0.6539279222488403, 1.0763602256774902, -0.6157474517822266, -0.23096822202205658, 1.0535523891448975, -0.6582354307174683, 0.08849126845598221, -0.1511143296957016, -1.5038318634033203, 0.7000627517700195, 0.08407897502183914, 0.13112381100654602, -0.03636743873357773, -1.1834818124771118, -1.262599229812622, 0.16214358806610107, 0.3101198375225067, 1.6164360046386719, 0.20063315331935883, -0.10378678143024445, 0.6195053458213806, -0.5262821912765503, 1.225852131843567, -0.25685006380081177, 0.287779837846756, -0.183846578001976, 0.5118488073348999, -1.094374656677246, -0.10687573254108429, 0.5609338283538818, -0.0557711124420166, 0.7972105145454407, -0.7658674716949463, -0.09540335834026337, -0.06360990554094315, 0.01022176444530487, -1.3245409727096558, -0.4999214708805084, 0.6681820750236511, -1.0574214458465576, -1.198052167892456, 0.6353433728218079, 0.4630976617336273, -0.06892280280590057, -0.1693522334098816, 2.1348719596862793, -1.0606460571289062, 0.4603346586227417, 1.2862465381622314, 0.5036212801933289, -0.25750458240509033, -1.544715404510498, -1.2664257287979126, -0.8703944087028503, -0.7136809825897217, -0.28112998604774475, 0.08237340301275253, 0.42501750588417053, -0.3230800926685333, -2.0144903659820557, 0.5138172507286072, -0.12674710154533386, -0.26308879256248474, 0.19634249806404114, 0.6112330555915833, -0.9592097997665405, 0.9542784094810486, 0.43731439113616943, -0.9392215013504028, 1.5624850988388062, -0.30462881922721863, -0.435672402381897, 0.9970264434814453, -0.3333325982093811, 0.07651057839393616, -0.5369065403938293, 0.4852224290370941, -0.7734544277191162, -0.9837519526481628, -1.0727941989898682, 0.11373279243707657, 0.01469702273607254, 0.5223884582519531, 0.684454083442688, -1.4698327779769897, -1.5391490459442139, 1.203506350517273, -0.3971588909626007, 0.5718058347702026, 0.22575044631958008, -0.45633554458618164, 0.3032415509223938, 0.9929676055908203, 0.34513556957244873, -0.8208529353141785, 1.0068018436431885, -0.454091340303421, 1.125054121017456, -0.831908643245697, -0.6148259043693542, -0.13224934041500092, -0.20886681973934174, -0.21393224596977234, 0.825323224067688, -0.9151331186294556, 0.2539730668067932, 0.10240418463945389, -0.9838519096374512, 0.4603551924228668, -1.5391252040863037, 1.436201810836792, -0.7027348875999451, -0.3343997597694397, -0.581859827041626, -0.22468531131744385, -1.2771011590957642, 0.9514346718788147, -0.1977306604385376, -0.42085564136505127, -0.5985690355300903, -0.5158224701881409, 0.44361886382102966, 0.3991542458534241, 0.3268434405326843, 1.2960163354873657, 1.2882493734359741, -0.9945734739303589, 1.0732715129852295, 0.6672603487968445, 0.7896151542663574, -1.1176283359527588, 0.6364508271217346, 0.6672032475471497, 0.02828049659729004, 0.3814643621444702, -0.1674082726240158, -0.8188946843147278, 0.1617233008146286, -2.73663067817688, -0.9541912078857422, -0.7326268553733826, -0.11416646093130112, -0.48626837134361267, 0.04530510678887367, -1.1691280603408813, 0.2097804993391037, -0.4947543740272522, -0.6283475160598755, -0.8518832921981812, -2.264911413192749, -0.45738670229911804, 0.1590328812599182, -0.02566259726881981, -0.5004463195800781, -0.6707355976104736, 0.30260342359542847, 0.5876381993293762, 1.001715064048767, 0.5780003070831299, 0.3228062391281128, 0.9922370314598083, -0.47771409153938293, 0.44346684217453003, -0.08113697171211243, -0.5832905769348145, 0.30804064869880676, 0.4309738576412201, 0.6346299648284912, -1.0534240007400513, 0.19928716123104095, -1.0298309326171875, -1.0411708354949951, -0.2560960054397583, -0.7904869914054871, -1.0723985433578491, 0.17678675055503845, 0.5922502279281616, -0.5776921510696411, -0.17744994163513184, -1.098260521888733, 0.4449777901172638, -0.056756749749183655, 0.2587839663028717, 0.4894184470176697, 1.0680570602416992, 0.5496060848236084, -0.29422175884246826, -0.507429838180542, -0.04078765958547592, -0.4749203026294708, 0.05499899387359619, -0.7387706637382507, 0.09758669137954712, -0.856641948223114, 1.1027599573135376, 1.3601367473602295, -0.2740126848220825, -0.1461058109998703, -0.11742747575044632, 0.7891944646835327, 0.7545436024665833, 1.5026391744613647, -0.7694045305252075, -1.3946380615234375, -0.5907219648361206, -0.8002939224243164, -0.44692251086235046, 0.4616495668888092, -0.7975237369537354, -0.46680790185928345, 0.34545260667800903, 0.25793027877807617, 0.1501244157552719, -0.4961729943752289, 0.5261740684509277, 0.10385950654745102, -0.05644968897104263, -0.8083270788192749, 0.35397154092788696, -0.599587619304657, -0.8412600755691528, -1.4944343566894531, 0.3789310157299042, 0.1693175733089447, 1.0055012702941895, 0.20239704847335815, -0.5904006958007812, -1.2574397325515747, 2.0081756114959717, 1.1315696239471436, 0.017869573086500168, 0.530830442905426, 1.145524024963379, -0.04487039893865585, 0.5217338800430298, -0.4322240352630615, 0.6520392298698425, -1.1819384098052979, 0.6044440269470215, 1.2304617166519165, -0.018641889095306396, 0.043914832174777985, -0.3719466030597687, 0.43333664536476135, -0.16721095144748688, 0.45521482825279236, -0.12686431407928467, -0.7639789581298828, -0.658207356929779]}
```

```python
len(response.json()['embedding'])
```

```plaintext
768
```

åœ¨è°ƒç”¨çš„è¿‡ç¨‹ä¸­ï¼ŒOllama startå¯¹è¯é¡µé¢å¯ä»¥çœ‹åˆ°ç›¸å…³è°ƒç”¨ä¿¡æ¯ï¼š

![](images/b05fc42f-b2e5-4165-8476-c51160f92454.png)

* **Ollamaæ¥å…¥Qwen2.5-7Bæ¨¡å‹**

â€ƒâ€ƒæ¥å…¥LLMçš„æµç¨‹å’Œæ¥å…¥Embeddingæ¨¡å‹ç±»ä¼¼ï¼Œé¦–å…ˆéƒ½æ˜¯éœ€è¦ç¼–å†™Fileæ–‡ä»¶ï¼š

![](images/7840a4bb-651c-4735-b56f-8376aaf12772.png)

åœ¨åˆ›å»ºçš„ChatModelFileæ–‡ä»¶ä¸­å†™å…¥å¦‚ä¸‹å†…å®¹ï¼š

FROM ./qwen2.5-7b-instruct-q4\_k\_m.gguf

![](images/cd865097-82d5-4ca8-97e4-2d6aabe0515a.png)

ç„¶åè¿è¡Œå¦‚ä¸‹å‘½ä»¤å³å¯å°†æœ¬åœ°æ¨¡å‹åŠ å…¥ollamaæ¨¡å‹åˆ—è¡¨ï¼š

```bash
ollama create qwen2.5-7b-instruct -f ChatModelFile
```

![](images/01c71956-0f8d-4962-86f7-fed63e1e8d6c.png)

æŸ¥çœ‹æ˜¯å¦å·²åŠ å…¥æ¨¡å‹åˆ—è¡¨:ollama list

![](images/ef981965-93a2-42a3-aa5a-9928a48cd4e3.png)

æ¥ä¸‹æ¥å³å¯æµ‹è¯•ä½¿ç”¨Chatæ¨¡å‹

```python
import requests

# è®¾ç½®API URL
url = 'http://localhost:11434/api/chat'

# è®¾ç½®è¯·æ±‚ä½“æ•°æ®
data = {
    "model": "qwen2.5-7b-instruct",
    "messages": [
        {
            "role": "user",
            "content": "ä½ å¥½ï¼Œå¥½ä¹…ä¸è§ï¼"
        }
    ],
    "stream": False
}

# å‘é€POSTè¯·æ±‚å¹¶è·å–å“åº”
response = requests.post(url, json=data)

# æ‰“å°å“åº”å†…å®¹
if response.status_code == 200:
    print("Response:", response.json())  # å¦‚æœè¿”å›çš„æ˜¯JSONæ ¼å¼çš„å“åº”
else:
    print(f"Request failed with status code {response.status_code}")
```

```plaintext
Response: {'model': 'qwen2.5-7b-instruct', 'created_at': '2024-11-29T09:03:25.209042552Z', 'message': {'role': 'assistant', 'content': 'å¾ˆé«˜å…´è§åˆ°ä½ ã€‚ ä½ å¥½ï¼æˆ‘ä¹Ÿå¾ˆé«˜å…´è§åˆ°ä½ ã€‚æœ€è¿‘æ€ä¹ˆæ ·ï¼Ÿ'}, 'done_reason': 'stop', 'done': True, 'total_duration': 203578629, 'load_duration': 39258147, 'prompt_eval_count': 5, 'prompt_eval_duration': 18000000, 'eval_count': 16, 'eval_duration': 145000000}
```

```python
response.json()
```

```plaintext
{'model': 'qwen2.5-7b-instruct',
 'created_at': '2024-11-29T09:03:25.209042552Z',
 'message': {'role': 'assistant', 'content': 'å¾ˆé«˜å…´è§åˆ°ä½ ã€‚ ä½ å¥½ï¼æˆ‘ä¹Ÿå¾ˆé«˜å…´è§åˆ°ä½ ã€‚æœ€è¿‘æ€ä¹ˆæ ·ï¼Ÿ'},
 'done_reason': 'stop',
 'done': True,
 'total_duration': 203578629,
 'load_duration': 39258147,
 'prompt_eval_count': 5,
 'prompt_eval_duration': 18000000,
 'eval_count': 16,
 'eval_duration': 145000000}
```

è‡³æ­¤ï¼Œæˆ‘ä»¬å°±å®Œæˆäº†ä¸¤ä¸ªæ¨¡å‹çš„ä¸‹è½½ä¸æ¥å…¥Ollamaçš„ç›¸å…³å‡†å¤‡å·¥ä½œ

### å››ã€ä¿®æ”¹å¾®è½¯GraphRAGæºç 

#### **Step 1.graphragå¿«é€Ÿå®‰è£…**

```bash
pip install graphrag
```

```python
!pip install graphrag
```

```plaintext
Looking in indexes: http://mirrors.aliyun.com/pypi/simple
Requirement already satisfied: graphrag in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (0.5.0)
Requirement already satisfied: aiofiles<25.0.0,>=24.1.0 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from graphrag) (24.1.0)
Requirement already satisfied: aiolimiter<2.0.0,>=1.1.0 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from graphrag) (1.1.0)
Requirement already satisfied: azure-identity<2.0.0,>=1.17.1 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from graphrag) (1.19.0)
Requirement already satisfied: azure-search-documents<12.0.0,>=11.4.0 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from graphrag) (11.5.2)
Requirement already satisfied: azure-storage-blob<13.0.0,>=12.22.0 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from graphrag) (12.24.0)
Requirement already satisfied: datashaper<0.0.50,>=0.0.49 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from graphrag) (0.0.49)
Requirement already satisfied: devtools<0.13.0,>=0.12.2 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from graphrag) (0.12.2)
Requirement already satisfied: environs<12.0.0,>=11.0.0 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from graphrag) (11.2.1)
Requirement already satisfied: future<2.0.0,>=1.0.0 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from graphrag) (1.0.0)
Requirement already satisfied: graspologic<4.0.0,>=3.4.1 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from graphrag) (3.4.1)
Requirement already satisfied: json-repair<0.31.0,>=0.30.0 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from graphrag) (0.30.2)
Requirement already satisfied: lancedb<0.14.0,>=0.13.0 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from graphrag) (0.13.0)
Requirement already satisfied: matplotlib<4.0.0,>=3.9.0 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from graphrag) (3.9.2)
Requirement already satisfied: networkx<4,>=3 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from graphrag) (3.4.2)
Requirement already satisfied: nltk==3.9.1 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from graphrag) (3.9.1)
Requirement already satisfied: numpy<2.0.0,>=1.25.2 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from graphrag) (1.26.4)
Requirement already satisfied: openai<2.0.0,>=1.51.2 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from graphrag) (1.55.1)
Requirement already satisfied: pandas<3.0.0,>=2.2.3 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from graphrag) (2.2.3)
Requirement already satisfied: pyaml-env<2.0.0,>=1.2.1 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from graphrag) (1.2.1)
Requirement already satisfied: pyarrow<16.0.0,>=15.0.0 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from graphrag) (15.0.2)
Requirement already satisfied: pydantic<3.0.0,>=2.9.2 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from graphrag) (2.10.1)
Requirement already satisfied: python-dotenv<2.0.0,>=1.0.0 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from graphrag) (1.0.1)
Requirement already satisfied: pyyaml<7.0.0,>=6.0.2 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from graphrag) (6.0.2)
Requirement already satisfied: rich<14.0.0,>=13.6.0 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from graphrag) (13.9.4)
Requirement already satisfied: tenacity<10.0.0,>=9.0.0 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from graphrag) (9.0.0)
Requirement already satisfied: tiktoken<0.8.0,>=0.7.0 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from graphrag) (0.7.0)
Requirement already satisfied: typer<0.13.0,>=0.12.5 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from graphrag) (0.12.5)
Requirement already satisfied: typing-extensions<5.0.0,>=4.12.2 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from graphrag) (4.12.2)
Requirement already satisfied: umap-learn<0.6.0,>=0.5.6 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from graphrag) (0.5.7)
Requirement already satisfied: click in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from nltk==3.9.1->graphrag) (8.1.7)
Requirement already satisfied: joblib in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from nltk==3.9.1->graphrag) (1.4.2)
Requirement already satisfied: regex>=2021.8.3 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from nltk==3.9.1->graphrag) (2024.11.6)
Requirement already satisfied: tqdm in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from nltk==3.9.1->graphrag) (4.67.1)
Requirement already satisfied: azure-core>=1.31.0 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from azure-identity<2.0.0,>=1.17.1->graphrag) (1.32.0)
Requirement already satisfied: cryptography>=2.5 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from azure-identity<2.0.0,>=1.17.1->graphrag) (43.0.3)
Requirement already satisfied: msal>=1.30.0 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from azure-identity<2.0.0,>=1.17.1->graphrag) (1.31.1)
Requirement already satisfied: msal-extensions>=1.2.0 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from azure-identity<2.0.0,>=1.17.1->graphrag) (1.2.0)
Requirement already satisfied: azure-common>=1.1 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from azure-search-documents<12.0.0,>=11.4.0->graphrag) (1.1.28)
Requirement already satisfied: isodate>=0.6.0 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from azure-search-documents<12.0.0,>=11.4.0->graphrag) (0.7.2)
Requirement already satisfied: diskcache<6.0.0,>=5.6.3 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from datashaper<0.0.50,>=0.0.49->graphrag) (5.6.3)
Requirement already satisfied: jsonschema<5.0.0,>=4.21.1 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from datashaper<0.0.50,>=0.0.49->graphrag) (4.23.0)
Requirement already satisfied: asttokens<3.0.0,>=2.0.0 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from devtools<0.13.0,>=0.12.2->graphrag) (2.0.5)
Requirement already satisfied: executing>=1.1.1 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from devtools<0.13.0,>=0.12.2->graphrag) (2.1.0)
Requirement already satisfied: pygments>=2.15.0 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from devtools<0.13.0,>=0.12.2->graphrag) (2.15.1)
Requirement already satisfied: marshmallow>=3.13.0 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from environs<12.0.0,>=11.0.0->graphrag) (3.23.1)
Requirement already satisfied: POT<0.10,>=0.9 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from graspologic<4.0.0,>=3.4.1->graphrag) (0.9.5)
Requirement already satisfied: anytree<3.0.0,>=2.12.1 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from graspologic<4.0.0,>=3.4.1->graphrag) (2.12.1)
Requirement already satisfied: beartype<0.19.0,>=0.18.5 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from graspologic<4.0.0,>=3.4.1->graphrag) (0.18.5)
Requirement already satisfied: gensim<5.0.0,>=4.3.2 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from graspologic<4.0.0,>=3.4.1->graphrag) (4.3.3)
Requirement already satisfied: graspologic-native<2.0.0,>=1.2.1 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from graspologic<4.0.0,>=3.4.1->graphrag) (1.2.1)
Requirement already satisfied: hyppo<0.5.0,>=0.4.0 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from graspologic<4.0.0,>=3.4.1->graphrag) (0.4.0)
Requirement already satisfied: scikit-learn<2.0.0,>=1.4.2 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from graspologic<4.0.0,>=3.4.1->graphrag) (1.5.2)
Requirement already satisfied: scipy==1.12.0 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from graspologic<4.0.0,>=3.4.1->graphrag) (1.12.0)
Requirement already satisfied: seaborn<0.14.0,>=0.13.2 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from graspologic<4.0.0,>=3.4.1->graphrag) (0.13.2)
Requirement already satisfied: statsmodels<0.15.0,>=0.14.2 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from graspologic<4.0.0,>=3.4.1->graphrag) (0.14.4)
Requirement already satisfied: deprecation in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from lancedb<0.14.0,>=0.13.0->graphrag) (2.1.0)
Requirement already satisfied: pylance==0.17.0 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from lancedb<0.14.0,>=0.13.0->graphrag) (0.17.0)
Requirement already satisfied: requests>=2.31.0 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from lancedb<0.14.0,>=0.13.0->graphrag) (2.32.3)
Requirement already satisfied: retry>=0.9.2 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from lancedb<0.14.0,>=0.13.0->graphrag) (0.9.2)
Requirement already satisfied: attrs>=21.3.0 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from lancedb<0.14.0,>=0.13.0->graphrag) (24.2.0)
Requirement already satisfied: packaging in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from lancedb<0.14.0,>=0.13.0->graphrag) (24.1)
Requirement already satisfied: cachetools in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from lancedb<0.14.0,>=0.13.0->graphrag) (5.5.0)
Requirement already satisfied: overrides>=0.7 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from lancedb<0.14.0,>=0.13.0->graphrag) (7.4.0)
Requirement already satisfied: contourpy>=1.0.1 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from matplotlib<4.0.0,>=3.9.0->graphrag) (1.3.1)
Requirement already satisfied: cycler>=0.10 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from matplotlib<4.0.0,>=3.9.0->graphrag) (0.12.1)
Requirement already satisfied: fonttools>=4.22.0 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from matplotlib<4.0.0,>=3.9.0->graphrag) (4.55.0)
Requirement already satisfied: kiwisolver>=1.3.1 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from matplotlib<4.0.0,>=3.9.0->graphrag) (1.4.7)
Requirement already satisfied: pillow>=8 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from matplotlib<4.0.0,>=3.9.0->graphrag) (11.0.0)
Requirement already satisfied: pyparsing>=2.3.1 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from matplotlib<4.0.0,>=3.9.0->graphrag) (3.2.0)
Requirement already satisfied: python-dateutil>=2.7 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from matplotlib<4.0.0,>=3.9.0->graphrag) (2.9.0.post0)
Requirement already satisfied: anyio<5,>=3.5.0 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from openai<2.0.0,>=1.51.2->graphrag) (4.6.2)
Requirement already satisfied: distro<2,>=1.7.0 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from openai<2.0.0,>=1.51.2->graphrag) (1.9.0)
Requirement already satisfied: httpx<1,>=0.23.0 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from openai<2.0.0,>=1.51.2->graphrag) (0.27.0)
Requirement already satisfied: jiter<1,>=0.4.0 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from openai<2.0.0,>=1.51.2->graphrag) (0.7.1)
Requirement already satisfied: sniffio in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from openai<2.0.0,>=1.51.2->graphrag) (1.3.0)
Requirement already satisfied: pytz>=2020.1 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from pandas<3.0.0,>=2.2.3->graphrag) (2024.1)
Requirement already satisfied: tzdata>=2022.7 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from pandas<3.0.0,>=2.2.3->graphrag) (2024.2)
Requirement already satisfied: annotated-types>=0.6.0 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from pydantic<3.0.0,>=2.9.2->graphrag) (0.7.0)
Requirement already satisfied: pydantic-core==2.27.1 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from pydantic<3.0.0,>=2.9.2->graphrag) (2.27.1)
Requirement already satisfied: markdown-it-py>=2.2.0 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from rich<14.0.0,>=13.6.0->graphrag) (3.0.0)
Requirement already satisfied: shellingham>=1.3.0 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from typer<0.13.0,>=0.12.5->graphrag) (1.5.4)
Requirement already satisfied: numba>=0.51.2 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from umap-learn<0.6.0,>=0.5.6->graphrag) (0.60.0)
Requirement already satisfied: pynndescent>=0.5 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from umap-learn<0.6.0,>=0.5.6->graphrag) (0.5.13)
Requirement already satisfied: idna>=2.8 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from anyio<5,>=3.5.0->openai<2.0.0,>=1.51.2->graphrag) (3.7)
Requirement already satisfied: six in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from anytree<3.0.0,>=2.12.1->graspologic<4.0.0,>=3.4.1->graphrag) (1.16.0)
Requirement already satisfied: cffi>=1.12 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from cryptography>=2.5->azure-identity<2.0.0,>=1.17.1->graphrag) (1.17.1)
Requirement already satisfied: smart-open>=1.8.1 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from gensim<5.0.0,>=4.3.2->graspologic<4.0.0,>=3.4.1->graphrag) (7.0.5)
Requirement already satisfied: certifi in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from httpx<1,>=0.23.0->openai<2.0.0,>=1.51.2->graphrag) (2024.8.30)
Requirement already satisfied: httpcore==1.* in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from httpx<1,>=0.23.0->openai<2.0.0,>=1.51.2->graphrag) (1.0.2)
Requirement already satisfied: h11<0.15,>=0.13 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from httpcore==1.*->httpx<1,>=0.23.0->openai<2.0.0,>=1.51.2->graphrag) (0.14.0)
Requirement already satisfied: autograd>=1.3 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from hyppo<0.5.0,>=0.4.0->graspologic<4.0.0,>=3.4.1->graphrag) (1.7.0)
Requirement already satisfied: jsonschema-specifications>=2023.03.6 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from jsonschema<5.0.0,>=4.21.1->datashaper<0.0.50,>=0.0.49->graphrag) (2023.7.1)
Requirement already satisfied: referencing>=0.28.4 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from jsonschema<5.0.0,>=4.21.1->datashaper<0.0.50,>=0.0.49->graphrag) (0.30.2)
Requirement already satisfied: rpds-py>=0.7.1 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from jsonschema<5.0.0,>=4.21.1->datashaper<0.0.50,>=0.0.49->graphrag) (0.10.6)
Requirement already satisfied: mdurl~=0.1 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from markdown-it-py>=2.2.0->rich<14.0.0,>=13.6.0->graphrag) (0.1.2)
Requirement already satisfied: PyJWT<3,>=1.0.0 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from PyJWT[crypto]<3,>=1.0.0->msal>=1.30.0->azure-identity<2.0.0,>=1.17.1->graphrag) (2.10.0)
Requirement already satisfied: portalocker<3,>=1.4 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from msal-extensions>=1.2.0->azure-identity<2.0.0,>=1.17.1->graphrag) (2.10.1)
Requirement already satisfied: llvmlite<0.44,>=0.43.0dev0 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from numba>=0.51.2->umap-learn<0.6.0,>=0.5.6->graphrag) (0.43.0)
Requirement already satisfied: charset-normalizer<4,>=2 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from requests>=2.31.0->lancedb<0.14.0,>=0.13.0->graphrag) (3.3.2)
Requirement already satisfied: urllib3<3,>=1.21.1 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from requests>=2.31.0->lancedb<0.14.0,>=0.13.0->graphrag) (2.2.3)
Requirement already satisfied: decorator>=3.4.2 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from retry>=0.9.2->lancedb<0.14.0,>=0.13.0->graphrag) (5.1.1)
Requirement already satisfied: py<2.0.0,>=1.4.26 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from retry>=0.9.2->lancedb<0.14.0,>=0.13.0->graphrag) (1.11.0)
Requirement already satisfied: threadpoolctl>=3.1.0 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from scikit-learn<2.0.0,>=1.4.2->graspologic<4.0.0,>=3.4.1->graphrag) (3.5.0)
Requirement already satisfied: patsy>=0.5.6 in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from statsmodels<0.15.0,>=0.14.2->graspologic<4.0.0,>=3.4.1->graphrag) (1.0.1)
Requirement already satisfied: pycparser in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from cffi>=1.12->cryptography>=2.5->azure-identity<2.0.0,>=1.17.1->graphrag) (2.21)
Requirement already satisfied: wrapt in /root/miniconda3/envs/graphrag/lib/python3.11/site-packages (from smart-open>=1.8.1->gensim<5.0.0,>=4.3.2->graspologic<4.0.0,>=3.4.1->graphrag) (1.17.0)
[33mWARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager, possibly rendering your system unusable.It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv. Use the --root-user-action option if you know what you are doing and want to suppress this warning.[0m[33m
[0m
```

#### **Step 2.åˆ›å»ºæ£€ç´¢é¡¹ç›®æ–‡ä»¶å¤¹**

```bash
cd /root/autodl-tmp/graphrag-ollama
mkdir -p ./ml-ollama/input
```

![](images/4837c0b5-60a2-4a3d-81db-276872add73c.png)

#### **Step 3.ä¸Šä¼ æ•°æ®é›†**

![](images/b604449e-1dcb-4d10-bb20-a52367a8b609.png)

&#x20;

![](images/8fcbe899-7dfc-4bdc-bf2d-e730994d72be.png)

![](images/fcff8b0e-5029-4cd5-a508-e19c8be9d22a.jpeg)

#### **Step 4.åˆå§‹åŒ–é¡¹ç›®æ–‡ä»¶**

```bash
graphrag init --root /root/autodl-tmp/graphrag-ollama/ml-ollama
```

#### **Step 5.ä¿®æ”¹é¡¹ç›®é…ç½®**

* ä¿®æ”¹.envæ–‡ä»¶ï¼š

![](images/3071f2fe-4bed-4ad6-aca9-4a836ca5e336.png)

å°†API-KEYè®¾ç½®ä¸ºollamaï¼šGRAPHRAG\_API\_KEY=ollama

![](images/a137a0fc-67ce-4bb1-85a1-060050a840d4.png)

* ä¿®æ”¹setting.yamlæ–‡ä»¶

model: qwen2.5-7b-instruct

api\_base: http://localhost:11434/v1

![](images/4c16a07b-456c-4372-988a-b2b03a6f4bf1.png)

model:nomic-embed-text

api\_base: http://localhost:11434/api

![](images/07d17a85-1f1d-47ff-84c1-90751f5c49dd.png)

#### **Step 6.ä¿®æ”¹é¡¹ç›®æºç **

â€ƒâ€ƒé¦–å…ˆï¼Œæ‰¾åˆ°pipå®‰è£…åº“çš„åœ°å€ï¼š`/root/miniconda3/envs/graphrag-ollama/lib/python3.10/site-packages/graphrag`

![](images/b754d5f2-ad87-41ac-bfba-085ca166c4bd.png)

* ä¿®æ”¹ä¸€ï¼š`llm/openai/openai_embeddings_llm.py`

![](images/808703f6-480a-4af4-9f37-0f58ccade6ca.png)

ä¿®æ”¹ä¸ºå¦‚ä¸‹å†…å®¹ï¼š

```python
# Copyright (c) 2024 Microsoft Corporation.
# Licensed under the MIT License

"""The EmbeddingsLLM class."""

from typing_extensions import Unpack

from graphrag.llm.base import BaseLLM
from graphrag.llm.types import (
    EmbeddingInput,
    EmbeddingOutput,
    LLMInput,
)

from .openai_configuration import OpenAIConfiguration
from .types import OpenAIClientTypes

import ollama


class OpenAIEmbeddingsLLM(BaseLLM[EmbeddingInput, EmbeddingOutput]):
    """A text-embedding generator LLM."""

    _client: OpenAIClientTypes
    _configuration: OpenAIConfiguration

    def __init__(self, client: OpenAIClientTypes, configuration: OpenAIConfiguration):
        self.client = client
        self.configuration = configuration

    async def _execute_llm(
        self, input: EmbeddingInput, **kwargs: Unpack[LLMInput]
    ) -> EmbeddingOutput | None:
        args = {
            "model": self.configuration.model,
            **(kwargs.get("model_parameters") or {}),
        }
        # embedding = await self.client.embeddings.create(
        #     input=input,
        #     **args,
        # )
        embedding_list = []
        for inp in input:
            embedding = ollama.embeddings(model='nomic-embed-text', prompt=inp)
            embedding_list.append(embedding["embedding"])
        return embedding_list
```

* ä¿®æ”¹äºŒï¼š`query/llm/oai/embedding.py`

â€ƒâ€ƒä¿®æ”¹åå†…å®¹å¦‚ä¸‹ï¼š

```python
# Copyright (c) 2024 Microsoft Corporation.
# Licensed under the MIT License

"""OpenAI Embedding model implementation."""

import asyncio
from collections.abc import Callable
from typing import Any

import numpy as np
import tiktoken
from tenacity import (
    AsyncRetrying,
    RetryError,
    Retrying,
    retry_if_exception_type,
    stop_after_attempt,
    wait_exponential_jitter,
)

from graphrag.logging.base import StatusLogger
from graphrag.query.llm.base import BaseTextEmbedding
from graphrag.query.llm.oai.base import OpenAILLMImpl
from graphrag.query.llm.oai.typing import (
    OPENAI_RETRY_ERROR_TYPES,
    OpenaiApiType,
)
from graphrag.query.llm.text_utils import chunk_text

import ollama

class OpenAIEmbedding(BaseTextEmbedding, OpenAILLMImpl):
    """Wrapper for OpenAI Embedding models."""

    def __init__(
        self,
        api_key: str | None = None,
        azure_ad_token_provider: Callable | None = None,
        model: str = "text-embedding-3-small",
        deployment_name: str | None = None,
        api_base: str | None = None,
        api_version: str | None = None,
        api_type: OpenaiApiType = OpenaiApiType.OpenAI,
        organization: str | None = None,
        encoding_name: str = "cl100k_base",
        max_tokens: int = 8191,
        max_retries: int = 10,
        request_timeout: float = 180.0,
        retry_error_types: tuple[type[BaseException]] = OPENAI_RETRY_ERROR_TYPES,  # type: ignore
        reporter: StatusLogger | None = None,
    ):
        OpenAILLMImpl.__init__(
            self=self,
            api_key=api_key,
            azure_ad_token_provider=azure_ad_token_provider,
            deployment_name=deployment_name,
            api_base=api_base,
            api_version=api_version,
            api_type=api_type,  # type: ignore
            organization=organization,
            max_retries=max_retries,
            request_timeout=request_timeout,
            reporter=reporter,
        )

        self.model = model
        self.encoding_name = encoding_name
        self.max_tokens = max_tokens
        self.token_encoder = tiktoken.get_encoding(self.encoding_name)
        self.retry_error_types = retry_error_types

    def embed(self, text: str, **kwargs: Any) -> list[float]:
        """
        Embed text using OpenAI Embedding's sync function.

        For text longer than max_tokens, chunk texts into max_tokens, embed each chunk, then combine using weighted average.
        Please refer to: https://github.com/openai/openai-cookbook/blob/main/examples/Embedding_long_inputs.ipynb
        """
        token_chunks = chunk_text(
            text=text, token_encoder=self.token_encoder, max_tokens=self.max_tokens
        )
        chunk_embeddings = []
        chunk_lens = []
        for chunk in token_chunks:
            try:
                # embedding, chunk_len = self._embed_with_retry(chunk, **kwargs)
                embedding = ollama.embeddings(model='nomic-embed-text', prompt=chunk)['embedding']
                chunk_len = len(chunk)
                chunk_embeddings.append(embedding)
                chunk_lens.append(chunk_len)
            # TODO: catch a more specific exception
            except Exception as e:  # noqa BLE001
                self._reporter.error(
                    message="Error embedding chunk",
                    details={self.__class__.__name__: str(e)},
                )

                continue
        # chunk_embeddings = np.average(chunk_embeddings, axis=0, weights=chunk_lens)
        # chunk_embeddings = chunk_embeddings / np.linalg.norm(chunk_embeddings)
        # return chunk_embeddings.tolist()
        return chunk_embeddings

    async def aembed(self, text: str, **kwargs: Any) -> list[float]:
        """
        Embed text using OpenAI Embedding's async function.

        For text longer than max_tokens, chunk texts into max_tokens, embed each chunk, then combine using weighted average.
        """
        token_chunks = chunk_text(
            text=text, token_encoder=self.token_encoder, max_tokens=self.max_tokens
        )
        chunk_embeddings = []
        chunk_lens = []
        embedding_results = await asyncio.gather(*[
            self._aembed_with_retry(chunk, **kwargs) for chunk in token_chunks
        ])
        embedding_results = [result for result in embedding_results if result[0]]
        chunk_embeddings = [result[0] for result in embedding_results]
        chunk_lens = [result[1] for result in embedding_results]
        chunk_embeddings = np.average(chunk_embeddings, axis=0, weights=chunk_lens)  # type: ignore
        chunk_embeddings = chunk_embeddings / np.linalg.norm(chunk_embeddings)
        return chunk_embeddings.tolist()

    def _embed_with_retry(
        self, text: str | tuple, **kwargs: Any
    ) -> tuple[list[float], int]:
        try:
            retryer = Retrying(
                stop=stop_after_attempt(self.max_retries),
                wait=wait_exponential_jitter(max=10),
                reraise=True,
                retry=retry_if_exception_type(self.retry_error_types),
            )
            for attempt in retryer:
                with attempt:
                    embedding = (
                        self.sync_client.embeddings.create(  # type: ignore
                            input=text,
                            model=self.model,
                            **kwargs,  # type: ignore
                        )
                        .data[0]
                        .embedding
                        or []
                    )
                    return (embedding, len(text))
        except RetryError as e:
            self._reporter.error(
                message="Error at embed_with_retry()",
                details={self.__class__.__name__: str(e)},
            )
            return ([], 0)
        else:
            # TODO: why not just throw in this case?
            return ([], 0)

    async def _aembed_with_retry(
        self, text: str | tuple, **kwargs: Any
    ) -> tuple[list[float], int]:
        try:
            retryer = AsyncRetrying(
                stop=stop_after_attempt(self.max_retries),
                wait=wait_exponential_jitter(max=10),
                reraise=True,
                retry=retry_if_exception_type(self.retry_error_types),
            )
            async for attempt in retryer:
                with attempt:
                    embedding = (
                        await self.async_client.embeddings.create(  # type: ignore
                            input=text,
                            model=self.model,
                            **kwargs,  # type: ignore
                        )
                    ).data[0].embedding or []
                    return (embedding, len(text))
        except RetryError as e:
            self._reporter.error(
                message="Error at embed_with_retry()",
                details={self.__class__.__name__: str(e)},
            )
            return ([], 0)
        else:
            # TODO: why not just throw in this case?
            return ([], 0)
```

* ä¿®æ”¹ä¸‰ï¼š`/query/llm/text_utils.py`

â€ƒâ€ƒä¿®æ”¹å†…å®¹å¦‚ä¸‹ï¼š

```python
# Copyright (c) 2024 Microsoft Corporation.
# Licensed under the MIT License

"""Text Utilities for LLM."""

from collections.abc import Iterator
from itertools import islice

import tiktoken


def num_tokens(text: str, token_encoder: tiktoken.Encoding | None = None) -> int:
    """Return the number of tokens in the given text."""
    if token_encoder is None:
        token_encoder = tiktoken.get_encoding("cl100k_base")
    return len(token_encoder.encode(text))  # type: ignore


def batched(iterable: Iterator, n: int):
    """
    Batch data into tuples of length n. The last batch may be shorter.

    Taken from Python's cookbook: https://docs.python.org/3/library/itertools.html#itertools.batched
    """
    # batched('ABCDEFG', 3) --> ABC DEF G
    if n < 1:
        value_error = "n must be at least one"
        raise ValueError(value_error)
    it = iter(iterable)
    while batch := tuple(islice(it, n)):
        yield batch


def chunk_text(
    text: str, max_tokens: int, token_encoder: tiktoken.Encoding | None = None
):
    """Chunk text by token length."""
    if token_encoder is None:
        token_encoder = tiktoken.get_encoding("cl100k_base")
    tokens = token_encoder.encode(text)  # type: ignore
    tokens = token_encoder.decode(tokens)
    
    chunk_iterator = batched(iter(tokens), max_tokens)
    # yield from (token_encoder.decode(list(chunk)) for chunk in chunk_iterator)
    yield from chunk_iterator
```

### äº”ã€å°†Ollamaæ¥å…¥å¾®è½¯GraphRAG

â€ƒâ€ƒåœ¨è¿›è¡Œäº†ä¸€ç³»åˆ—å‡†å¤‡å·¥ä½œä¹‹åï¼Œæ¥ä¸‹æ¥å³å¯å¼€å§‹è¿è¡ŒGraphRAGäº†ï¼Œæ­¤æ—¶GraphRAGå°±å·²ç»åˆ‡æ¢åˆ°äº†æœ¬åœ°è¿è¡Œæ¨¡å¼ã€‚å’Œä¹‹å‰ä¸€æ ·ï¼Œå¯ä»¥é‡‡ç”¨ç±»ä¼¼çš„æ–¹æ³•è¿›è¡Œindexå’ŒQueryã€‚

#### 1.åŸºäºæœ¬åœ°Ollamaçš„GraphRAG Indexè¿‡ç¨‹

```bash
graphrag index --root /root/autodl-tmp/graphrag-ollama/ml-ollama
```

![](images/3cccbc40-779a-4815-b51b-fe79de0c5b55.png)

ä¼´éšç€æ‰§è¡Œçš„è¿‡ç¨‹ï¼Œollamaå¯¹è¯é¡µé¢ä¹Ÿèƒ½çœ‹åˆ°å…·ä½“æ¨¡å‹è°ƒç”¨è¿‡ç¨‹ï¼š

![](images/b877a955-3493-4f91-8d92-9feaf9e27161.png)

#### 2.åŸºäºæœ¬åœ°Ollamaçš„GraphRAG queryè¿‡ç¨‹

##### 2.1 å‘½ä»¤è¡Œå¯¹è¯è¿‡ç¨‹

```python
!graphrag query --root /root/autodl-tmp/graphrag-ollama/ml-ollama --method local --query "è¯·å¸®æˆ‘ä»‹ç»ä¸‹ID3ç®—æ³•"
```

```plaintext
INFO: Vector Store Args: {
    "type": "lancedb",
    "db_uri": "/root/autodl-tmp/graphrag-ollama/ml-ollama/output/lancedb",
    "container_name": "==== REDACTED ====",
    "overwrite": true
}
creating llm client with {'api_key': 'REDACTED,len=6', 'type': "openai_chat", 'model': 'qwen2.5-7b-instruct', 'max_tokens': 4000, 'temperature': 0.0, 'top_p': 1.0, 'n': 1, 'request_timeout': 180.0, 'api_base': 'http://localhost:11434/v1', 'api_version': None, 'organization': None, 'proxy': None, 'audience': None, 'deployment_name': None, 'model_supports_json': True, 'tokens_per_minute': 0, 'requests_per_minute': 0, 'max_retries': 10, 'max_retry_wait': 10.0, 'sleep_on_rate_limit_recommendation': True, 'concurrent_requests': 25}
creating embedding llm client with {'api_key': 'REDACTED,len=6', 'type': "openai_embedding", 'model': 'nomic-embed-text', 'max_tokens': 4000, 'temperature': 0, 'top_p': 1, 'n': 1, 'request_timeout': 180.0, 'api_base': 'http://localhost:11434/api', 'api_version': None, 'organization': None, 'proxy': None, 'audience': None, 'deployment_name': None, 'model_supports_json': None, 'tokens_per_minute': 0, 'requests_per_minute': 0, 'max_retries': 10, 'max_retry_wait': 10.0, 'sleep_on_rate_limit_recommendation': True, 'concurrent_requests': 25}
Error embedding chunk {'OpenAIEmbedding': "1 validation error for EmbeddingsRequest\nprompt\n  Input should be a valid string [type=string_type, input_value=('è¯·', 'å¸®', 'æˆ‘', '... 'D', '3', 'ç®—', 'æ³•'), input_type=tuple]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type"}

SUCCESS: Local Search Response:

å½“ç„¶å¯ä»¥ï¼ID3ï¼ˆIterative Dichotomizer 3ï¼‰æ˜¯ä¸€ç§ç»å…¸çš„å†³ç­–æ ‘å­¦ä¹ ç®—æ³•ï¼Œç”±Ross Quinlanåœ¨1986å¹´æå‡ºã€‚å®ƒä¸»è¦ç”¨äºåˆ†ç±»é—®é¢˜ï¼Œå¹¶ä¸”æ˜¯åç»­æ›´å¤æ‚çš„C4.5å’ŒC5.0ç®—æ³•çš„åŸºç¡€ã€‚

### åŸºæœ¬æ¦‚å¿µ

- **å†³ç­–æ ‘**ï¼šä¸€ç§æ ‘å½¢ç»“æ„ï¼Œæ¯ä¸ªå†…éƒ¨èŠ‚ç‚¹è¡¨ç¤ºä¸€ä¸ªå±æ€§ä¸Šçš„æµ‹è¯•ï¼Œæ¯ä¸ªåˆ†æ”¯ä»£è¡¨ä¸€ä¸ªæµ‹è¯•ç»“æœï¼Œæ¯ä¸ªå¶èŠ‚ç‚¹ä»£è¡¨ä¸€ä¸ªç±»åˆ«ã€‚
- **ä¿¡æ¯ç†µï¼ˆEntropyï¼‰**ï¼šè¡¡é‡æ•°æ®é›†çš„ä¸ç¡®å®šæ€§æˆ–æ··ä¹±ç¨‹åº¦ã€‚å¯¹äºåˆ†ç±»é—®é¢˜ï¼Œä¿¡æ¯ç†µè¶Šå°ï¼Œè¯´æ˜æ•°æ®é›†ä¸­çš„æ ·æœ¬åˆ†å¸ƒè¶Šå‡åŒ€ï¼Œåˆ†ç±»æ•ˆæœè¶Šå¥½ã€‚
- **ä¿¡æ¯å¢ç›Šï¼ˆInformation Gainï¼‰**ï¼šè¡¨ç¤ºé€šè¿‡æŸä¸ªå±æ€§åˆ’åˆ†æ•°æ®é›†åï¼Œæ•°æ®é›†çš„ä¿¡æ¯ç†µå‡å°‘çš„ç¨‹åº¦ã€‚

### ç®—æ³•æ­¥éª¤

1. **é€‰æ‹©æ ¹èŠ‚ç‚¹**ï¼š
   - ä»æ‰€æœ‰å¯ç”¨çš„ç‰¹å¾ä¸­é€‰æ‹©ä¸€ä¸ªèƒ½å¤Ÿæœ€å¤§åŒ–ä¿¡æ¯å¢ç›Šçš„ç‰¹å¾ä½œä¸ºå†³ç­–æ ‘çš„æ ¹èŠ‚ç‚¹ã€‚
   
2. **é€’å½’æ„å»ºå­æ ‘**ï¼š
   - å¯¹äºæ¯ä¸ªå¯èƒ½çš„å±æ€§å€¼ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„åˆ†æ”¯ï¼Œå¹¶å°†æ•°æ®é›†æŒ‰ç…§è¯¥å±æ€§å€¼è¿›è¡Œåˆ’åˆ†ã€‚
   - è®¡ç®—æ¯ä¸ªå­æ•°æ®é›†çš„ä¿¡æ¯ç†µï¼Œå¹¶è®¡ç®—å½“å‰å±æ€§çš„ä¿¡æ¯å¢ç›Šã€‚
   - é€‰æ‹©ä¿¡æ¯å¢ç›Šæœ€å¤§çš„å±æ€§ä½œä¸ºå½“å‰èŠ‚ç‚¹çš„åˆ†è£‚æ ‡å‡†ã€‚
   
3. **åœæ­¢æ¡ä»¶**ï¼š
   - å½“æ‰€æœ‰æ ·æœ¬å±äºåŒä¸€ç±»åˆ«æ—¶ï¼Œåˆ›å»ºä¸€ä¸ªå¶èŠ‚ç‚¹å¹¶ç»“æŸè¯¥åˆ†æ”¯ã€‚
   - å¦‚æœæ²¡æœ‰æ›´å¤šçš„ç‰¹å¾å¯ä»¥ä½¿ç”¨ï¼ˆå³æ‰€æœ‰ç‰¹å¾éƒ½å·²ç”¨å®Œï¼‰ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªå¶èŠ‚ç‚¹å¹¶å°†å½“å‰å­æ•°æ®é›†ä¸­çš„å¤šæ•°ç±»ä½œä¸ºåˆ†ç±»ç»“æœã€‚

### ä¼˜ç‚¹

- ç®€å•æ˜“æ‡‚ï¼šç®—æ³•åŸºäºä¿¡æ¯è®ºçš„åŸºæœ¬åŸç†ï¼Œæ˜“äºç†è§£å’Œå®ç°ã€‚
- è®¡ç®—æ•ˆç‡é«˜ï¼šé€šè¿‡é€‰æ‹©å…·æœ‰æœ€å¤§ä¿¡æ¯å¢ç›Šçš„å±æ€§è¿›è¡Œåˆ’åˆ†ï¼Œå¯ä»¥å¿«é€Ÿæ„å»ºå†³ç­–æ ‘æ¨¡å‹ã€‚

### ç¼ºç‚¹

- **è¿‡æ‹Ÿåˆ**ï¼šå½“æ•°æ®é›†ä¸­çš„å™ªå£°è¾ƒå¤§æˆ–ç‰¹å¾è¿‡å¤šæ—¶ï¼ŒID3å®¹æ˜“äº§ç”Ÿè¿‡äºå¤æ‚çš„å†³ç­–æ ‘ï¼Œå¯¼è‡´è¿‡æ‹Ÿåˆé—®é¢˜ã€‚
- **å¤„ç†è¿ç»­å€¼**ï¼šå¯¹äºè¿ç»­å‹å˜é‡ï¼Œéœ€è¦å…ˆå°†å…¶ç¦»æ•£åŒ–ï¼Œè¿™å¯èƒ½ä¼šå¼•å…¥é¢å¤–çš„è¯¯å·®ã€‚
- **åå‘äºå¤šåˆ†ç±»å±æ€§**ï¼šå¦‚æœæŸä¸ªå±æ€§æœ‰è¾ƒå¤šçš„å–å€¼ï¼Œåˆ™è¯¥å±æ€§çš„ä¿¡æ¯å¢ç›Šä¼šç›¸å¯¹è¾ƒé«˜ï¼Œä»è€Œå¯èƒ½å¯¼è‡´å†³ç­–æ ‘åå‘äºé€‰æ‹©è¿™ç§å±æ€§ã€‚

### æ€»ç»“

ID3ç®—æ³•æ˜¯æ„å»ºå†³ç­–æ ‘çš„ä¸€ç§ç»å…¸æ–¹æ³•ï¼Œå®ƒé€šè¿‡ä¿¡æ¯ç†µå’Œä¿¡æ¯å¢ç›Šæ¥æŒ‡å¯¼ç‰¹å¾çš„é€‰æ‹©ã€‚å°½ç®¡å­˜åœ¨ä¸€äº›å±€é™æ€§ï¼Œä½†å…¶ç®€å•æ€§å’Œé«˜æ•ˆæ€§ä½¿å…¶åœ¨è®¸å¤šå®é™…åº”ç”¨ä¸­ä»ç„¶å…·æœ‰å¾ˆé«˜çš„ä»·å€¼ã€‚éšç€åç»­ç‰ˆæœ¬C4.5å’ŒC5.0çš„å‘å±•ï¼Œè§£å†³äº†éƒ¨åˆ†é—®é¢˜å¹¶æé«˜äº†æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚å¦‚æœä½ å¯¹æœºå™¨å­¦ä¹ æ„Ÿå…´è¶£ï¼Œäº†è§£è¿™äº›ç®—æ³•çš„åŸºæœ¬åŸç†æ˜¯éå¸¸æœ‰å¸®åŠ©çš„ã€‚å¸Œæœ›è¿™ä¸ªä»‹ç»å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼å¦‚æœæœ‰ä»»ä½•å…¶ä»–é—®é¢˜æˆ–éœ€è¦è¿›ä¸€æ­¥è§£é‡Šï¼Œè¯·éšæ—¶å‘Šè¯‰æˆ‘ã€‚
```

##### 2.2 åŸºäºPython SDKçš„å¯¹è¯è¿‡ç¨‹

* Step 1.å¯¼å…¥ç›¸å…³çš„åº“

```python
import os

import pandas as pd
import tiktoken

from graphrag.query.context_builder.entity_extraction import EntityVectorStoreKey
from graphrag.query.indexer_adapters import (
    read_indexer_covariates,
    read_indexer_entities,
    read_indexer_relationships,
    read_indexer_reports,
    read_indexer_text_units,
)
from graphrag.query.input.loaders.dfs import (
    store_entity_semantic_embeddings,
)
from graphrag.query.llm.oai.chat_openai import ChatOpenAI
from graphrag.query.llm.oai.embedding import OpenAIEmbedding
from graphrag.query.llm.oai.typing import OpenaiApiType
from graphrag.query.question_gen.local_gen import LocalQuestionGen
from graphrag.query.structured_search.local_search.mixed_context import (
    LocalSearchMixedContext,
)
from graphrag.query.structured_search.local_search.search import LocalSearch
from graphrag.vector_stores.lancedb import LanceDBVectorStore
```

```plaintext
/root/miniconda3/envs/graphrag-ollama/lib/python3.10/site-packages/tqdm/auto.py:21: TqdmWarning: IProgress not found. Please update jupyter and ipywidgets. See https://ipywidgets.readthedocs.io/en/stable/user_install.html
  from .autonotebook import tqdm as notebook_tqdm
```

* Step 2.å¯¼å…¥å›¾è°±

```python
INPUT_DIR = "/root/autodl-tmp/graphrag-ollama/ml-ollama/output"
LANCEDB_URI = f"{INPUT_DIR}/lancedb"

COMMUNITY_REPORT_TABLE = "create_final_community_reports"
ENTITY_TABLE = "create_final_nodes"
ENTITY_EMBEDDING_TABLE = "create_final_entities"
RELATIONSHIP_TABLE = "create_final_relationships"
TEXT_UNIT_TABLE = "create_final_text_units"
COMMUNITY_LEVEL = 2
```

```python
entity_df = pd.read_parquet(f"{INPUT_DIR}/{ENTITY_TABLE}.parquet")
entity_embedding_df = pd.read_parquet(f"{INPUT_DIR}/{ENTITY_EMBEDDING_TABLE}.parquet")

entities = read_indexer_entities(entity_df, entity_embedding_df, COMMUNITY_LEVEL)

description_embedding_store = LanceDBVectorStore(
    collection_name="default-entity-description",
)
description_embedding_store.connect(db_uri=LANCEDB_URI)
entity_description_embeddings = store_entity_semantic_embeddings(
    entities=entities, vectorstore=description_embedding_store
)

print(f"Entity count: {len(entity_df)}")
entity_df.head()
```

```plaintext
Entity count: 10
```



|   | id                               | human\_readable\_id | title     | community | level | degree | x | y |
| - | -------------------------------- | ------------------- | --------- | --------- | ----- | ------ | - | - |
| 0 | 2aad028bd7264c52994beea0e6b9fdfc | 0                   | ID3       | 0         | 0     | 9      | 0 | 0 |
| 1 | 40dfc4d13cb1480e94422d82c5677d36 | 1                   | C4.5      | 1         | 0     | 3      | 0 | 0 |
| 2 | 4c0ab8b2e26243e99a54c12f040ddc8a | 2                   | CART TREE | 0         | 0     | 1      | 0 | 0 |
| 3 | 1d244ee69c7c49aab28deaf33174efc8 | 3                   | AGE       | 0         | 0     | 1      | 0 | 0 |
| 4 | 7af451867ef64cc1b3abc109098d3530 | 4                   | INCOME    | 0         | 0     | 1      | 0 | 0 |

```python
relationship_df = pd.read_parquet(f"{INPUT_DIR}/{RELATIONSHIP_TABLE}.parquet")
relationships = read_indexer_relationships(relationship_df)

print(f"Relationship count: {len(relationship_df)}")
relationship_df.head()
```

```plaintext
Relationship count: 11
```



|   | id                               | human\_readable\_id | source | target    | description                                       | weight | combined\_degree | text\_unit\_ids                                    |
| - | -------------------------------- | ------------------- | ------ | --------- | ------------------------------------------------- | ------ | ---------------- | -------------------------------------------------- |
| 0 | 0b76f33339064d0db05755b5fd464a0d | 0                   | ID3    | C4.5      | C4.5 is an improved version of the ID3 algorit... | 16.0   | 12               | \[0653a697b64dd8c029503ffc22af9ec3, b1fce21a45f... |
| 1 | 03882ac8ccbb4df59ff7c91bd0de53d7 | 1                   | ID3    | CART TREE | ID3 and CART Tree both aim to reduce dataset i... | 7.0    | 10               | \[0653a697b64dd8c029503ffc22af9ec3]                |
| 2 | 2a77965ec2fb4359a94c674d1e0f357b | 2                   | ID3    | AGE       | The ID3 algorithm utilizes "Age" as a feature ... | 13.0   | 10               | \[0653a697b64dd8c029503ffc22af9ec3, b1fce21a45f... |
| 3 | a3bf392c8c434aca910f1c4f562602d4 | 3                   | ID3    | INCOME    | In the ID3 decision tree algorithm, income is ... | 7.0    | 10               | \[0653a697b64dd8c029503ffc22af9ec3, b1fce21a45f... |
| 4 | 3cceba910be44544845344f5f59e5c5b | 4                   | ID3    | SKLEARN   | ID3 is not supported by the Sklearn library fo... | 5.0    | 11               | \[0653a697b64dd8c029503ffc22af9ec3]                |

```python
report_df = pd.read_parquet(f"{INPUT_DIR}/{COMMUNITY_REPORT_TABLE}.parquet")
reports = read_indexer_reports(report_df, entity_df, COMMUNITY_LEVEL)

print(f"Report records: {len(report_df)}")
report_df.head()
```

```plaintext
Report records: 2
```



|   | id                                   | human\_readable\_id | community | level | title                                 | summary                                           | full\_content                                     | rank | rank\_explanation                                 | findings                                           | full\_content\_json                            | period     | size |
| - | ------------------------------------ | ------------------- | --------- | ----- | ------------------------------------- | ------------------------------------------------- | ------------------------------------------------- | ---- | ------------------------------------------------- | -------------------------------------------------- | ---------------------------------------------- | ---------- | ---- |
| 0 | afe0851a-ab46-416d-bc40-74690bea65c4 | 0                   | 0         | 0     | ID3 Decision Tree Algorithm Community | The community centers around the ID3 decision ... | # ID3 Decision Tree Algorithm Community\n\nThe... | 6.5  | The impact severity rating is moderate to high... | \[{'explanation': 'The ID3 algorithm is a centr... | {\n "title": "ID3 Decision Tree Algorithm C... | 2024-11-26 | 8    |
| 1 | 782d2194-aa11-4bd7-ad02-c8dcc527a1d2 | 1                   | 1         | 0     | C4.5 and Sklearn Integration          | The community is centered around the C4.5 deci... | # C4.5 and Sklearn Integration\n\nThe communit... | 4.5  | The impact severity rating is moderate due to ... | \[{'explanation': 'C4.5 is an improved version ... | {\n "title": "C4.5 and Sklearn Integration"... | 2024-11-26 | 2    |

```python
text_unit_df = pd.read_parquet(f"{INPUT_DIR}/{TEXT_UNIT_TABLE}.parquet")
text_units = read_indexer_text_units(text_unit_df)

print(f"Text unit records: {len(text_unit_df)}")
text_unit_df.head()
```

```plaintext
Text unit records: 4
```



|   | id                               | human\_readable\_id | text                                              | n\_tokens | document\_ids                       | entity\_ids                                        | relationship\_ids                                  |
| - | -------------------------------- | ------------------- | ------------------------------------------------- | --------- | ----------------------------------- | -------------------------------------------------- | -------------------------------------------------- |
| 0 | 0653a697b64dd8c029503ffc22af9ec3 | 1                   | Lesson 8.3 ID3ã€C4.5å†³ç­–æ ‘çš„å»ºæ¨¡æµç¨‹\nID3å’ŒC4.5ä½œä¸ºçš„ç»å…¸å†³ç­–æ ‘ç®—... | 1200      | \[c546fa97b72c8b72b7efb0c1ac45cb1d] | \[2aad028bd7264c52994beea0e6b9fdfc, 40dfc4d13cb... | \[0b76f33339064d0db05755b5fd464a0d, 03882ac8ccb... |
| 1 | b1fce21a45f01c5ef14bafc9fe3bab1d | 2                   | 8961919\nç„¶åå³å¯ç®—å‡ºæŒ‰ç…§å¦‚æ­¤è§„åˆ™è¿›è¡Œæ•°æ®é›†åˆ’åˆ†ï¼Œæœ€ç»ˆèƒ½å¤Ÿå‡å°‘çš„ä¸çº¯åº¦æ•°å€¼ï¼š\n# ... | 1200      | \[c546fa97b72c8b72b7efb0c1ac45cb1d] | \[2aad028bd7264c52994beea0e6b9fdfc, 40dfc4d13cb... | \[0b76f33339064d0db05755b5fd464a0d, 2a77965ec2f... |
| 2 | 08530861b09098077a0ebcd53ab3ae62 | 3                   | 4.5å†³ç­–æ ‘çš„åŸºæœ¬å»ºæ¨¡æµç¨‹\nä½œä¸ºID3çš„æ”¹è¿›ç‰ˆç®—æ³•ï¼ŒC4.5åœ¨ID3çš„åŸºç¡€ä¸Šè¿›è¡Œäº†ä¸‰ä¸ªæ–¹é¢... | 1200      | \[c546fa97b72c8b72b7efb0c1ac45cb1d] | None                                               | None                                               |
| 3 | e97cc7c63047f6471b4beac2f375eae0 | 4                   | é›†åˆ’åˆ†ã€‚\n\nC4.5çš„è¿ç»­å˜é‡å¤„ç†æ–¹æ³•\nC4.5å…è®¸å¸¦å…¥è¿ç»­å˜é‡è¿›è¡Œå»ºæ¨¡ï¼Œå¹¶ä¸”å›´ç»•è¿ç»­... | 558       | \[c546fa97b72c8b72b7efb0c1ac45cb1d] | None                                               | None                                               |

* **Step 3.åˆ›å»ºæ¨¡å‹**

```python
llm = ChatOpenAI(
    api_key='ollama',
    model='qwen2.5-7b-instruct',
    api_base="http://localhost:11434/v1",
    api_type=OpenaiApiType.OpenAI,  
    max_retries=20,
)

token_encoder = tiktoken.get_encoding("cl100k_base")

text_embedder = OpenAIEmbedding(
    api_key='ollama',
    api_base="http://localhost:11434/api",
    api_type=OpenaiApiType.OpenAI,
    model='nomic-embed-text',
    max_retries=20,
)
```

* **Step 4.åˆ›å»ºä¸Šä¸‹æ–‡æ„å»ºå™¨**

```python
context_builder = LocalSearchMixedContext(
    community_reports=reports,
    text_units=text_units,
    entities=entities,
    relationships=relationships,
    covariates=None,
    entity_text_embeddings=description_embedding_store,
    embedding_vectorstore_key=EntityVectorStoreKey.ID,  
    text_embedder=text_embedder,
    token_encoder=token_encoder,
)
```

* **Step 5.è®¾ç½®æœç´¢å¼•æ“å‚æ•°**

```python
local_context_params = {
    "text_unit_prop": 0.5,
    "community_prop": 0.1,
    "conversation_history_max_turns": 5,
    "conversation_history_user_turns_only": True,
    "top_k_mapped_entities": 10,
    "top_k_relationships": 10,
    "include_entity_rank": True,
    "include_relationship_weight": True,
    "include_community_rank": True,
    "return_candidate_context": True,
    "embedding_vectorstore_key": EntityVectorStoreKey.ID,  
    "max_tokens": 12_000, 
}

llm_params = {
    "max_tokens": 2_000, 
    "temperature": 0.0,
}
```

* **Step 6.åˆ›å»ºæœç´¢å¼•æ“**

```python
search_engine = LocalSearch(
    llm=llm,
    context_builder=context_builder,
    token_encoder=token_encoder,
    llm_params=llm_params,
    context_builder_params=local_context_params,
    response_type="multiple paragraphs", 
)
```

```python
result = await search_engine.asearch("è¯·å¸®æˆ‘ä»‹ç»ä¸‹ID3å†³ç­–æ ‘ç®—æ³•")
```

```plaintext
Error embedding chunk {'OpenAIEmbedding': "1 validation error for EmbeddingsRequest\nprompt\n  Input should be a valid string [type=string_type, input_value=('è¯·', 'å¸®', 'æˆ‘', '...', 'æ ‘', 'ç®—', 'æ³•'), input_type=tuple]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type"}
```

```python
result
```

````plaintext
SearchResult(response='\nå½“ç„¶å¯ä»¥ï¼ID3ï¼ˆIterative Dichotomiser 3ï¼‰æ˜¯ä¸€ç§ç»å…¸çš„åˆ†ç±»å’Œå›å½’æ ‘ï¼ˆCARTï¼‰ç®—æ³•ï¼Œä¸»è¦ç”¨äºæ„å»ºå†³ç­–æ ‘ã€‚å®ƒç”±Ross Quinlanåœ¨1986å¹´æå‡ºï¼Œå¹¶ä¸”æ˜¯æœ€æ—©ä½¿ç”¨ä¿¡æ¯å¢ç›Šä½œä¸ºç‰¹å¾é€‰æ‹©æ ‡å‡†çš„ç®—æ³•ä¹‹ä¸€ã€‚\n\n### åŸºæœ¬æ¦‚å¿µ\n\n- **å†³ç­–æ ‘**ï¼šä¸€ç§æ ‘å½¢ç»“æ„ï¼Œæ¯ä¸ªå†…éƒ¨èŠ‚ç‚¹è¡¨ç¤ºä¸€ä¸ªå±æ€§ä¸Šçš„æµ‹è¯•ï¼Œæ¯ä¸ªåˆ†æ”¯ä»£è¡¨ä¸€ä¸ªæµ‹è¯•ç»“æœï¼Œæ¯ä¸ªå¶èŠ‚ç‚¹ä»£è¡¨ä¸€ä¸ªç±»åˆ«æˆ–å€¼ã€‚\n- **ä¿¡æ¯ç†µï¼ˆEntropyï¼‰**ï¼šè¡¡é‡æ•°æ®é›†ä¸ç¡®å®šæ€§çš„åº¦é‡ã€‚å¯¹äºäºŒåˆ†ç±»é—®é¢˜ï¼Œä¿¡æ¯ç†µçš„è®¡ç®—å…¬å¼ä¸ºï¼š\n  \\[\n  H(S) = -\\sum_{i=1}^{n} p_i \\log_2(p_i)\n  \\]\n  å…¶ä¸­ \\(p_i\\) æ˜¯ç¬¬ \\(i\\) ç±»åˆ«çš„æ¦‚ç‡ã€‚\n- **ä¿¡æ¯å¢ç›Šï¼ˆInformation Gainï¼‰**ï¼šè¡¡é‡ä¸€ä¸ªç‰¹å¾å¯¹æ•°æ®é›†åˆ†ç±»èƒ½åŠ›çš„åº¦é‡ã€‚è®¡ç®—å…¬å¼ä¸ºï¼š\n  \\[\n  IG(S, A) = H(S) - H(S|A)\n  \\]\n  å…¶ä¸­ \\(H(S)\\) æ˜¯åŸå§‹æ•°æ®é›†çš„ä¿¡æ¯ç†µï¼Œ\\(H(S|A)\\) æ˜¯åœ¨ç‰¹å¾ \\(A\\) ä¸‹çš„æ•°æ®é›†æ¡ä»¶ä¿¡æ¯ç†µã€‚\n\n### ç®—æ³•æ­¥éª¤\n\n1. **é€‰æ‹©æœ€ä½³åˆ’åˆ†å±æ€§**ï¼šè®¡ç®—æ¯ä¸ªç‰¹å¾çš„ä¿¡æ¯å¢ç›Šï¼Œå¹¶é€‰æ‹©å…·æœ‰æœ€å¤§ä¿¡æ¯å¢ç›Šçš„ç‰¹å¾ä½œä¸ºå½“å‰èŠ‚ç‚¹çš„åˆ†è£‚æ ‡å‡†ã€‚\n2. **åˆ›å»ºå­æ ‘**ï¼šæ ¹æ®é€‰å®šçš„ç‰¹å¾å°†æ•°æ®é›†åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªå­é›†ï¼Œä¸ºæ¯ä¸ªå­é›†é€’å½’åœ°æ„å»ºå†³ç­–æ ‘ã€‚\n3. **åœæ­¢æ¡ä»¶**ï¼š\n   - å½“æ‰€æœ‰æ ·æœ¬å±äºåŒä¸€ç±»åˆ«æ—¶ï¼Œè¯¥èŠ‚ç‚¹æˆä¸ºå¶èŠ‚ç‚¹ã€‚\n   - å½“æ²¡æœ‰æ›´å¤šçš„ç‰¹å¾å¯ä»¥ç”¨äºåˆ’åˆ†æ—¶ï¼Œè¯¥èŠ‚ç‚¹ä¹Ÿæˆä¸ºå¶èŠ‚ç‚¹ã€‚\n\n### ä¼˜ç‚¹\n\n- ç®€å•æ˜“æ‡‚ï¼šä¿¡æ¯å¢ç›Šçš„è®¡ç®—ç›´è§‚ä¸”æ˜“äºç†è§£ã€‚\n- è®¡ç®—æ•ˆç‡é«˜ï¼šç›¸æ¯”äºå…¶ä»–ä¸€äº›æ›´å¤æ‚çš„ç®—æ³•ï¼ˆå¦‚C4.5ï¼‰ï¼ŒID3çš„è®¡ç®—é€Ÿåº¦æ›´å¿«ã€‚\n\n### ç¼ºç‚¹\n\n- **å€¾å‘é€‰æ‹©å…·æœ‰è¾ƒå¤šå–å€¼çš„ç‰¹å¾**ï¼šå› ä¸ºä¿¡æ¯å¢ç›Šå€¾å‘äºé€‰æ‹©å…·æœ‰æ›´å¤šåˆ†è£‚é€‰é¡¹çš„ç‰¹å¾ï¼Œè¿™å¯èƒ½å¯¼è‡´è¿‡æ‹Ÿåˆã€‚\n- **æ— æ³•å¤„ç†è¿ç»­å‹æ•°æ®**ï¼šID3åªèƒ½å¤„ç†ç¦»æ•£å‹æ•°æ®ï¼Œå¯¹äºè¿ç»­å‹æ•°æ®éœ€è¦è¿›è¡Œç¦»æ•£åŒ–å¤„ç†ã€‚\n\n### å®ç°ç¤ºä¾‹\n\nå‡è®¾æœ‰ä¸€ä¸ªåŒ…å«ä¸‰ä¸ªå±æ€§ï¼ˆA1, A2, A3ï¼‰å’Œä¸€ä¸ªç›®æ ‡å˜é‡ï¼ˆClassï¼‰çš„æ•°æ®é›†ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤æ¥æ„å»ºå†³ç­–æ ‘ï¼š\n\n```python\nfrom collections import Counter\n\ndef entropy(data):\n    labels = [row[-1] for row in data]\n    counts = Counter(labels)\n    ent = 0.0\n    for lbl in counts:\n        prob_of_lbl = counts[lbl] / float(len(labels))\n        ent -= prob_of_lbl * np.log2(prob_of_lbl)\n    return ent\n\ndef information_gain(data, feature):\n    total_entropy = entropy(data)\n    vals, counts = np.unique([row[feature] for row in data], return_counts=True)\n    weighted_avg_entropy = sum([(counts[i] / float(len(data))) * entropy([row for row in data if row[feature] == vals[i]]) for i in range(len(vals))])\n    return total_entropy - weighted_avg_entropy\n\ndef id3(data, features):\n    labels = [row[-1] for row in data]\n    most_common_label = Counter(labels).most_common(1)[0][0]\n\n    # å¦‚æœæ‰€æœ‰æ ·æœ¬å±äºåŒä¸€ç±»åˆ«ï¼Œè¿”å›è¯¥ç±»åˆ«çš„èŠ‚ç‚¹\n    if len(set(labels)) == 1:\n        return most_common_label\n\n    # å¦‚æœæ²¡æœ‰ç‰¹å¾å¯ä»¥ç”¨äºåˆ’åˆ†ï¼Œè¿”å›å¤šæ•°ç±»çš„èŠ‚ç‚¹\n    if not features:\n        return most_common_label\n\n    best_feature = max(features, key=lambda f: information_gain(data, f))\n    tree = {best_feature: {}}\n\n    for val in np.unique([row[best_feature] for row in data]):\n        sub_data = [row for row in data if row[best_feature] == val]\n        remaining_features = list(features)\n        remaining_features.remove(best_feature)\n\n        subtree = id3(sub_data, remaining_features)\n        tree[best_feature][val] = subtree\n\n    return tree\n```\n\nè¿™ä¸ªç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ID3ç®—æ³•æ„å»ºå†³ç­–æ ‘ã€‚å®é™…åº”ç”¨ä¸­ï¼Œå¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–å’Œæ‰©å±•è¯¥ç®—æ³•ä»¥å¤„ç†æ›´å¤æ‚çš„æ•°æ®é›†ã€‚\n\nå¸Œæœ›è¿™äº›ä¿¡æ¯å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼å¦‚æœä½ æœ‰ä»»ä½•å…¶ä»–é—®é¢˜æˆ–éœ€è¦æ›´å¤šç»†èŠ‚ï¼Œè¯·éšæ—¶å‘Šè¯‰æˆ‘ã€‚', context_data={}, context_text='', completion_time=9.82521939277649, llm_calls=1, prompt_tokens=599, output_tokens=1204, llm_calls_categories={'build_context': 0, 'response': 1}, prompt_tokens_categories={'build_context': 0, 'response': 599}, output_tokens_categories={'build_context': 0, 'response': 1204})
````

```python
from IPython.display import Markdown, display
```

```python
display(Markdown(result.response))
```

å½“ç„¶å¯ä»¥ï¼ID3ï¼ˆIterative Dichotomiser 3ï¼‰æ˜¯ä¸€ç§ç»å…¸çš„åˆ†ç±»å’Œå›å½’æ ‘ï¼ˆCARTï¼‰ç®—æ³•ï¼Œä¸»è¦ç”¨äºæ„å»ºå†³ç­–æ ‘ã€‚å®ƒç”±Ross Quinlanåœ¨1986å¹´æå‡ºï¼Œå¹¶ä¸”æ˜¯æœ€æ—©ä½¿ç”¨ä¿¡æ¯å¢ç›Šä½œä¸ºç‰¹å¾é€‰æ‹©æ ‡å‡†çš„ç®—æ³•ä¹‹ä¸€ã€‚

### åŸºæœ¬æ¦‚å¿µ

* **å†³ç­–æ ‘**ï¼šä¸€ç§æ ‘å½¢ç»“æ„ï¼Œæ¯ä¸ªå†…éƒ¨èŠ‚ç‚¹è¡¨ç¤ºä¸€ä¸ªå±æ€§ä¸Šçš„æµ‹è¯•ï¼Œæ¯ä¸ªåˆ†æ”¯ä»£è¡¨ä¸€ä¸ªæµ‹è¯•ç»“æœï¼Œæ¯ä¸ªå¶èŠ‚ç‚¹ä»£è¡¨ä¸€ä¸ªç±»åˆ«æˆ–å€¼ã€‚

* **ä¿¡æ¯ç†µï¼ˆEntropyï¼‰**ï¼šè¡¡é‡æ•°æ®é›†ä¸ç¡®å®šæ€§çš„åº¦é‡ã€‚å¯¹äºäºŒåˆ†ç±»é—®é¢˜ï¼Œä¿¡æ¯ç†µçš„è®¡ç®—å…¬å¼ä¸ºï¼š
  \[
  H(S) = -\sum\_{i=1}^{n} p\_i \log\_2(p\_i)
  ]
  å…¶ä¸­ (p\_i) æ˜¯ç¬¬ (i) ç±»åˆ«çš„æ¦‚ç‡ã€‚

* **ä¿¡æ¯å¢ç›Šï¼ˆInformation Gainï¼‰**ï¼šè¡¡é‡ä¸€ä¸ªç‰¹å¾å¯¹æ•°æ®é›†åˆ†ç±»èƒ½åŠ›çš„åº¦é‡ã€‚è®¡ç®—å…¬å¼ä¸ºï¼š
  \[
  IG(S, A) = H(S) - H(S|A)
  ]
  å…¶ä¸­ (H(S)) æ˜¯åŸå§‹æ•°æ®é›†çš„ä¿¡æ¯ç†µï¼Œ(H(S|A)) æ˜¯åœ¨ç‰¹å¾ (A) ä¸‹çš„æ•°æ®é›†æ¡ä»¶ä¿¡æ¯ç†µã€‚

### ç®—æ³•æ­¥éª¤

1. **é€‰æ‹©æœ€ä½³åˆ’åˆ†å±æ€§**ï¼šè®¡ç®—æ¯ä¸ªç‰¹å¾çš„ä¿¡æ¯å¢ç›Šï¼Œå¹¶é€‰æ‹©å…·æœ‰æœ€å¤§ä¿¡æ¯å¢ç›Šçš„ç‰¹å¾ä½œä¸ºå½“å‰èŠ‚ç‚¹çš„åˆ†è£‚æ ‡å‡†ã€‚

2. **åˆ›å»ºå­æ ‘**ï¼šæ ¹æ®é€‰å®šçš„ç‰¹å¾å°†æ•°æ®é›†åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªå­é›†ï¼Œä¸ºæ¯ä¸ªå­é›†é€’å½’åœ°æ„å»ºå†³ç­–æ ‘ã€‚

3. **åœæ­¢æ¡ä»¶**ï¼š

   * å½“æ‰€æœ‰æ ·æœ¬å±äºåŒä¸€ç±»åˆ«æ—¶ï¼Œè¯¥èŠ‚ç‚¹æˆä¸ºå¶èŠ‚ç‚¹ã€‚

   * å½“æ²¡æœ‰æ›´å¤šçš„ç‰¹å¾å¯ä»¥ç”¨äºåˆ’åˆ†æ—¶ï¼Œè¯¥èŠ‚ç‚¹ä¹Ÿæˆä¸ºå¶èŠ‚ç‚¹ã€‚

### ä¼˜ç‚¹

* ç®€å•æ˜“æ‡‚ï¼šä¿¡æ¯å¢ç›Šçš„è®¡ç®—ç›´è§‚ä¸”æ˜“äºç†è§£ã€‚

* è®¡ç®—æ•ˆç‡é«˜ï¼šç›¸æ¯”äºå…¶ä»–ä¸€äº›æ›´å¤æ‚çš„ç®—æ³•ï¼ˆå¦‚C4.5ï¼‰ï¼ŒID3çš„è®¡ç®—é€Ÿåº¦æ›´å¿«ã€‚

### ç¼ºç‚¹

* **å€¾å‘é€‰æ‹©å…·æœ‰è¾ƒå¤šå–å€¼çš„ç‰¹å¾**ï¼šå› ä¸ºä¿¡æ¯å¢ç›Šå€¾å‘äºé€‰æ‹©å…·æœ‰æ›´å¤šåˆ†è£‚é€‰é¡¹çš„ç‰¹å¾ï¼Œè¿™å¯èƒ½å¯¼è‡´è¿‡æ‹Ÿåˆã€‚

* **æ— æ³•å¤„ç†è¿ç»­å‹æ•°æ®**ï¼šID3åªèƒ½å¤„ç†ç¦»æ•£å‹æ•°æ®ï¼Œå¯¹äºè¿ç»­å‹æ•°æ®éœ€è¦è¿›è¡Œç¦»æ•£åŒ–å¤„ç†ã€‚

### å®ç°ç¤ºä¾‹

å‡è®¾æœ‰ä¸€ä¸ªåŒ…å«ä¸‰ä¸ªå±æ€§ï¼ˆA1, A2, A3ï¼‰å’Œä¸€ä¸ªç›®æ ‡å˜é‡ï¼ˆClassï¼‰çš„æ•°æ®é›†ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤æ¥æ„å»ºå†³ç­–æ ‘ï¼š

```python
from collections import Counter

def entropy(data):
    labels = [row[-1] for row in data]
    counts = Counter(labels)
    ent = 0.0
    for lbl in counts:
        prob_of_lbl = counts[lbl] / float(len(labels))
        ent -= prob_of_lbl * np.log2(prob_of_lbl)
    return ent

def information_gain(data, feature):
    total_entropy = entropy(data)
    vals, counts = np.unique([row[feature] for row in data], return_counts=True)
    weighted_avg_entropy = sum([(counts[i] / float(len(data))) * entropy([row for row in data if row[feature] == vals[i]]) for i in range(len(vals))])
    return total_entropy - weighted_avg_entropy

def id3(data, features):
    labels = [row[-1] for row in data]
    most_common_label = Counter(labels).most_common(1)[0][0]

    # å¦‚æœæ‰€æœ‰æ ·æœ¬å±äºåŒä¸€ç±»åˆ«ï¼Œè¿”å›è¯¥ç±»åˆ«çš„èŠ‚ç‚¹
    if len(set(labels)) == 1:
        return most_common_label

    # å¦‚æœæ²¡æœ‰ç‰¹å¾å¯ä»¥ç”¨äºåˆ’åˆ†ï¼Œè¿”å›å¤šæ•°ç±»çš„èŠ‚ç‚¹
    if not features:
        return most_common_label

    best_feature = max(features, key=lambda f: information_gain(data, f))
    tree = {best_feature: {}}

    for val in np.unique([row[best_feature] for row in data]):
        sub_data = [row for row in data if row[best_feature] == val]
        remaining_features = list(features)
        remaining_features.remove(best_feature)

        subtree = id3(sub_data, remaining_features)
        tree[best_feature][val] = subtree

    return tree
```

è¿™ä¸ªç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ID3ç®—æ³•æ„å»ºå†³ç­–æ ‘ã€‚å®é™…åº”ç”¨ä¸­ï¼Œå¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–å’Œæ‰©å±•è¯¥ç®—æ³•ä»¥å¤„ç†æ›´å¤æ‚çš„æ•°æ®é›†ã€‚

å¸Œæœ›è¿™äº›ä¿¡æ¯å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼å¦‚æœä½ æœ‰ä»»ä½•å…¶ä»–é—®é¢˜æˆ–éœ€è¦æ›´å¤šç»†èŠ‚ï¼Œè¯·éšæ—¶å‘Šè¯‰æˆ‘ã€‚

```python
result = await search_engine.asearch("ID3å’ŒC4.5ä¹‹é—´æ˜¯ä»€ä¹ˆå…³ç³»")
display(Markdown(result.response))
```

```plaintext
Error embedding chunk {'OpenAIEmbedding': "1 validation error for EmbeddingsRequest\nprompt\n  Input should be a valid string [type=string_type, input_value=('I', 'D', '3', 'å’Œ', 'C...', 'ä¹ˆ', 'å…³', 'ç³»'), input_type=tuple]\n    For further information visit https://errors.pydantic.dev/2.10/v/string_type"}
```

ï¼Ÿ ID3ï¼ˆIterative Dichotomiser 3ï¼‰å’ŒC4.5æ˜¯ä¸¤ä¸ªç´§å¯†ç›¸å…³çš„æœºå™¨å­¦ä¹ ç®—æ³•ï¼Œå®ƒä»¬éƒ½å±äºå†³ç­–æ ‘åˆ†ç±»å™¨ã€‚å…·ä½“æ¥è¯´ï¼š

1. **èµ·æº**ï¼šID3æ˜¯ç”±J. Ross Quinlanåœ¨1979å¹´å¼€å‘çš„æœ€æ—©çš„å†³ç­–æ ‘ç®—æ³•ä¹‹ä¸€ã€‚

2. **å‘å±•**ï¼š

   * ID3 æ˜¯ C4.5 çš„å‰èº«ã€‚

   * C4.5 æ˜¯å¯¹ ID3 è¿›è¡Œæ”¹è¿›å’Œæ‰©å±•çš„ç»“æœï¼Œç”± J. Ross Quinlan åœ¨ 1993 å¹´å‘å¸ƒã€‚

3. **ä¸»è¦åŒºåˆ«**ï¼š

   * **å¤„ç†ç¼ºå¤±å€¼**ï¼šC4.5 èƒ½å¤Ÿå¤„ç†æ•°æ®ä¸­çš„ç¼ºå¤±å€¼ï¼Œè€ŒåŸå§‹çš„ ID3 ä¸èƒ½ã€‚

   * **å‰ªææŠ€æœ¯**ï¼šC4.5 å¼•å…¥äº†é¢„å‰ªæå’Œåå‰ªæçš„æŠ€æœ¯æ¥å‡å°‘è¿‡æ‹Ÿåˆçš„é£é™©ã€‚ID3 åªæœ‰ç®€å•çš„å‰ªææ–¹æ³•ã€‚

   * **å¢ç›Šæ¯”ç‡**ï¼šC4.5 ä½¿ç”¨å¢ç›Šæ¯”ç‡ä½œä¸ºç‰¹å¾é€‰æ‹©çš„æ ‡å‡†ï¼Œè€Œ ID3 ä»…ä½¿ç”¨ä¿¡æ¯å¢ç›Šã€‚

4. **ç®—æ³•æµç¨‹**ï¼š

   * **ID3**ï¼šåŸºäºä¿¡æ¯ç†µå’Œä¿¡æ¯å¢ç›Šè¿›è¡Œå†³ç­–æ ‘çš„æ„å»ºã€‚å®ƒé€šè¿‡é€’å½’åœ°å°†æ•°æ®é›†åˆ’åˆ†ä¸ºæ›´å°çš„å­é›†æ¥ç”Ÿæˆå†³ç­–æ ‘ã€‚

   * **C4.5**ï¼šåœ¨ ID3 çš„åŸºç¡€ä¸Šå¢åŠ äº†å¤„ç†ç¼ºå¤±å€¼ã€å‰ªææŠ€æœ¯ä»¥åŠä½¿ç”¨å¢ç›Šæ¯”ç‡ç­‰æ”¹è¿›ã€‚

æ€»ç»“æ¥è¯´ï¼ŒC4.5 æ˜¯å¯¹ ID3 è¿›è¡Œäº†å¤šé¡¹æ”¹è¿›å’Œæ‰©å±•åçš„ç‰ˆæœ¬ã€‚å¯ä»¥è¯´ C4.5 ç»§æ‰¿å¹¶å‘å±•äº† ID3 çš„æ ¸å¿ƒæ€æƒ³å’ŒæŠ€æœ¯ï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šæ·»åŠ äº†è®¸å¤šæ–°çš„åŠŸèƒ½å’Œä¼˜åŒ–æªæ–½ã€‚å› æ­¤ï¼Œå¯ä»¥å°†å®ƒä»¬è§†ä¸ºåŒä¸€ç³»åˆ—ç®—æ³•ä¸­çš„ä¸åŒé˜¶æ®µæˆ–ç‰ˆæœ¬ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼ŒC4.5 é€šå¸¸è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªæ›´å¼ºå¤§ã€æ›´çµæ´»çš„å†³ç­–æ ‘åˆ†ç±»å™¨ã€‚

å¸Œæœ›è¿™ä¸ªè§£é‡Šå¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼å¦‚æœä½ æœ‰æ›´å¤šé—®é¢˜ï¼Œè¯·éšæ—¶æé—®ã€‚

***

**æ›´å¤šå¤§æ¨¡å‹æŠ€æœ¯å†…å®¹å­¦ä¹ **

**æ‰«ç æ·»åŠ åŠ©ç†è‹±è‹±ï¼Œå›å¤â€œå¤§æ¨¡å‹â€ï¼Œäº†è§£æ›´å¤šå¤§æ¨¡å‹æŠ€æœ¯è¯¦æƒ…å“¦ğŸ‘‡**

![](images/f339b04b7b20233dd1509c7fb36d5c0.png)

æ­¤å¤–ï¼Œ**æ‰«ç å›å¤â€œå…¥ç¾¤â€**ï¼Œå³å¯åŠ å…¥**å¤§æ¨¡å‹æŠ€æœ¯ç¤¾ç¾¤ï¼šæµ·é‡ç¡¬æ ¸ç‹¬å®¶æŠ€æœ¯`å¹²è´§å†…å®¹`+æ— é—¨æ§›`æŠ€æœ¯äº¤æµ`ï¼**
